<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title data-lang-key="pageTitle">Quaderni di Archeologia della Libya - Publications</title>
    <!-- Tailwind CSS CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Inter font -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f5f5f4; /* neutral-100 for a subtle, aged paper feel */
            color: #333;
        }
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 2rem;
        }
        /* Custom modal styles for alerts and book details */
        .modal {
            display: none; /* Hidden by default */
            position: fixed; /* Stay in place */
            z-index: 1000; /* Sit on top */
            left: 0;
            top: 0;
            width: 100%; /* Full width */
            height: 100%; /* Full height */
            overflow: auto; /* Enable scroll if needed */
            background-color: rgba(0,0,0,0.4); /* Black w/ opacity */
            justify-content: center; /* Center horizontally */
            align-items: center; /* Center vertically */
            padding: 1rem; /* Add some padding for smaller screens */
        }
        .modal.flex {
            display: flex; /* Override display: none when showing */
        }
        .modal-content {
            background-color: #fff;
            margin: auto;
            padding: 20px;
            border-radius: 0.75rem;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            max-width: 500px; /* Increased max-width for book details */
            width: 90%;
            text-align: center;
            position: relative; /* For positioning close button */
        }
        .close-button {
            color: #aaa;
            float: right;
            font-size: 28px;
            font-weight: bold;
            line-height: 1; /* Adjust line-height to center X vertically */
            position: absolute;
            top: 10px;
            right: 20px;
        }
        .close-button:hover,
        .close-button:focus {
            color: black;
            text-decoration: none;
            cursor: pointer;
        }
        /* Style for book card to allow full description on click */
        .book-card {
            cursor: pointer;
        }

        /* Responsive styling for image inputs preview */
        @media (max-width: 640px) {
            .admin-file-preview-container {
                flex-direction: column;
                align-items: center;
            }
            .admin-file-preview-item {
                margin-bottom: 1rem; /* Space between items */
            }
            .admin-file-preview-item:last-child {
                margin-bottom: 0;
            }
        }
    </style>
</head>
<body class="bg-neutral-100 min-h-screen flex flex-col">

    <!-- Header -->
    <header class="bg-stone-800 shadow-md py-4 px-6 md:px-8">
        <div class="container flex flex-col md:flex-row justify-between items-center gap-y-4 md:gap-y-0 md:gap-x-12">
            <h1 class="text-2xl md:text-3xl font-bold text-neutral-100 text-center md:text-left" data-lang-key="headerTitle">Quaderni di Archeologia della Libya</h1>
            <nav class="flex flex-wrap justify-center md:justify-end items-center space-x-2 md:space-x-4">
                <button id="homeViewBtn" class="bg-stone-600 hover:bg-stone-700 text-white font-semibold py-2 px-4 rounded-lg shadow-md transition duration-300 transform hover:scale-105" data-lang-key="homeBtn">Publications</button>
                <button id="codiceEticoViewBtn" class="bg-stone-600 hover:bg-stone-700 text-white font-semibold py-2 px-4 rounded-lg shadow-md transition duration-300 transform hover:scale-105" data-lang-key="codiceEticoBtn">Code of Ethics</button>
                <button id="normeEditorialiViewBtn" class="bg-stone-600 hover:bg-stone-700 text-white font-semibold py-2 px-4 rounded-lg shadow-md transition duration-300 transform hover:scale-105" data-lang-key="normeEditorialiBtn">Editorial Guidelines</button>
                <button id="aboutViewBtn" class="bg-stone-600 hover:bg-stone-700 text-white font-semibold py-2 px-4 rounded-lg shadow-md transition duration-300 transform hover:scale-105" data-lang-key="aboutBtn">About Us</button>
                <button id="contactViewBtn" class="bg-stone-600 hover:bg-stone-700 text-white font-semibold py-2 px-4 rounded-lg shadow-md transition duration-300 transform hover:scale-105" data-lang-key="contactBtn">Contact Us</button>
                <!-- Admin login button made less pronounced -->
                <button id="adminLoginBtn" class="text-neutral-300 hover:text-neutral-100 font-semibold py-2 px-2 rounded-lg transition duration-300 text-sm transform hover:scale-105" data-lang-key="adminLoginBtn">Admin Login</button>
                
                <!-- Language Toggle -->
                <div class="ml-4 flex space-x-2">
                    <button id="langEnBtn" class="text-neutral-300 hover:text-neutral-100 font-semibold py-1 px-2 rounded-lg text-sm bg-stone-700 transition duration-300 transform hover:scale-110">EN</button>
                    <button id="langItBtn" class="text-neutral-300 hover:text-neutral-100 font-semibold py-1 px-2 rounded-lg text-sm bg-stone-700 transition duration-300 transform hover:scale-110">IT</button>
                </div>
            </nav>
        </div>
    </header>

    <!-- Main Content Area -->
    <main class="flex-grow container mt-8">

        <!-- Message/Alert Modal -->
        <div id="messageModal" class="modal hidden">
            <div class="modal-content">
                <span class="close-button text-gray-600 hover:text-gray-900 cursor-pointer text-xl mb-4" onclick="closeMessageModal()">&times;</span>
                <p id="modalMessage" class="text-lg text-gray-800"></p>
                <button onclick="closeMessageModal()" class="mt-4 bg-blue-500 hover:bg-blue-600 text-white font-semibold py-2 px-4 rounded-lg shadow-md transition duration-300 transform hover:scale-105" data-lang-key="modalOkBtn">OK</button>
            </div>
        </div>

        <!-- Confirmation Modal -->
        <div id="confirmModal" class="modal hidden">
            <div class="modal-content">
                <p id="confirmMessage" class="text-lg text-gray-800 mb-6"></p>
                <div class="flex justify-center space-x-4">
                    <button id="confirmYesBtn" class="bg-red-500 hover:bg-red-600 text-white font-semibold py-2 px-4 rounded-lg shadow-md transition duration-300 transform hover:scale-105" data-lang-key="confirmYesBtn">Yes</button>
                    <button id="confirmNoBtn" class="bg-gray-400 hover:bg-gray-500 text-white font-semibold py-2 px-4 rounded-lg shadow-md transition duration-300 transform hover:scale-105" data-lang-key="confirmNoBtn">No</button>
                </div>
            </div>
        </div>

        <!-- Book Details Modal -->
        <div id="bookDetailsModal" class="modal hidden">
            <div class="modal-content">
                <span class="close-button text-gray-600 hover:text-gray-900 cursor-pointer text-xl" onclick="closeBookDetailsModal()">&times;</span>
                <img id="modalBookCover" src="" alt="Book Cover" class="w-48 h-64 object-cover rounded-md mx-auto mb-4 shadow-lg">
                <h3 id="modalBookTitle" class="text-2xl font-bold mb-2 text-gray-800"></h3>
                <p id="modalBookAuthor" class="text-gray-600 text-base mb-3"></p>
                <div class="text-gray-700 text-sm text-left leading-relaxed mb-6 space-y-2">
                    <p id="modalBookPages" class="font-medium"></p>
                    <p id="modalBookFormat" class="font-medium"></p>
                    <p id="modalBookDoi"><span class="font-medium" data-lang-key="doiLabel">DOI:</span> <a href="#" target="_blank" class="text-blue-600 hover:underline"></a></p>
                    <p id="modalBookIsbn"><span class="font-medium" data-lang-key="isbnLabel">ISBN:</span> </p>
                    <p id="modalBookIssn"><span class="font-medium" data-lang-key="issnLabel">ISSN:</span> </p>
                    <p id="modalBookNovelty" class="text-green-600 font-semibold hidden" data-lang-key="isNoveltyLabel">NEW!</p>
                    <p id="modalBookDescription"></p>
                </div>
                <a id="modalDownloadPdfBtn" href="#" target="_blank" class="bg-blue-500 hover:bg-blue-600 text-white font-semibold py-2 px-4 rounded-lg shadow-md transition duration-300 transform hover:scale-105" data-lang-key="downloadPdfButton">Download PDF</a>
            </div>
        </div>

        <!-- Home View Section (Publications) -->
        <section id="homeView" class="hidden bg-neutral-50 p-6 rounded-xl shadow-lg">
            <h2 class="text-3xl font-bold mb-6 text-center text-gray-800" data-lang-key="ourPublicationsTitle">Our Publications</h2>
            <div class="mb-6 max-w-lg mx-auto"> <!-- Added max-w-lg mx-auto for better centering and room -->
                <label for="publicSearchInput" class="sr-only" data-lang-key="searchPublicationsLabel">Search Publications</label>
                <input type="text" id="publicSearchInput" placeholder="Search by title or author..." class="w-full px-5 py-3 border border-gray-300 rounded-xl shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500 transition duration-200" data-lang-key="searchPlaceholder">
            </div>
            <div id="booksContainer" class="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-6">
                <!-- Books will be loaded here by JavaScript -->
                <p class="text-center text-gray-500 col-span-full" id="noBooksMessage" data-lang-key="noPublicationsMessage">No publications yet. Check back soon!</p>
            </div>
        </section>

        <!-- Codice Etico Section -->
        <section id="codiceEticoView" class="hidden bg-neutral-50 p-6 rounded-xl shadow-lg">
            <h2 class="text-3xl font-bold mb-6 text-center text-gray-800" data-lang-key="codiceEticoTitle">Code of Ethics and Malpractice Statement</h2>
            <div class="prose max-w-none text-gray-700 leading-relaxed space-y-4">
                <p data-lang-key="codiceEticoParaPreface">This document outlines the ethics principles and good practices applied by the publishing house L'ERMA di Bretschneider (hereafter L'ERMA) to the process of editing and publishing monographs, scientific journals, and other editorial content of scientific, educational, and outreach nature. L'ERMA is inspired by the ethical principles outlined by the Committee on Publication Ethics (hereinafter COPE), an international non-profit organization that aims to support publishers and editors in pursuing high standards of publishing ethics. Although COPE mainly provides guidelines and resources for publishers and editors of scientific journals, these can also be applied to the publication of monographs and other academic content.</p>
                <h3 class="text-2xl font-bold mt-6 mb-3 text-gray-800" data-lang-key="codiceEticoH3ResearchEthics">I. Research ethics and integrity</h3>
                <p data-lang-key="codiceEticoParaResearchEthics1">L'ERMA publications respect the ethical principles of COPE, which are: Reliability; honesty, respect, and responsibility in all aspects of research; Care, accuracy, and excellence in research practice; Transparency, reproducibility, traceability, and open communication; Attention and respect for all participants and research subjects.</p>
                <p data-lang-key="codiceEticoParaResearchEthics2">If they deem it appropriate, the editors of academic publications and products published by L'ERMA provide authors with specific guidelines and policies based on this document, relating to the principles of research integrity and ethics, according to their subjects and disciplines.</p>
                <p data-lang-key="codiceEticoParaResearchEthics3">Whoever believes that research published by L'ERMA has not been conducted in line with these ethical practices is invited to raise the issue with the publisher at lerma@lerma.it. Where possible, each report will be handled following COPE guidelines, and/or by submitting the matter to the Chairman of the Board of Directors of the publishing house and, if necessary, to the members of the Editorial Board of the publishing house.</p>
                <h3 class="text-2xl font-bold mt-6 mb-3 text-gray-800" data-lang-key="codiceEticoH3PublishingProcess">II. Publishing process</h3>
                <p data-lang-key="codiceEticoParaPublishingProcess1">L'ERMA is committed to respecting editorial independence and all its efforts are aimed at ensuring that this principle is not compromised by competing interests or any other influence. Erma adopts practices of non-discrimination of authors, editors, or reviewers based on personal characteristics or identity, with an ongoing commitment to remove any barriers to inclusion and to promote fairness at every stage of the publishing process.</p>
                <p data-lang-key="codiceEticoParaPublishingProcess2">L'ERMA welcomes authors of different backgrounds, races and ethnicities, gender identity, sexual orientation, nationality, religion, and disability to publish with them. L'ERMA refuses the predatory practices of academic pseudo-publishers who pursue mere profit at the expense of the progress of research and the quality and scientific value of the works they publish.</p>
                <p data-lang-key="codiceEticoParaPublishingProcess3">A board of directors of L'ERMA oversees the publishing program. Members are selected based on their recognized scientific expertise, knowledge, skills, and their agreement with the ethical values of the publishing house. They independently approve publication contracts.</p>
                <p data-lang-key="codiceEticoParaPublishingProcessRoles">The roles of the board of Directors are the following:</p>
                <ul class="list-disc ml-6 space-y-2">
                    <li data-lang-key="codiceEticoListItem1">Initially, proposals for the editorial program of monographs are reviewed by the members of the editorial board, which has decision-making autonomy. Nevertheless, the members of the editorial board may consult experts in the field whenever they need to ensure the quality of the editorial product. To facilitate this process, the advisory boards of the different series sign the publication proposal together with a statement on the quality and scientific value of the publication.</li>
                    <li data-lang-key="codiceEticoListItem2">After a monograph that is not part of a series has been valued as worthy of being considered by L'ERMA, the publishing house sends the proposal and written sample from the manuscript to a minimum of two external and independent advice for and against the publication to the Board of Directors.</li>
                    <li data-lang-key="codiceEticoListItem3">The Editorial Board first and then the Board of Directors have the authority to solicit further revisions and suggestions before the draft is approved for publication and after the publishing contract is signed for further information on the development of the manuscript.</li>
                    <li data-lang-key="codiceEticoListItem4">Editorial decisions on manuscripts submitted to scientific journals are made by the journal's editors-in-chief and the journal's scientific committees and are based on independent peer-review reports. The Board of Directors is required to approve the acquisition by L'ERMA of an existing journal or the creation of a new journal. The Board of Directors may take action on changes in policy, ethics, or other matters affecting the running of scientific journals published by L'ERMA, but does not include decisions on the publication of individual articles.</li>
                </ul>
                <p data-lang-key="codiceEticoParaPublishingProcessTransparent">Erma encourages and makes its internal expertise available so that all journals provide their editorial policies transparently through statements. Likewise, all information regarding editorial processes and decisions on the publication of monographs, both individual and in series, is made transparent and accessible.</p>
                <p data-lang-key="codiceEticoParaPublishingProcessContact">If you have any questions or suggestions, please contact the editors of the publishing house at lerma@lerma.it or the magazine of interest.</p>
                <p data-lang-key="codiceEticoParaPublishingProcessAbuse">Abusive behaviour or submissions against L'ERMA staff and others involved in the publication process on behalf of the publishing house will not be tolerated. This type of behaviour can be sanctioned, for instance, by the rejection of a manuscript or by objecting to clearly abusive comments during the peer review process.</p>

                <h3 class="text-2xl font-bold mt-6 mb-3 text-gray-800" data-lang-key="codiceEticoH3PeerReview">III. Peer-review</h3>
                <p data-lang-key="codiceEticoParaPeerReview1">Peer review is essential to maintain and guarantee the high-quality standards of L'ERMA's publications.</p>
                <p data-lang-key="codiceEticoParaPeerReviewCommitment">The commitment of the publishing house is therefore to:</p>
                <ul class="list-disc ml-6 space-y-2">
                    <li data-lang-key="codiceEticoPeerReviewListItem1">provide adequate systems and support to facilitate rigorous, fair, and effective peer review for all publications;</li>
                    <li data-lang-key="codiceEticoPeerReviewListItem2">invite editors of scientific series and journals and peer reviewers to familiarise themselves with these guidelines and those available on the publisher's website, which conform to the best practices of peer reviewing;</li>
                    <li data-lang-key="codiceEticoPeerReviewListItem3">ensure, through its drafting, that the peer review process is conducted following the principles of integrity described above and intervene in the event of fraudulent practices or manipulation;</li>
                    <li data-lang-key="codiceEticoPeerReviewListItem4">protect the confidentiality of persons involved in the peer review process when anonymity is an integral part of the review process for a given publication. The publishing house demands the same compliance with confidentiality agreements from publishing partners, authors, and peer reviewers for each published book or journal.</li>
                </ul>

                <h3 class="text-2xl font-bold mt-6 mb-3 text-gray-800" data-lang-key="codiceEticoH3AuthorsEditors">IV. Authors and Editors</h3>
                <p data-lang-key="codiceEticoParaAuthorsEditors1">Publication formats may have different standards to which authors conform depending on the different disciplines. In the absence of other guidelines, L'ERMA recommends that authors adhere to the following principles, which are also stated in the publication contracts that authors are asked to sign as soon as the Board has approved the project and started the production phase:</p>
                <ul class="list-disc ml-6 space-y-2">
                    <li data-lang-key="codiceEticoAuthorsEditorsListItem1">conceptualization and planning of work, acquisition, analysis, and interpretation of research data;</li>
                    <li data-lang-key="codiceEticoAuthorsEditorsListItem2">editing and/or critical revisions of works aimed at producing high-quality intellectual content;</li>
                    <li data-lang-key="codiceEticoAuthorsEditorsListItem3">final 'Send-to-Press' approval of the version to be published;</li>
                    <li data-lang-key="codiceEticoAuthorsEditorsListItem4">the assumption of responsibility for all aspects of the work and the assurance that questions concerning the accuracy or integrity of any part of the work have been adequately examined at the time of delivery.</li>
                </ul>
                <p data-lang-key="codiceEticoParaAuthorsEditorsResponsibilities">The specific responsibilities of editors and corresponding authors include:</p>
                <ul class="list-disc ml-6 space-y-2">
                    <li data-lang-key="codiceEticoAuthorsEditorsListItem5">the editing of manuscripts and proofs, the management of reviews, and the resubmission of reviewed manuscripts until acceptance;</li>
                    <li data-lang-key="codiceEticoAuthorsEditorsListItem6">signing the publishing contract of any co-authors or the publisher, with the proxy of the co-authors;</li>
                    <li data-lang-key="codiceEticoAuthorsEditorsListItem7">acting as spokesperson on behalf of all co-authors on issues related to publishing ethics, re-use of content, or availability of data, materials, resources, etc.</li>
                </ul>
                <p data-lang-key="codiceEticoParaAuthorsEditorsSupport">The publishing house supports authors in disputes over authorship and the acquisition and use of identifiers according to international industry standards (e.g. Open Researcher and Contributor ID - ORCID and International Standard Name Identifier - ISNI -).</p>

                <h3 class="text-2xl font-bold mt-6 mb-3 text-gray-800" data-lang-key="codiceEticoH3Affiliations">V. Affiliations</h3>
                <p data-lang-key="codiceEticoParaAffiliations">All affiliations of L'ERMA's publications must represent the institution(s) where the research presented was conducted and/or supported and/or approved. In the case of outreach content, each affiliation must represent the institution or institutions with which each author is affiliated.</p>

                <h3 class="text-2xl font-bold mt-6 mb-3 text-gray-800" data-lang-key="codiceEticoH3FreedomOfSpeech">VI. Freedom of speech and censorship</h3>
                <p data-lang-key="codiceEticoParaFreedomOfSpeech">L'ERMA is fully committed to the promotion of the principle of freedom of speech and expression. The publishing house aims to disseminate knowledge to the widest possible audience and to serve the academic community. In this regard, L'ERMA is also inspired by the COPE Position Statement on Censorship (2018).</p>

                <h3 class="text-2xl font-bold mt-6 mb-3 text-gray-800" data-lang-key="codiceEticoH3IntellectualProperty">VII. Intellectual Property Protection and Plagiarism</h3>
                <p data-lang-key="codiceEticoParaIntellectualProperty1">L'ERMA does not tolerate plagiarism in any of its publications and reserves the right to verify the originality of works to be published by appropriate means. Contributions suspected of plagiarism, in whole or in part, are rejected. If plagiarism is discovered after publication, the Board of Directors of the publishing house shall take proportionate measures, such as withdrawing or requesting correction.</p>
                <p data-lang-key="codiceEticoParaIntellectualPropertyMayOccur">Plagiarism may occur concerning all types of sources and media, including:</p>
                <ul class="list-disc ml-6 space-y-2">
                    <li data-lang-key="codiceEticoIntellectualPropertyListItem1">texts, illustrations, musical quotations, source code, etc;</li>
                    <li data-lang-key="codiceEticoIntellectualPropertyListItem2">material downloaded from websites or taken from manuscripts or other media;</li>
                    <li data-lang-key="codiceEticoIntellectualPropertyListItem3">published and unpublished material, including lectures, presentations, and grey literature.</li>
                </ul>
                <p data-lang-key="codiceEticoParaIntellectualPropertyReport">Readers, reviewers, and editors are invited to report any suspected plagiarism by contacting the publisher by e-mail at lerma@lerma.it.</p>

                <h3 class="text-2xl font-bold mt-6 mb-3 text-gray-800" data-lang-key="codiceEticoH3Duplication">VIII. Duplication of publication</h3>
                <p data-lang-key="codiceEticoParaDuplication1">Duplicate or redundant publication, or 'self-plagiarism' occurs when a work, or parts of it, is published more than once by the author(s) without adequate cross-reference or justification for the overlap.</p>
                <p data-lang-key="codiceEticoParaDuplication2">This can take place either in the same language or in a different language.</p>
                <p data-lang-key="codiceEticoParaDuplicationAccepted">Substantial overlap between publications can only be accepted if:</p>
                <ul class="list-disc ml-6 space-y-2">
                    <li data-lang-key="codiceEticoDuplicationListItem1">you believe that from an editorial point of view this strengthens the academic discourse;</li>
                    <li data-lang-key="codiceEticoDuplicationListItem2">you have a clear endorsement from the original publication;</li>
                    <li data-lang-key="codiceEticoDuplicationListItem3">the citation of the source has been included.</li>
                </ul>
                <p data-lang-key="codiceEticoParaDuplicationSubmission">When authors submit a manuscript for publication as a stand-alone monograph, in a L'ERMA journal or series, these manuscripts must not have been submitted to another publishing house, accepted for publication or printing in another journal, series, or otherwise.</p>
                <p data-lang-key="codiceEticoParaDuplicationPreprint">However, depositing a pre-print on the author's website, in an institutional repository, or a pre-print archive is permitted as it is not considered a previous publication or duplicate.</p>
                <p data-lang-key="codiceEticoParaDuplicationReport">Readers, reviewers, and editors are encouraged to report any suspicion of duplication by contacting the publisher at lerma@lerma.it.</p>

                <h3 class="text-2xl font-bold mt-6 mb-3 text-gray-800" data-lang-key="codiceEticoH3PersonalData">IX. Processing of personal data</h3>
                <p data-lang-key="codiceEticoParaPersonalData">Scientific research involving people must comply with the rules on the processing of personal data (EU Regulation 679/2016 and implementing Legislative Decree 101/2018) and comply with international ethical and legal standards for research. Authors are required to respect the privacy rights of participants and obtain consent for publication before submitting the manuscript.</p>

                <h3 class="text-2xl font-bold mt-6 mb-3 text-gray-800" data-lang-key="codiceEticoH3ConflictsOfInterests">X. Conflict of interests and financing</h3>
                <p data-lang-key="codiceEticoParaConflictsOfInterests1">L'ERMA is committed to ensuring that its publications are free from undue influence. Authors, L'ERMA staff, editors, and reviewers of L'ERMA publications are required to declare any potential competing interests that may interfere with the objectivity or integrity of a publication.</p>
                <p data-lang-key="codiceEticoParaConflictsOfInterests2">Conflicts of interest may arise in situations that are considered to unduly influence the submission, review, or publication of a work and may be financial, non-financial, professional, contractual, or personal in nature.</p>
                <p data-lang-key="codiceEticoParaConflictsOfInterestsReport">Anyone who suspects an undeclared conflict of interest regarding a work published or under consideration at L'ERMA must inform the publisher.</p>

                <h3 class="text-2xl font-bold mt-6 mb-3 text-gray-800" data-lang-key="codiceEticoH3Calumny">XI. Calumny, defamation, and freedom of speech</h3>
                <p data-lang-key="codiceEticoParaCalumny">Freedom of speech is fundamental for an academic publisher. Erma ensures that no false statements are published that could damage the reputation of individuals, groups, or organizations.</p>

                <h3 class="text-2xl font-bold mt-6 mb-3 text-gray-800" data-lang-key="codiceEticoH3Retractions">XII. Retractions and corrections</h3>
                <p data-lang-key="codiceEticoParaRetractions1">Journal editors will handle retractions and corrections in line with the COPE guidelines on retractions. In case of author errors, the journal will publish a correction via the editor-in-chief. If the error(s) are due to the journal, the journal will correct itself by publishing an erratum/errata corrige.</p>
                <p data-lang-key="codiceEticoParaRetractions2">Retractions usually concern articles with serious limitations due to unreliable results or conclusions, or that contain substantial plagiarism. Editors of journals that publish manuscripts that have already undergone review may make minor changes, such as typesetting or proofreading, but any substantial corrections will be made in line with the above retraction guidelines.</p>
                <p data-lang-key="codiceEticoParaRetractions3">Exceptionally, the publishing house may be required to remove an article published online in compliance with legal obligations, such as in cases of defamation, violation of privacy, or confidentiality. In these circumstances, the removal of the article will coincide with a notice clearly stating the reason for the removal of the full article.</p>
                <p data-lang-key="codiceEticoParaRetractionsMonographs">In the case of monographs, the reporting of any legal, ethical, or safety issues will be followed by immediate notification to the author and a commitment from the publishing house to investigate the circumstances. If the problem concerns the integrity or accuracy of the content itself, a correction or retraction and withdrawal from sale may be considered. If a piece of content is withdrawn, the integrity of other affiliated works (e.g. other volumes in a series) will still be preserved.</p>
                <p data-lang-key="codiceEticoParaRetractionsMisconduct">If a publication is found to be the result of research misconduct or fraud, it will be retracted or subjected to appropriate correction.</p>

                <h3 class="text-2xl font-bold mt-6 mb-3 text-gray-800" data-lang-key="codiceEticoH3ImageManipulation">XIII. Image manipulation, forgery, and fabrication</h3>
                <p data-lang-key="codiceEticoParaImageManipulation">When research data are collected or presented in the form of images, their modification may misrepresent the results obtained or their meaning. Modification of images is not permitted when it leads to falsification, fabrication, or misrepresentation of the results presented.</p>

                <h3 class="text-2xl font-bold mt-6 mb-3 text-gray-800" data-lang-key="codiceEticoH3SubsidiaryLicenses">XIV. Subsidiary licenses and rights</h3>
                <p data-lang-key="codiceEticoParaSubsidiaryLicenses">L'ERMA grants licenses and subsidiary rights to third parties allowing the reproduction, reuse, or adaptation of the content, originally published by the publishing house, in different contexts, languages, and territories. However, this is subject to refusal of approval for publication in the event of doubts about the integrity and accuracy of the licensed edition.</p>

                <h3 class="text-2xl font-bold mt-6 mb-3 text-gray-800" data-lang-key="codiceEticoH3ResearchData">XV. Research data management</h3>
                <p data-lang-key="codiceEticoParaResearchData1">L'ERMA supports the transparency and openness of data and other materials associated with research. Therefore, authors are encouraged to maintain accurate records of data generated in the context of a specific research activity, necessary to validate results. Where appropriate and allowed, the publisher encourages authors to:</p>
                <ul class="list-disc ml-6 space-y-2">
                    <li data-lang-key="codiceEticoResearchDataListItem1">deposit the data in a repository, or appropriate storage location, for further sharing and use;</li>
                    <li data-lang-key="codiceEticoResearchDataListItem2">indicate the repository in a data availability statement that authors may include in the paratext of their publication.</li>
                </ul>
                <p data-lang-key="codiceEticoParaResearchData2">L'ERMA provides authors with guidance and support regarding the possibility of linking their research data to the publication, either on the publisher's platform or through third-party services.</p>

                <h3 class="text-2xl font-bold mt-6 mb-3 text-gray-800" data-lang-key="codiceEticoH3IntegrityOfRecords">XVI. Integrity of records</h3>
                <p data-lang-key="codiceEticoParaIntegrityOfRecords1">The publishing house maintains at least three records of its publications with the relevant bibliographic metadata, the first on its platform, the second in the L'ERMA catalogue (both in print and digital format), then in the Index of the National Library Service (ISBN print/USB digital), the third in the digital library of a bibliographic service aggregator.</p>
                <p data-lang-key="codiceEticoParaIntegrityOfRecords2">In marketing activities, representations of scientific content published by L'ERMA are not altered or manipulated in any way.</p>
                <p data-lang-key="codiceEticoParaIntegrityOfRecords3">When a product (chapter, article, monograph, or journal) is purchased or subscribed to, it is provided in its entirety to the customer, who has no right to alter its content in any way that does not comply with the terms of the license under which it was published.</p>

                <h3 class="text-2xl font-bold mt-6 mb-3 text-gray-800" data-lang-key="codiceEticoH3Marketing">XVII. Marketing communications via social media</h3>
                <p data-lang-key="codiceEticoParaMarketing1">Social media, press releases, and mailing lists are powerful tools to spread L'ERMA's publications and reach new readers. To follow best practices in the use of media, the publishing house uses the social media platforms: Facebook, Instagram, X.</p>
                <p data-lang-key="codiceEticoParaMarketing2">Any social media communication campaigns entrusted to third parties are always carried out in agreement with the Communication Office.</p>

                <h3 class="text-2xl font-bold mt-6 mb-3 text-gray-800" data-lang-key="codiceEticoH3Advertising">XVIII. Advertising</h3>
                <p data-lang-key="codiceEticoParaAdvertising1">L'ERMA's business model is based on appropriate and targeted advertising. Editorial products and customer services are advertised through the online website and the annual publishing catalogue, available in both print and digital versions.</p>
                <p data-lang-key="codiceEticoParaAdvertising2">Where present, advertising must: be independent of editorial decisions on what L'ERMA publishes; be distinct from the content.</p>
                <p data-lang-key="codiceEticoParaAdvertising3">L'ERMA reserves the right to reject or remove any advertisement if it believes it conflicts with the Ethical Guidelines for Academic Research Publishing or its Code of Ethics. This is done under the guidelines of the Advertising Standards Authority.</p>
                <p class="text-sm text-gray-500 mt-8" data-lang-key="codiceEticoLastUpdated">Last updated 27 February 2024</p>
            </div>
        </section>

        <!-- Norme Editoriali Section -->
        <section id="normeEditorialiView" class="hidden bg-neutral-50 p-6 rounded-xl shadow-lg">
            <h2 class="text-3xl font-bold mb-6 text-center text-gray-800" data-lang-key="normeEditorialiTitle">Editorial Guidelines - Norme Redazionali</h2>
            <div class="prose max-w-none text-gray-700 leading-relaxed space-y-4">
                <p class="text-lg font-semibold" data-lang-key="normeEditorialiSubmissionInfo">Articles must be submitted to:</p>
                <ul class="list-disc ml-6 space-y-1">
                    <li><a href="mailto:redazione@quadalibya.it" class="text-blue-600 hover:underline">redazione@quadalibya.it</a></li>
                    <li><a href="mailto:laura.buccino@quadalibya.it" class="text-blue-600 hover:underline">laura.buccino@quadalibya.it</a></li>
                </ul>

                <h3 class="text-2xl font-bold mt-6 mb-3 text-gray-800" data-lang-key="normeEditorialiH3SubmissionProcedure">Submission Procedure:</h3>
                <ul class="list-disc ml-6 space-y-2">
                    <li data-lang-key="normeEditorialiListItem1">Contributions should be sent in digital format .doc (Microsoft Word) as an e-mail attachment.</li>
                    <li data-lang-key="normeEditorialiListItem2">The contents will be reviewed by at least two anonymous readers and if necessary, will be returned to the author for eventual corrections and changes.</li>
                    <li data-lang-key="normeEditorialiListItem3">Only one set of proofs will be sent to the authors who are expected to correct and return them by the deadline set by the editors.</li>
                    <li data-lang-key="normeEditorialiListItem4">With regard to illustrations, a file including captions and photograph credits should be sent separately. The text should be accompanied by a digital copy of the images to be published (please, use WeTransfer if images are too heavy to be sent as email attachments).</li>
                    <li data-lang-key="normeEditorialiListItem5">The images must be in JPG or TIFF formats and at a minimum resolution of 300 dpi (pixel definition). All images submitted for publication should comply with the copyright rules and there must be an agreement (or a release form) about image reproduction by the copyright owner prior to publication. The author is sole responsible for securing such permits. No image without such accompanying documents will be published.</li>
                </ul>

                <h3 class="text-2xl font-bold mt-6 mb-3 text-gray-800" data-lang-key="normeEditorialiH3ArticleRequirements">Article Requirements:</h3>
                <ul class="list-disc ml-6 space-y-2">
                    <li data-lang-key="normeEditorialiArticleReqListItem1">An abstract of ca. 500 characters / 100 words in the language of the text and in English.</li>
                    <li data-lang-key="normeEditorialiArticleReqListItem2">Title in English.</li>
                    <li data-lang-key="normeEditorialiArticleReqListItem3">5 Keywords in Italian and English.</li>
                    <li data-lang-key="normeEditorialiArticleReqListItem4">Footnotes.</li>
                    <li data-lang-key="normeEditorialiArticleReqListItem5">Address and email address of the author.</li>
                    <li data-lang-key="normeEditorialiArticleReqListItem6">Institutional affiliation of the author.</li>
                </ul>

                <h3 class="text-2xl font-bold mt-6 mb-3 text-gray-800" data-lang-key="normeEditorialiH3FormattingGuidelines">Formatting Guidelines:</h3>
                <ul class="list-disc ml-6 space-y-2">
                    <li data-lang-key="normeEditorialiFormattingListItem1">Quotes are inserted within double quotation marks "...".</li>
                    <li data-lang-key="normeEditorialiFormattingListItem2">Single quotation marks are used to emphasize specific words or expressions '...'.</li>
                    <li data-lang-key="normeEditorialiFormattingListItem3">Transliterations from other languages (as, for example, from Greek or Arabic) are italicized.</li>
                    <li data-lang-key="normeEditorialiFormattingListItem4">If special characters are used in the text (such as in the case of Greek), the font should be specified.</li>
                    <li data-lang-key="normeEditorialiFormattingListItem5">Latin and Greek sources must be cited using the abbreviations in: Thesaurus Linguae Latinae, The Online Liddell-Scott-Jones Greek-English Lexicon (http://stephanus.tlg.uci.edu/lsj/01-authors_and_works.html) and, if not present, G.W.H. LAMPE, A Patristic Greek Lexicon, Oxford 1961.</li>
                </ul>

                <h3 class="text-2xl font-bold mt-6 mb-3 text-gray-800" data-lang-key="normeEditorialiH3CommonAbbreviations">Commonly-used Abbreviations:</h3>
                <ul class="list-disc ml-6 space-y-1">
                    <li>cat. = catalogue</li>
                    <li>cf. = confer</li>
                    <li>cm = centimeters</li>
                    <li>col./cols = column/columns</li>
                    <li>EAD. (small caps) = Eadem</li>
                    <li>etc. = eccetera</li>
                    <li>f./ff. = following / followings</li>
                    <li>fig./figs = figure / figures</li>
                    <li>fol. / fols = folio / folios</li>
                    <li>ID. (small caps) = Idem</li>
                    <li>IID. (small caps) = Iidem</li>
                    <li>l./ll. = line / lines</li>
                    <li>No. inv. = inventory number</li>
                    <li>m = meters</li>
                    <li>ms. / mss = manuscript / manuscripts</li>
                    <li>no. / nos = number / numbers</li>
                    <li>n.d. = no date</li>
                    <li>n.p. = no place</li>
                    <li>note = note</li>
                    <li>p./pp. = page/pages</li>
                    <li>see = see</li>
                    <li>s.v. (italics) = sub voce</li>
                    <li>pl./pls = plate / plates</li>
                    <li>vol. / vols = volume / volumes</li>
                </ul>
                <p class="text-sm text-gray-500 mt-8" data-lang-key="normeEditorialiNote">Note: This is a summary of the full editorial guidelines. For complete bibliographic rules, please refer to the comprehensive document.</p>
            </div>
        </section>


        <!-- About Us Section -->
        <section id="aboutView" class="hidden bg-neutral-50 p-6 rounded-xl shadow-lg">
            <h2 class="text-3xl font-bold mb-6 text-center text-gray-800" data-lang-key="aboutTitle">About Quaderni di Archeologia della Libya</h2>
            <div class="prose max-w-none text-gray-700 leading-relaxed space-y-4">
                <p data-lang-key="aboutPara1">Welcome to the official website for <strong>Quaderni di Archeologia della Libya</strong>, a prestigious academic journal dedicated to archaeological research in Libya. Initiated in 1950, this esteemed series documents the significant contributions of Italian archaeological missions in the region, fostering a deeper understanding of its rich ancient history.</p>
                <p data-lang-key="aboutPara2">After a brief hiatus, the journal proudly resumed publication in 2018 with a new series, re-establishing itself as a leading scientific platform. We provide an essential venue for scholars interested in the archaeology and history of Libya and the broader Maghreb, ensuring high-quality, peer-reviewed content.</p>
                <p data-lang-key="aboutPara3">Our volumes embrace a multidisciplinary approach, featuring articles on epigraphy, ancient and colonial history, the history of archaeology, and territorial studies. Contributions are published in major European languages, complemented by comprehensive English and Arabic abstracts, to promote international academic exchange and collaboration.</p>
                <p data-lang-key="aboutPara4">This website serves as a dedicated resource for the series, maintained by L'Erma di Bretschneider, a renowned academic publishing house in Rome. We are committed to upholding the highest standards of scholarly excellence and ensuring the continued global dissemination of groundbreaking research presented in the "Quaderni di Archeologia della Libya."</p>
            </div>
        </section>

        <!-- Contact Us Section -->
        <section id="contactView" class="hidden bg-neutral-50 p-6 rounded-xl shadow-lg">
            <h2 class="text-3xl font-bold mb-6 text-center text-gray-800" data-lang-key="contactTitle">Contact Us</h2>
            <div class="text-gray-700 space-y-4">
                <p><strong class="font-semibold" data-lang-key="contactEmailLabel">Email:</strong> <a href="mailto:lerma@lerma.it" class="text-blue-600 hover:underline">lerma@lerma.it</a></p>
                <p><strong class="font-semibold" data-lang-key="contactPhoneLabel">Phone:</strong> +39 06 6874127</p>
                <p><strong class="font-semibold" data-lang-key="contactAddressLabel">Address:</strong></p>
                <address class="not-italic">
                    L'Erma di Bretschneider<br>
                    Via Marianna Dionigi, 57<br>
                    00193 Roma RM, Italy
                </address>
                <p data-lang-key="contactMessage">For inquiries regarding publications of "Quaderni di Archeologia della Libya" or other scholarly initiatives, please feel free to reach out to L'Erma di Bretschneider through the contact information provided above.</p>
            </div>
        </section>

        <!-- Admin Login Section -->
        <section id="adminLoginView" class="hidden bg-neutral-50 p-8 rounded-xl shadow-lg max-w-md mx-auto">
            <h2 class="text-3xl font-bold mb-8 text-center text-gray-800" data-lang-key="adminLoginTitle">Admin Login</h2>
            <form id="adminLoginForm" class="space-y-6">
                <div>
                    <label for="username" class="block text-gray-700 text-sm font-semibold mb-2" data-lang-key="usernameLabel">Username (Email):</label>
                    <input type="email" id="username" name="username" required class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500">
                </div>
                <div>
                    <label for="password" class="block text-gray-700 text-sm font-semibold mb-2" data-lang-key="passwordLabel">Password:</label>
                    <input type="password" id="password" name="password" required class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500">
                </div>
                <button type="submit" class="w-full bg-stone-600 hover:bg-stone-700 text-white font-semibold py-3 rounded-lg shadow-md transition duration-300 transform hover:scale-105" data-lang-key="loginButton">Login</button>
            </form>
            <p class="text-center text-sm text-gray-500 mt-4" data-lang-key="firebaseAuthHint">Use your Firebase Auth admin email and password.</p>
            <p class="text-sm text-red-500 mt-2 text-center" id="loginErrorMessage"></p>
        </section>

        <!-- Admin Dashboard Section -->
        <section id="adminDashboardView" class="hidden bg-neutral-50 p-8 rounded-xl shadow-lg">
            <div class="flex flex-col sm:flex-row justify-between items-center mb-6 gap-4">
                <h2 class="text-3xl font-bold text-gray-800" data-lang-key="adminDashboardTitle">Admin Dashboard</h2>
                <button id="adminLogoutBtn" class="bg-red-600 hover:bg-red-700 text-white font-semibold py-2 px-4 rounded-lg shadow-md transition duration-300 transform hover:scale-105" data-lang-key="logoutButton">Logout</button>
            </div>

            <!-- Upload/Edit New Book Form -->
            <div class="mb-8 p-6 border border-gray-200 rounded-xl shadow-sm">
                <h3 id="formTitle" class="text-2xl font-bold mb-4 text-gray-800" data-lang-key="uploadNewPublicationTitle">Upload New Publication</h3>
                <form id="uploadBookForm" class="space-y-4">
                    <div>
                        <label for="bookTitle" class="block text-gray-700 text-sm font-semibold mb-2" data-lang-key="bookTitleLabel">Title:</label>
                        <input type="text" id="bookTitle" required class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500">
                    </div>
                    <div>
                        <label for="bookAuthor" class="block text-gray-700 text-sm font-semibold mb-2" data-lang-key="bookAuthorLabel">Author:</label>
                        <input type="text" id="bookAuthor" required class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500">
                    </div>
                    <div>
                        <label for="bookDescription" class="block text-gray-700 text-sm font-semibold mb-2" data-lang-key="bookDescriptionLabel">Description:</label>
                        <textarea id="bookDescription" rows="3" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"></textarea>
                    </div>

                    <!-- New Metadata Fields -->
                    <div>
                        <label for="bookPages" class="block text-gray-700 text-sm font-semibold mb-2" data-lang-key="bookPagesLabel">Pages:</label>
                        <input type="text" id="bookPages" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500" placeholder="e.g., 258 pp.">
                    </div>
                    <div>
                        <label for="bookFormat" class="block text-gray-700 text-sm font-semibold mb-2" data-lang-key="bookFormatLabel">Format:</label>
                        <input type="text" id="bookFormat" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500" placeholder="e.g., Brossura, 21,5 x 28 cm">
                    </div>
                    <div>
                        <label for="bookDoi" class="block text-gray-700 text-sm font-semibold mb-2" data-lang-key="bookDoiLabel">DOI:</label>
                        <input type="text" id="bookDoi" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500" placeholder="e.g., 10.48255/...">
                    </div>
                    <div>
                        <label for="bookIsbn" class="block text-gray-700 text-sm font-semibold mb-2" data-lang-key="bookIsbnLabel">ISBN:</label>
                        <input type="text" id="bookIsbn" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500" placeholder="e.g., 9788891332295">
                    </div>
                    <div>
                        <label for="bookIssn" class="block text-gray-700 text-sm font-semibold mb-2" data-lang-key="bookIssnLabel">ISSN:</label>
                        <input type="text" id="bookIssn" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500" placeholder="e.g., 0079-8258">
                    </div>
                    <div class="flex items-center">
                        <input type="checkbox" id="bookIsNew" class="h-4 w-4 text-blue-600 border-gray-300 rounded focus:ring-blue-500">
                        <label for="bookIsNew" class="ml-2 block text-gray-700 text-sm font-semibold" data-lang-key="bookIsNewLabel">Novelty (New Publication)</label>
                    </div>

                    <div>
                        <label for="coverImageFile" class="block text-gray-700 text-sm font-semibold mb-2" data-lang-key="uploadCoverImageLabel">Upload Cover Image:</label>
                        <input type="file" id="coverImageFile" accept="image/png, image/jpeg, image/gif" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500">
                        <p id="coverImageFileNameDisplay" class="text-sm text-gray-600 mt-1"></p>
                        <img id="uploadedCoverPreview" src="" alt="Uploaded Cover Preview" class="mt-4 max-w-xs h-auto rounded-lg shadow-md" style="display:none;">
                    </div>
                    <div>
                        <label for="pdfFile" class="block text-gray-700 text-sm font-semibold mb-2" data-lang-key="uploadPdfFileLabel">Upload PDF File:</label>
                        <input type="file" id="pdfFile" accept=".pdf" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500">
                        <p id="pdfFileNameDisplay" class="text-sm text-gray-600 mt-1"></p>
                    </div>
                    <div class="flex flex-col sm:flex-row space-y-2 sm:space-y-0 sm:space-x-4">
                        <button type="submit" id="submitBookBtn" class="w-full sm:w-1/2 bg-blue-600 hover:bg-blue-700 text-white font-semibold py-3 rounded-lg shadow-md transition duration-300 transform hover:scale-105" data-lang-key="addPublicationButton">Add Publication</button>
                        <button type="button" id="cancelEditBtn" class="w-full sm:w-1/2 bg-gray-400 hover:bg-gray-500 text-white font-semibold py-3 rounded-lg shadow-md transition duration-300 transform hover:scale-105 hidden" data-lang-key="cancelEditButton">Cancel Edit</button>
                    </div>
                </form>
            </div>

            <!-- Existing Publications List -->
            <div class="p-6 border border-gray-200 rounded-xl shadow-sm">
                <h3 class="text-2xl font-bold mb-4 text-gray-800" data-lang-key="existingPublicationsTitle">Existing Publications</h3>
                <div id="adminBooksList" class="space-y-4">
                    <!-- Books will be loaded here for admin by JavaScript -->
                    <p class="text-center text-gray-500" id="noAdminBooksMessage" data-lang-key="noPublicationsUploadedYet">No publications uploaded yet.</p>
                </div>
            </div>
        </section>

    </main>

    <!-- Footer -->
    <footer class="bg-stone-800 text-neutral-100 py-4 mt-8 px-6 md:px-8">
        <div class="container text-center text-sm">
            <p>&copy; <span id="currentYear"></span> <span data-lang-key="footerCopyright">L'Erma di Bretschneider. All rights reserved.</span></p>
            <p class="text-neutral-300" data-lang-key="footerDataStorage">Website data is stored securely using Firebase services.</p>
            <p class="text-neutral-300" data-lang-key="footerUserId">Logged in User ID: <span id="currentUserId" class="font-mono"></span></p>
        </div>
    </footer>

    <!-- Firebase SDKs -->
    <script type="module">
        // Import the functions you need from the SDKs you need
        import { initializeApp, getApps, getApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
        import { getAuth, /* signInAnonymously, */ onAuthStateChanged, signInWithEmailAndPassword, signOut } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js";
        import { getFirestore, collection, addDoc, doc, updateDoc, deleteDoc, onSnapshot, query, getDoc } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";
        import { getStorage, ref, uploadBytes, getDownloadURL, deleteObject } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-storage.js";

        // Your actual web app's Firebase configuration
        // This MUST be replaced with YOUR unique config from Firebase Console -> Project settings -> Your apps -> Web app
        const firebaseConfig = {
            apiKey: "AIzaSyDy3cgr5QWdZ_n85Kh5IyZc5nVpkrOmYQM",
            authDomain: "charlieslab-demo-site.firebaseapp.com",
            projectId: "charlieslab-demo-site",
            storageBucket: "charlieslab-demo-site.firebasestorage.app",
            messagingSenderId: "21859165806",
            appId: "1:21859165806:web:e5d12c15ded14a93ffe87f",
            measurementId: "G-ZTYJPB011E"
        };

        // Firebase Initialization
        let db;
        let auth;
        let storage; // Declare storage variable
        let userId = null;
        let isLoggedIn = false; // Simple client-side state
        let isAuthReady = false; // Flag to indicate if auth state has been checked

        // --- Translation Logic ---
        const translations = {
            en: {
                pageTitle: "Quaderni di Archeologia della Libya - Publications",
                headerTitle: "Quaderni di Archeologia della Libya",
                homeBtn: "Publications",
                codiceEticoBtn: "Code of Ethics",
                normeEditorialiBtn: "Editorial Guidelines",
                aboutBtn: "About Us",
                contactBtn: "Contact Us",
                adminLoginBtn: "Admin Login",
                ourPublicationsTitle: "Our Publications",
                searchPublicationsLabel: "Search Publications",
                searchPlaceholder: "Search by title or author...",
                noPublicationsMessage: "No publications yet. Check back soon!",
                aboutTitle: "About Quaderni di Archeologia della Libya",
                aboutPara1: "Welcome to the official website for <strong>Quaderni di Archeologia della Libya</strong>, a prestigious academic journal dedicated to archaeological research in Libya. Initiated in 1950, this esteemed series documents the significant contributions of Italian archaeological missions in the region, fostering a deeper understanding of its rich ancient history.",
                aboutPara2: "After a brief hiatus, the journal proudly resumed publication in 2018 with a new series, re-establishing itself as a leading scientific platform. We provide an essential venue for scholars interested in the archaeology and history of Libya and the broader Maghreb, ensuring high-quality, peer-reviewed content.",
                aboutPara3: "Our volumes embrace a multidisciplinary approach, featuring articles on epigraphy, ancient and colonial history, the history of archaeology, and territorial studies. Contributions are published in major European languages, complemented by comprehensive English and Arabic abstracts, to promote international academic exchange and collaboration.",
                aboutPara4: "This website serves as a dedicated resource for the series, maintained by L'Erma di Bretschneider, a renowned academic publishing house in Rome. We are committed to upholding the highest standards of scholarly excellence and ensuring the continued global dissemination of groundbreaking research presented in the \"Quaderni di Archeologia della Libya.\"",
                contactTitle: "Contact Us",
                contactEmailLabel: "Email:",
                contactPhoneLabel: "Phone:",
                contactAddressLabel: "Address:",
                contactMessage: "For inquiries regarding publications of \"Quaderni di Archeologia della Libya\" or other scholarly initiatives, please feel free to reach out to L'Erma di Bretschneider through the contact information provided above.",
                adminLoginTitle: "Admin Login",
                usernameLabel: "Username (Email):",
                passwordLabel: "Password:",
                loginButton: "Login",
                firebaseAuthHint: "Use your Firebase Auth admin email and password.",
                adminDashboardTitle: "Admin Dashboard",
                logoutButton: "Logout",
                uploadNewPublicationTitle: "Upload New Publication",
                bookTitleLabel: "Title:",
                bookAuthorLabel: "Author:",
                bookDescriptionLabel: "Description:",
                bookPagesLabel: "Pages:",
                bookFormatLabel: "Format:",
                bookDoiLabel: "DOI:",
                bookIsbnLabel: "ISBN:",
                bookIssnLabel: "ISSN:",
                bookIsNewLabel: "Novelty (New Publication)",
                uploadCoverImageLabel: "Upload Cover Image:",
                uploadPdfFileLabel: "Upload PDF File:",
                addPublicationButton: "Add Publication",
                cancelEditButton: "Cancel Edit",
                existingPublicationsTitle: "Existing Publications",
                noPublicationsUploadedYet: "No publications uploaded yet.",
                footerCopyright: "L'Erma di Bretschneider. All rights reserved.",
                footerDataStorage: "Website data is stored securely using Firebase services.",
                footerUserId: "Logged in User ID:",
                viewDetailsButton: "View Details",
                doiLabel: "DOI:",
                isbnLabel: "ISBN:",
                issnLabel: "ISSN:",
                isNoveltyLabel: "NEW!",
                // Modals
                modalOkBtn: "OK",
                confirmYesBtn: "Yes",
                confirmNoBtn: "No",
                msgFillTitleAuthor: "Please fill in at least the title and author.",
                msgCoverUploaded: "Cover image uploaded to Storage successfully!",
                msgPdfUploaded: "PDF uploaded to Storage successfully!",
                msgPublicationUpdated: "Publication updated successfully!",
                msgPublicationAdded: "Publication added successfully!",
                msgFirebaseStorageRules: "Ensure Firebase Storage rules allow writing.",
                msgBookNotFound: "Book not found for editing.",
                msgErrorLoadingBook: "Error loading book for editing. Please try again.",
                msgConfirmDelete: "Are you sure you want to delete this publication?",
                msgPublicationDeleted: "Publication deleted successfully!",
                msgErrorDeletingPublication: "Error deleting publication. Ensure Firebase Storage rules allow deletion.",
                msgPdfNotAvailable: "PDF not available for this book.",
                msgCurrentCover: "Current:",
                msgNoCurrentCover: "No current cover.",
                msgCurrentPdf: "Current:",
                msgNoCurrentPdf: "No current PDF.",
                msgUpdating: "Updating...",
                msgAdding: "Adding...",
                msgAuthWarning: "No user is authenticated. Public view features requiring authentication may not work.",
                msgNoBooksFoundSearch: "No publications found matching your search. Try a different term.",
                msgErrorLoadingPublications: "Error loading publications. Please try again later.",
                msgErrorLoadingAdminPublications: "Error loading publications for admin. Please try again.",
                msgLoginInvalid: "Invalid email or password.",
                msgLoginTooManyAttempts: "Too many login attempts. Please try again later.",
                msgLoginFailedGeneric: "Login failed: ",
                msgLoggedOut: "Logged out successfully.",
                msgErrorLoggingOut: "Error logging out. Please try again.",
                msgFirebaseConfigInvalid: "Firebase configuration is missing or invalid. Please ensure the app is running in a Firebase-enabled environment with correct config.",
                msgFirebaseInitFailed: "Failed to initialize Firebase. Check console for details.",
                msgPublicContentAuthRequired: "Please log in or enable anonymous access in Firebase for public content.",
                msgSelected: "Selected",
                downloadPdfButton: "Download PDF",
                editButton: "Edit",
                deleteButton: "Delete",
                byAuthor: "by",
                msgNotAvailable: "Not available",
                msgUploading: "Uploading",
                msgUploaded: "Uploaded",
                msgFailedUploadCover: "Failed to upload cover image",
                msgFailedUploadPdf: "Failed to upload PDF",
                msgCheckStorageRulesOrNetwork: "Check storage rules or network.",
                msgUploadFailed: "Upload failed.",
                msgLoginRequiredForUpload: "Please log in as admin before uploading files.",
                msgLoginRequiredToAddEdit: "You must be logged in as an admin to add/edit publications.",
                msgFirebaseNotReady: "Firebase not ready. Please wait a moment.",
                msgSelectPdfWaitUpload: "Please select a PDF file and wait for it to finish uploading.",
                msgSelectCoverWaitUpload: "Please upload a cover image and wait for it to finish uploading.",
                msgPdfMissing: "PDF missing. Please upload a PDF or ensure existing one is valid.",
                msgCoverMissing: "Cover image missing. Please upload a cover image or ensure existing one is valid.",
                msgErrorSavingPublication: "Error saving publication",
                msgCheckFirestoreRules: "Check Firestore rules.",
                editPublicationTitle: "Edit Publication",
                updatePublicationButton: "Update Publication",
                msgNoCoverSelected: "No cover image selected.",
                msgNoPdfSelected: "No PDF file selected.",
                msgEditCancelled: "Edit cancelled.",
                msgLoginRequiredToDelete: "You must be logged in as an admin to delete publications.",
                msgNoDescriptionProvided: "No description provided.",
                msgLoginRequiredToEdit: "You must be logged in as an admin to edit publications.",
                codiceEticoTitle: "Code of Ethics and Malpractice Statement",
                codiceEticoParaPreface: "This document outlines the ethics principles and good practices applied by the publishing house L'ERMA di Bretschneider (hereafter L'ERMA) to the process of editing and publishing monographs, scientific journals, and other editorial content of scientific, educational, and outreach nature. L'ERMA is inspired by the ethical principles outlined by the Committee on Publication Ethics (hereinafter COPE), an international non-profit organization that aims to support publishers and editors in pursuing high standards of publishing ethics. Although COPE mainly provides guidelines and resources for publishers and editors of scientific journals, these can also be applied to the publication of monographs and other academic content.",
                codiceEticoH3ResearchEthics: "I. Research ethics and integrity",
                codiceEticoParaResearchEthics1: "L'ERMA publications respect the ethical principles of COPE, which are: Reliability; honesty, respect, and responsibility in all aspects of research; Care, accuracy, and excellence in research practice; Transparency, reproducibility, traceability, and open communication; Attention and respect for all participants and research subjects.",
                codiceEticoParaResearchEthics2: "If they deem it appropriate, the editors of academic publications and products published by L'ERMA provide authors with specific guidelines and policies based on this document, relating to the principles of research integrity and ethics, according to their subjects and disciplines.",
                codiceEticoParaResearchEthics3: "Whoever believes that research published by L'ERMA has not been conducted in line with these ethical practices is invited to raise the issue with the publisher at lerma@lerma.it. Where possible, each report will be handled following COPE guidelines, and/or by submitting the matter to the Chairman of the Board of Directors of the publishing house and, if necessary, to the members of the Editorial Board of the publishing house.",
                codiceEticoH3PublishingProcess: "II. Publishing process",
                codiceEticoParaPublishingProcess1: "L'ERMA is committed to respecting editorial independence and all its efforts are aimed at ensuring that this principle is not compromised by competing interests or any other influence. Erma adopts practices of non-discrimination of authors, editors, or reviewers based on personal characteristics or identity, with an ongoing commitment to remove any barriers to inclusion and to promote fairness at every stage of the publishing process.",
                codiceEticoParaPublishingProcess2: "L'ERMA welcomes authors of different backgrounds, races and ethnicities, gender identity, sexual orientation, nationality, religion, and disability to publish with them. L'ERMA refuses the predatory practices of academic pseudo-publishers who pursue mere profit at the expense of the progress of research and the quality and scientific value of the works they publish.",
                codiceEticoParaPublishingProcess3: "A board of directors of L'ERMA oversees the publishing program. Members are selected based on their recognized scientific expertise, knowledge, skills, and their agreement with the ethical values of the publishing house. They independently approve publication contracts.",
                codiceEticoParaPublishingProcessRoles: "The roles of the board of Directors are the following:",
                codiceEticoListItem1: "Initially, proposals for the editorial program of monographs are reviewed by the members of the editorial board, which has decision-making autonomy. Nevertheless, the members of the editorial board may consult experts in the field whenever they need to ensure the quality of the editorial product. To facilitate this process, the advisory boards of the different series sign the publication proposal together with a statement on the quality and scientific value of the publication.",
                codiceEticoListItem2: "After a monograph that is not part of a series has been valued as worthy of being considered by L'ERMA, the publishing house sends the proposal and written sample from the manuscript to a minimum of two external and independent advice for and against the publication to the Board of Directors.",
                codiceEticoListItem3: "The Editorial Board first and then the Board of Directors have the authority to solicit further revisions and suggestions before the draft is approved for publication and after the publishing contract is signed for further information on the development of the manuscript.",
                codiceEticoListItem4: "Editorial decisions on manuscripts submitted to scientific journals are made by the journal's editors-in-chief and the journal's scientific committees and are based on independent peer-review reports. The Board of Directors is required to approve the acquisition by L'ERMA of an existing journal or the creation of a new journal. The Board of Directors may take action on changes in policy, ethics, or other matters affecting the running of scientific journals published by L'ERMA, but does not include decisions on the publication of individual articles.",
                codiceEticoParaPublishingProcessTransparent: "Erma encourages and makes its internal expertise available so that all journals provide their editorial policies transparently through statements. Likewise, all information regarding editorial processes and decisions on the publication of monographs, both individual and in series, is made transparent and accessible.",
                codiceEticoParaPublishingProcessContact: "If you have any questions or suggestions, please contact the editors of the publishing house at lerma@lerma.it or the magazine of interest.",
                codiceEticoParaPublishingProcessAbuse: "Abusive behaviour or submissions against L'ERMA staff and others involved in the publication process on behalf of the publishing house will not be tolerated. This type of behaviour can be sanctioned, for instance, by the rejection of a manuscript or by objecting to clearly abusive comments during the peer review process.",
                codiceEticoH3PeerReview: "III. Peer-review",
                codiceEticoParaPeerReview1: "Peer review is essential to maintain and guarantee the high-quality standards of L'ERMA's publications.",
                codiceEticoParaPeerReviewCommitment: "The commitment of the publishing house is therefore to:",
                codiceEticoPeerReviewListItem1: "provide adequate systems and support to facilitate rigorous, fair, and effective peer review for all publications;",
                codiceEticoPeerReviewListItem2: "invite editors of scientific series and journals and peer reviewers to familiarise themselves with these guidelines and those available on the publisher's website, which conform to the best practices of peer reviewing;",
                codiceEticoPeerReviewListItem3: "ensure, through its drafting, that the peer review process is conducted following the principles of integrity described above and intervene in the event of fraudulent practices or manipulation;",
                codiceEticoPeerReviewListItem4: "protect the confidentiality of persons involved in the peer review process when anonymity is an integral part of the review process for a given publication. The publishing house demands the same compliance with confidentiality agreements from publishing partners, authors, and peer reviewers for each published book or journal.",
                codiceEticoH3AuthorsEditors: "IV. Authors and Editors",
                codiceEticoParaAuthorsEditors1: "Publication formats may have different standards to which authors conform depending on the different disciplines. In the absence of other guidelines, L'ERMA recommends that authors adhere to the following principles, which are also stated in the publication contracts that authors are asked to sign as soon as the Board has approved the project and started the production phase:",
                codiceEticoAuthorsEditorsListItem1: "conceptualization and planning of work, acquisition, analysis, and interpretation of research data;",
                codiceEticoAuthorsEditorsListItem2: "editing and/or critical revisions of works aimed at producing high-quality intellectual content;",
                codiceEticoAuthorsEditorsListItem3: "final 'Send-to-Press' approval of the version to be published;",
                codiceEticoAuthorsEditorsListItem4: "the assumption of responsibility for all aspects of the work and the assurance that questions concerning the accuracy or integrity of any part of the work have been adequately examined at the time of delivery.",
                codiceEticoParaAuthorsEditorsResponsibilities: "The specific responsibilities of editors and corresponding authors include:",
                codiceEticoAuthorsEditorsListItem5: "the editing of manuscripts and proofs, the management of reviews, and the resubmission of reviewed manuscripts until acceptance;",
                codiceEticoAuthorsEditorsListItem6: "signing the publishing contract of any co-authors or the publisher, with the proxy of the co-authors;",
                codiceEticoAuthorsEditorsListItem7: "acting as spokesperson on behalf of all co-authors on issues related to publishing ethics, re-use of content, or availability of data, materials, resources, etc.",
                codiceEticoParaAuthorsEditorsSupport: "The publishing house supports authors in disputes over authorship and the acquisition and use of identifiers according to international industry standards (e.g. Open Researcher and Contributor ID - ORCID and International Standard Name Identifier - ISNI -).",
                codiceEticoH3Affiliations: "V. Affiliations",
                codiceEticoParaAffiliations: "All affiliations of L'ERMA's publications must represent the institution(s) where the research presented was conducted and/or supported and/or approved. In the case of outreach content, each affiliation must represent the institution or institutions with which each author is affiliated.",
                codiceEticoH3FreedomOfSpeech: "VI. Freedom of speech and censorship",
                codiceEticoParaFreedomOfSpeech: "L'ERMA is fully committed to the promotion of the principle of freedom of speech and expression. The publishing house aims to disseminate knowledge to the widest possible audience and to serve the academic community. In this regard, L'ERMA is also inspired by the COPE Position Statement on Censorship (2018).",
                codiceEticoH3IntellectualProperty: "VII. Intellectual Property Protection and Plagiarism",
                codiceEticoParaIntellectualProperty1: "L'ERMA does not tolerate plagiarism in any of its publications and reserves the right to verify the originality of works to be published by appropriate means. Contributions suspected of plagiarism, in whole or in part, are rejected. If plagiarism is discovered after publication, the Board of Directors of the publishing house shall take proportionate measures, such as withdrawing or requesting correction.",
                codiceEticoParaIntellectualPropertyMayOccur: "Plagiarism may occur concerning all types of sources and media, including:",
                codiceEticoIntellectualPropertyListItem1: "texts, illustrations, musical quotations, source code, etc;",
                codiceEticoIntellectualPropertyListItem2: "material downloaded from websites or taken from manuscripts or other media;",
                codiceEticoIntellectualPropertyListItem3: "published and unpublished material, including lectures, presentations, and grey literature.",
                codiceEticoParaIntellectualPropertyReport: "Readers, reviewers, and editors are invited to report any suspected plagiarism by contacting the publisher by e-mail at lerma@lerma.it.",
                codiceEticoH3Duplication: "VIII. Duplication of publication",
                codiceEticoParaDuplication1: "Duplicate or redundant publication, or 'self-plagiarism' occurs when a work, or parts of it, is published more than once by the author(s) without adequate cross-reference or justification for the overlap.",
                codiceEticoParaDuplication2: "This can take place either in the same language or in a different language.",
                codiceEticoParaDuplicationAccepted: "Substantial overlap between publications can only be accepted if:",
                codiceEticoDuplicationListItem1: "you believe that from an editorial point of view this strengthens the academic discourse;",
                codiceEticoDuplicationListItem2: "you have a clear endorsement from the original publication;",
                codiceEticoDuplicationListItem3: "the citation of the source has been included.",
                codiceEticoParaDuplicationSubmission: "When authors submit a manuscript for publication as a stand-alone monograph, in a L'ERMA journal or series, these manuscripts must not have been submitted to another publishing house, accepted for publication or printing in another journal, series, or otherwise.",
                codiceEticoParaDuplicationPreprint: "However, depositing a pre-print on the author's website, in an institutional repository, or a pre-print archive is permitted as it is not considered a previous publication or duplicate.",
                codiceEticoParaDuplicationReport: "Readers, reviewers, and editors are encouraged to report any suspicion of duplication by contacting the publisher at lerma@lerma.it.",
                codiceEticoH3PersonalData: "IX. Processing of personal data",
                codiceEticoParaPersonalData: "Scientific research involving people must comply with the rules on the processing of personal data (EU Regulation 679/2016 and implementing Legislative Decree 101/2018) and comply with international ethical and legal standards for research. Authors are required to respect the privacy rights of participants and obtain consent for publication before submitting the manuscript.",
                codiceEticoH3ConflictsOfInterests: "X. Conflict of interests and financing",
                codiceEticoParaConflictsOfInterests1: "L'ERMA is committed to ensuring that its publications are free from undue influence. Authors, L'ERMA staff, editors, and reviewers of L'ERMA publications are required to declare any potential competing interests that may interfere with the objectivity or integrity of a publication.",
                codiceEticoParaConflictsOfInterests2: "Conflicts of interest may arise in situations that are considered to unduly influence the submission, review, or publication of a work and may be financial, non-financial, professional, contractual, or personal in nature.",
                codiceEticoParaConflictsOfInterestsReport: "Anyone who suspects an undeclared conflict of interest regarding a work published or under consideration at L'ERMA must inform the publisher.",
                codiceEticoH3Calumny: "XI. Calumny, defamation, and freedom of speech",
                codiceEticoParaCalumny: "Freedom of speech is fundamental for an academic publisher. Erma ensures that no false statements are published that could damage the reputation of individuals, groups, or organizations.",
                codiceEticoH3Retractions: "XII. Retractions and corrections",
                codiceEticoParaRetractions1: "Journal editors will handle retractions and corrections in line with the COPE guidelines on retractions. In case of author errors, the journal will publish a correction via the editor-in-chief. If the error(s) are due to the journal, the journal will correct itself by publishing an erratum/errata corrige.",
                codiceEticoParaRetractions2: "Retractions usually concern articles with serious limitations due to unreliable results or conclusions, or that contain substantial plagiarism. Editors of journals that publish manuscripts that have already undergone review may make minor changes, such as typesetting or proofreading, but any substantial corrections will be made in line with the above retraction guidelines.",
                codiceEticoParaRetractions3: "Exceptionally, the publishing house may be required to remove an article published online in compliance with legal obligations, such as in cases of defamation, violation of privacy, or confidentiality. In these circumstances, the removal of the article will coincide with a notice clearly stating the reason for the removal of the full article.",
                codiceEticoParaRetractionsMonographs: "In the case of monographs, the reporting of any legal, ethical, or safety issues will be followed by immediate notification to the author and a commitment from the publishing house to investigate the circumstances. If the problem concerns the integrity or accuracy of the content itself, a correction or retraction and withdrawal from sale may be considered. If a piece of content is withdrawn, the integrity of other affiliated works (e.g. other volumes in a series) will still be preserved.",
                codiceEticoParaRetractionsMisconduct: "If a publication is found to be the result of research misconduct or fraud, it will be retracted or subjected to appropriate correction.",
                codiceEticoH3ImageManipulation: "XIII. Image manipulation, forgery, and fabrication",
                codiceEticoParaImageManipulation: "When research data are collected or presented in the form of images, their modification may misrepresent the results obtained or their meaning. Modification of images is not permitted when it leads to falsification, fabrication, or misrepresentation of the results presented.",
                codiceEticoH3SubsidiaryLicenses: "XIV. Subsidiary licenses and rights",
                codiceEticoParaSubsidiaryLicenses: "L'ERMA grants licenses and subsidiary rights to third parties allowing the reproduction, reuse, or adaptation of the content, originally published by the publishing house, in different contexts, languages, and territories. However, this is subject to refusal of approval for publication in the event of doubts about the integrity and accuracy of the licensed edition.",
                codiceEticoH3ResearchData: "XV. Research data management",
                codiceEticoParaResearchData1: "L'ERMA supports the transparency and openness of data and other materials associated with research. Therefore, authors are encouraged to maintain accurate records of data generated in the context of a specific research activity, necessary to validate results. Where appropriate and allowed, the publisher encourages authors to:",
                codiceEticoResearchDataListItem1: "deposit the data in a repository, or appropriate storage location, for further sharing and use;",
                codiceEticoResearchDataListItem2: "indicate the repository in a data availability statement that authors may include in the paratext of their publication.",
                codiceEticoParaResearchData2: "L'ERMA provides authors with guidance and support regarding the possibility of linking their research data to the publication, either on the publisher's platform or through third-party services.",
                codiceEticoH3IntegrityOfRecords: "XVI. Integrity of records",
                codiceEticoParaIntegrityOfRecords1: "The publishing house maintains at least three records of its publications with the relevant bibliographic metadata, the first on its platform, the second in the L'ERMA catalogue (both in print and digital format), then in the Index of the National Library Service (ISBN print/USB digital), the third in the digital library of a bibliographic service aggregator.",
                codiceEticoParaIntegrityOfRecords2: "In marketing activities, representations of scientific content published by L'ERMA are not altered or manipulated in any way.",
                codiceEticoParaIntegrityOfRecords3: "When a product (chapter, article, monograph, or journal) is purchased or subscribed to, it is provided in its entirety to the customer, who has no right to alter its content in any way that does not comply with the terms of the license under which it was published.",
                codiceEticoH3Marketing: "XVII. Marketing communications via social media",
                codiceEticoParaMarketing1: "Social media, press releases, and mailing lists are powerful tools to spread L'ERMA's publications and reach new readers. To follow best practices in the use of media, the publishing house uses the social media platforms: Facebook, Instagram, X.",
                codiceEticoParaMarketing2: "Any social media communication campaigns entrusted to third parties are always carried out in agreement with the Communication Office.",
                codiceEticoH3Advertising: "XVIII. Advertising",
                codiceEticoParaAdvertising1: "L'ERMA's business model is based on appropriate and targeted advertising. Editorial products and customer services are advertised through the online website and the annual publishing catalogue, available in both print and digital versions.",
                codiceEticoParaAdvertising2: "Where present, advertising must: be independent of editorial decisions on what L'ERMA publishes; be distinct from the content.",
                codiceEticoParaAdvertising3: "L'ERMA reserves the right to reject or remove any advertisement if it believes it conflicts with the Ethical Guidelines for Academic Research Publishing or its Code of Ethics. This is done under the guidelines of the Advertising Standards Authority.",
                codiceEticoLastUpdated: "Last updated 27 February 2024",

                normeEditorialiTitle: "Editorial Guidelines - Norme Redazionali",
                normeEditorialiSubmissionInfo: "Articles must be submitted to:",
                normeEditorialiH3SubmissionProcedure: "Submission Procedure:",
                normeEditorialiListItem1: "Contributions should be sent in digital format .doc (Microsoft Word) as an e-mail attachment.",
                normeEditorialiListItem2: "The contents will be reviewed by at least two anonymous readers and if necessary, will be returned to the author for eventual corrections and changes.",
                normeEditorialiListItem3: "Only one set of proofs will be sent to the authors who are expected to correct and return them by the deadline set by the editors.",
                normeEditorialiListItem4: "With regard to illustrations, a file including captions and photograph credits should be sent separately. The text should be accompanied by a digital copy of the images to be published (please, use WeTransfer if images are too heavy to be sent as email attachments).",
                normeEditorialiListItem5: "The images must be in JPG or TIFF formats and at a minimum resolution of 300 dpi (pixel definition). All images submitted for publication should comply with the copyright rules and there must be an agreement (or a release form) about image reproduction by the copyright owner prior to publication. The author is sole responsible for securing such permits. No image without such accompanying documents will be published.",
                normeEditorialiH3ArticleRequirements: "Article Requirements:",
                normeEditorialiArticleReqListItem1: "An abstract of ca. 500 characters / 100 words in the language of the text and in English.",
                normeEditorialiArticleReqListItem2: "Title in English.",
                normeEditorialiArticleReqListItem3: "5 Keywords in Italian and English.",
                normeEditorialiArticleReqListItem4: "Footnotes.",
                normeEditorialiArticleReqListItem5: "Address and email address of the author.",
                normeEditorialiArticleReqListItem6: "Institutional affiliation of the author.",
                normeEditorialiH3FormattingGuidelines: "Formatting Guidelines:",
                normeEditorialiFormattingListItem1: "Quotes are inserted within double quotation marks \"...\".",
                normeEditorialiFormattingListItem2: "Single quotation marks are used to emphasize specific words or expressions '...'.",
                normeEditorialiFormattingListItem3: "Transliterations from other languages (as, for example, from Greek or Arabic) are italicized.",
                normeEditorialiFormattingListItem4: "If special characters are used in the text (such as in the case of Greek), the font should be specified.",
                normeEditorialiFormattingListItem5: "Latin and Greek sources must be cited using the abbreviations in: Thesaurus Linguae Latinae, The Online Liddell-Scott-Jones Greek-English Lexicon (http://stephanus.tlg.uci.edu/lsj/01-authors_and_works.html) and, if not present, G.W.H. LAMPE, A Patristic Greek Lexicon, Oxford 1961.",
                normeEditorialiH3CommonAbbreviations: "Commonly-used Abbreviations:",
                normeEditorialiNote: "Note: This is a summary of the full editorial guidelines. For complete bibliographic rules, please refer to the comprehensive document.",
            },
            it: {
                pageTitle: "Quaderni di Archeologia della Libya - Pubblicazioni",
                headerTitle: "Quaderni di Archeologia della Libya",
                homeBtn: "Pubblicazioni",
                codiceEticoBtn: "Codice Etico",
                normeEditorialiBtn: "Norme Editoriali",
                aboutBtn: "Chi Siamo",
                contactBtn: "Contattaci",
                adminLoginBtn: "Accesso Admin",
                ourPublicationsTitle: "Le Nostre Pubblicazioni",
                searchPublicationsLabel: "Cerca Pubblicazioni",
                searchPlaceholder: "Cerca per titolo o autore...",
                noPublicationsMessage: "Nessuna pubblicazione ancora. Torna presto!",
                aboutTitle: "Chi Siamo Quaderni di Archeologia della Libya",
                aboutPara1: "Benvenuti nel sito ufficiale dei <strong>Quaderni di Archeologia della Libya</strong>, una prestigiosa rivista accademica dedicata alla ricerca archeologica in Libia. Iniziata nel 1950, questa stimata serie documenta i significativi contributi delle missioni archeologiche italiane nella regione, promuovendo una comprensione pi approfondita della sua ricca storia antica.",
                aboutPara2: "Dopo una breve interruzione, la rivista ha ripreso con orgoglio la pubblicazione nel 2018 con una nuova serie, ristabilendosi come una delle principali piattaforme scientifiche. Offriamo una sede essenziale per gli studiosi interessati all'archeologia e alla storia della Libia e del Maghreb, garantendo contenuti di alta qualit e sottoposti a revisione paritaria.",
                aboutPara3: "I nostri volumi adottano un approccio multidisciplinare, presentando articoli su epigrafia, storia antica e coloniale, storia dell'archeologia e studi territoriali. I contributi sono pubblicati nelle principali lingue europee, integrati da abstract completi in inglese e arabo, per promuovere lo scambio e la collaborazione accademica internazionale.",
                aboutPara4: "Questo sito web funge da risorsa dedicata alla serie, gestito da L'Erma di Bretschneider, una rinomata casa editrice accademica di Roma. Ci impegniamo a mantenere i pi alti standard di eccellenza accademica e a garantire la continua diffusione globale delle ricerche innovative presentate nei \"Quaderni di Archeologia della Libya.\"",
                contactTitle: "Contattaci",
                contactEmailLabel: "Email:",
                contactPhoneLabel: "Telefono:",
                contactAddressLabel: "Indirizzo:",
                contactMessage: "Per domande relative alle pubblicazioni di \"Quaderni di Archeologia della Libya\" o ad altre iniziative accademiche, non esitate a contattare L'Erma di Bretschneider tramite le informazioni di contatto fornite sopra.",
                adminLoginTitle: "Accesso Admin",
                usernameLabel: "Nome Utente (Email):",
                passwordLabel: "Password:",
                loginButton: "Accedi",
                firebaseAuthHint: "Usa l'email e la password dell'amministratore di Firebase Auth.",
                adminDashboardTitle: "Dashboard Admin",
                logoutButton: "Esci",
                uploadNewPublicationTitle: "Carica Nuova Pubblicazione",
                bookTitleLabel: "Titolo:",
                bookAuthorLabel: "Autore:",
                bookDescriptionLabel: "Descrizione:",
                bookPagesLabel: "Pagine:",
                bookFormatLabel: "Formato:",
                bookDoiLabel: "DOI:",
                bookIsbnLabel: "ISBN:",
                bookIssnLabel: "ISSN:",
                bookIsNewLabel: "Novit (Nuova Pubblicazione)",
                uploadCoverImageLabel: "Carica Immagine Copertina:",
                uploadPdfFileLabel: "Carica File PDF:",
                addPublicationButton: "Aggiungi Pubblicazione",
                cancelEditButton: "Annulla Modifica",
                existingPublicationsTitle: "Pubblicazioni Esistenti",
                noPublicationsUploadedYet: "Nessuna pubblicazione caricata ancora.",
                footerCopyright: "L'Erma di Bretschneider. Tutti i diritti riservati.",
                footerDataStorage: "I dati del sito web sono archiviati in modo sicuro utilizzando i servizi Firebase.",
                footerUserId: "ID Utente Connesso:",
                viewDetailsButton: "Vedi Dettagli",
                doiLabel: "DOI:",
                isbnLabel: "ISBN:",
                issnLabel: "ISSN:",
                isNoveltyLabel: "NOVIT!",
                // Modals
                modalOkBtn: "OK",
                confirmYesBtn: "S",
                confirmNoBtn: "No",
                msgFillTitleAuthor: "Si prega di compilare almeno il titolo e l'autore.",
                msgCoverUploaded: "Immagine di copertina caricata con successo su Storage!",
                msgPdfUploaded: "PDF caricato con successo su Storage!",
                msgPublicationUpdated: "Pubblicazione aggiornata con successo!",
                msgPublicationAdded: "Pubblicazione aggiunta con successo!",
                msgFirebaseStorageRules: "Assicurati che le regole di Firebase Storage consentano la scrittura.",
                msgBookNotFound: "Libro non trovato per la modifica.",
                msgErrorLoadingBook: "Errore durante il caricamento del libro per la modifica. Riprova.",
                msgConfirmDelete: "Sei sicuro di voler eliminare questa pubblicazione?",
                msgPublicationDeleted: "Pubblicazione eliminata con successo!",
                msgErrorDeletingPublication: "Errore durante l'eliminazione della pubblicazione. Assicurati che le regole di Firebase Storage consentano l'eliminazione.",
                msgPdfNotAvailable: "PDF non disponibile per questo libro.",
                msgCurrentCover: "Attuale:",
                msgNoCurrentCover: "Nessuna copertina attuale.",
                msgCurrentPdf: "Attuale:",
                msgNoCurrentPdf: "Nessun PDF attuale.",
                msgUpdating: "Aggiornamento in corso...",
                msgAdding: "Aggiunta in corso...",
                msgAuthWarning: "Nessun utente  autenticato. Le funzionalit di visualizzazione pubblica che richiedono autenticazione potrebbero non funzionare.",
                msgNoBooksFoundSearch: "Nessuna pubblicazione trovata corrispondente alla tua ricerca. Prova un termine diverso.",
                msgErrorLoadingPublications: "Errore durante il caricamento delle pubblicazioni. Riprova pi tardi.",
                msgErrorLoadingAdminPublications: "Errore durante il caricamento delle pubblicazioni per l'amministratore. Riprova.",
                msgLoginInvalid: "Email o password non validi.",
                msgLoginTooManyAttempts: "Troppi tentativi di accesso. Riprova pi tardi.",
                msgLoginFailedGeneric: "Accesso fallito: ",
                msgLoggedOut: "Disconnesso con successo.",
                msgErrorLoggingOut: "Errore durante la disconnessione. Riprova.",
                msgFirebaseConfigInvalid: "La configurazione di Firebase  vuota o non valida. Assicurati che l'app sia in esecuzione in un ambiente abilitato a Firebase con una configurazione corretta.",
                msgFirebaseInitFailed: "Impossibile inizializzare Firebase. Controlla la console per i dettagli.",
                msgPublicContentAuthRequired: "Si prega di accedere o abilitare l'accesso anonimo in Firebase per il contenuto pubblico.",
                msgSelected: "Selezionato",
                downloadPdfButton: "Scarica PDF",
                editButton: "Modifica",
                deleteButton: "Elimina",
                byAuthor: "di",
                msgNotAvailable: "Non disponibile",
                msgUploading: "Caricamento in corso",
                msgUploaded: "Caricato",
                msgFailedUploadCover: "Caricamento immagine di copertina fallito",
                msgFailedUploadPdf: "Caricamento PDF fallito",
                msgCheckStorageRulesOrNetwork: "Controlla le regole di storage o la rete.",
                msgUploadFailed: "Caricamento fallito.",
                msgLoginRequiredForUpload: "Accedi come amministratore prima di caricare file.",
                msgLoginRequiredToAddEdit: "Devi essere loggato come amministratore per aggiungere/modificare pubblicazioni.",
                msgFirebaseNotReady: "Firebase non pronto. Attendi un momento.",
                msgSelectPdfWaitUpload: "Seleziona un file PDF e attendi che finisca il caricamento.",
                msgSelectCoverWaitUpload: "Carica un'immagine di copertina e attendi che finisca il caricamento.",
                msgPdfMissing: "PDF mancante. Carica un PDF o assicurati che quello esistente sia valido.",
                msgCoverMissing: "Immagine di copertina mancante. Carica un'immagine di copertina o assicurati che quella esistente sia valida.",
                msgErrorSavingPublication: "Errore durante il salvataggio della pubblicazione",
                msgCheckFirestoreRules: "Controlla le regole di Firestore.",
                editPublicationTitle: "Modifica Pubblicazione",
                updatePublicationButton: "Aggiorna Pubblicazione",
                msgNoCoverSelected: "Nessuna immagine di copertina selezionata.",
                msgNoPdfSelected: "Nessun file PDF selezionato.",
                msgEditCancelled: "Modifica annullata.",
                msgLoginRequiredToDelete: "Devi essere loggato come amministratore per eliminare pubblicazioni.",
                msgNoDescriptionProvided: "Nessuna descrizione fornita.",
                msgLoginRequiredToEdit: "Devi essere loggato come amministratore per modificare le pubblicazioni.",
                codiceEticoTitle: "Codice Etico e Dichiarazione di Cattiva Condotta",
                codiceEticoParaPreface: "Questo documento delinea i principi etici e le buone pratiche applicate dalla casa editrice L'ERMA di Bretschneider (di seguito L'ERMA) al processo di editing e pubblicazione di monografie, riviste scientifiche e altri contenuti editoriali di natura scientifica, didattica e divulgativa. L'ERMA si ispira ai principi etici delineati dal Committee on Publication Ethics (di seguito COPE), un'organizzazione internazionale senza scopo di lucro che mira a supportare editori ed editori nel perseguimento di elevati standard di etica della pubblicazione. Sebbene COPE fornisca principalmente linee guida e risorse per editori ed editori di riviste scientifiche, queste possono essere applicate anche alla pubblicazione di monografie e altri contenuti accademici.",
                codiceEticoH3ResearchEthics: "I. Etica e integrit della ricerca",
                codiceEticoParaResearchEthics1: "Le pubblicazioni L'ERMA rispettano i principi etici del COPE, che sono: Affidabilit; onest, rispetto e responsabilit in tutti gli aspetti della ricerca; Cura, accuratezza ed eccellenza nella pratica di ricerca; Trasparenza, riproducibilit, tracciabilit e comunicazione aperta; Attenzione e rispetto per tutti i partecipanti e i soggetti della ricerca.",
                codiceEticoParaResearchEthics2: "Se lo ritengono opportuno, gli editori di pubblicazioni e prodotti accademici pubblicati da L'ERMA forniscono agli autori linee guida e politiche specifiche basate su questo documento, relative ai principi di integrit ed etica della ricerca, in base ai loro soggetti e discipline.",
                codiceEticoParaResearchEthics3: "Chiunque ritenga che la ricerca pubblicata da L'ERMA non sia stata condotta in linea con queste pratiche etiche  invitato a segnalare il problema all'editore all'indirizzo lerma@lerma.it. Ove possibile, ogni segnalazione sar gestita secondo le linee guida del COPE, e/o sottoponendo la questione al Presidente del Consiglio di Amministrazione della casa editrice e, se necessario, ai membri del Comitato di Redazione della casa editrice.",
                codiceEticoH3PublishingProcess: "II. Processo di pubblicazione",
                codiceEticoParaPublishingProcess1: "L'ERMA si impegna a rispettare l'indipendenza editoriale e tutti i suoi sforzi sono volti a garantire che questo principio non sia compromesso da interessi concorrenti o da qualsiasi altra influenza. Erma adotta pratiche di non discriminazione di autori, editori o revisori basate su caratteristiche personali o identit, con un impegno costante a rimuovere qualsiasi barriera all'inclusione e a promuovere l'equit in ogni fase del processo di pubblicazione.",
                codiceEticoParaPublishingProcess2: "L'ERMA accoglie autori di diverse provenienze, razze ed etnie, identit di genere, orientamento sessuale, nazionalit, religione e disabilit a pubblicare con loro. L'ERMA rifiuta le pratiche predatorie di pseudo-editori accademici che perseguono il mero profitto a scapito del progresso della ricerca e della qualit e del valore scientifico delle opere che pubblicano.",
                codiceEticoParaPublishingProcess3: "Un consiglio di amministrazione di L'ERMA sovrintende al programma editoriale. I membri sono selezionati in base alla loro riconosciuta competenza scientifica, conoscenza, capacit e al loro accordo con i valori etici della casa editrice. Essi approvano autonomamente i contratti di pubblicazione.",
                codiceEticoParaPublishingProcessRoles: "I ruoli del consiglio di amministrazione sono i seguenti:",
                codiceEticoListItem1: "Inizialmente, le proposte per il programma editoriale di monografie sono esaminate dai membri del comitato editoriale, che ha autonomia decisionale. Tuttavia, i membri del comitato editoriale possono consultare esperti del settore ogni volta che ne hanno bisogno per garantire la qualit del prodotto editoriale. Per facilitare questo processo, i comitati consultivi delle diverse collane firmano la proposta di pubblicazione insieme a una dichiarazione sulla qualit e il valore scientifico della pubblicazione.",
                codiceEticoListItem2: "Dopo che una monografia non facente parte di una collana  stata valutata degna di essere presa in considerazione da L'ERMA, la casa editrice invia la proposta e un campione scritto del manoscritto ad almeno due pareri esterni e indipendenti a favore e contro la pubblicazione al Consiglio di Amministrazione.",
                codiceEticoListItem3: "Il Comitato Editoriale prima e poi il Consiglio di Amministrazione hanno l'autorit di sollecitare ulteriori revisioni e suggerimenti prima che la bozza sia approvata per la pubblicazione e dopo la firma del contratto di pubblicazione per ulteriori informazioni sullo sviluppo del manoscritto.",
                codiceEticoListItem4: "Le decisioni editoriali sui manoscritti presentati alle riviste scientifiche sono prese dai caporedattori della rivista e dai comitati scientifici della rivista e si basano su relazioni di revisione paritaria indipendenti. Il Consiglio di Amministrazione  tenuto ad approvare l'acquisizione da parte di L'ERMA di una rivista esistente o la creazione di una nuova rivista. Il Consiglio di Amministrazione pu agire su modifiche alla politica, all'etica o ad altre questioni che influenzano la gestione delle riviste scientifiche pubblicate da L'ERMA, ma non include decisioni sulla pubblicazione di singoli articoli.",
                codiceEticoParaPublishingProcessTransparent: "Erma incoraggia e mette a disposizione le sue competenze interne affinch tutte le riviste forniscano le loro politiche editoriali in modo trasparente attraverso dichiarazioni. Allo stesso modo, tutte le informazioni relative ai processi editoriali e alle decisioni sulla pubblicazione di monografie, sia individuali che in serie, sono rese trasparenti e accessibili.",
                codiceEticoParaPublishingProcessContact: "In caso di domande o suggerimenti, si prega di contattare gli editori della casa editrice all'indirizzo lerma@lerma.it o la rivista di interesse.",
                codiceEticoParaPublishingProcessAbuse: "Comportamenti o invii abusivi nei confronti del personale de L'ERMA e di altri soggetti coinvolti nel processo di pubblicazione per conto della casa editrice non saranno tollerati. Questo tipo di comportamento pu essere sanzionato, ad esempio, con il rifiuto di un manoscritto o con l'obiezione a commenti chiaramente abusivi durante il processo di revisione paritaria.",
                codiceEticoH3PeerReview: "III. Peer-review",
                codiceEticoParaPeerReview1: "La revisione paritaria  essenziale per mantenere e garantire gli elevati standard di qualit delle pubblicazioni de L'ERMA.",
                codiceEticoParaPeerReviewCommitment: "L'impegno della casa editrice  quindi quello di:",
                codiceEticoPeerReviewListItem1: "fornire sistemi e supporto adeguati per facilitare una revisione paritaria rigorosa, equa ed efficace per tutte le pubblicazioni;",
                codiceEticoPeerReviewListItem2: "invitare gli editori di collane e riviste scientifiche e i revisori paritari a familiarizzare con queste linee guida e quelle disponibili sul sito web dell'editore, che sono conformi alle migliori pratiche di revisione paritaria;",
                codiceEticoPeerReviewListItem3: "assicurare, attraverso la sua redazione, che il processo di revisione paritaria sia condotto seguendo i principi di integrit sopra descritti e intervenire in caso di pratiche fraudolente o manipolazione;",
                codiceEticoPeerReviewListItem4: "proteggere la riservatezza delle persone coinvolte nel processo di revisione paritaria quando l'anonimato  parte integrante del processo di revisione per una data pubblicazione. La casa editrice esige la stessa conformit agli accordi di riservatezza da parte dei partner editoriali, degli autori e dei revisori paritari per ogni libro o rivista pubblicata.",
                codiceEticoH3AuthorsEditors: "IV. Autori ed Editori",
                codiceEticoParaAuthorsEditors1: "I formati di pubblicazione possono avere standard diversi a cui gli autori si conformano a seconda delle diverse discipline. In assenza di altre linee guida, L'ERMA raccomanda agli autori di aderire ai seguenti principi, che sono anche indicati nei contratti di pubblicazione che gli autori sono invitati a firmare non appena il Consiglio ha approvato il progetto e iniziato la fase di produzione:",
                codiceEticoAuthorsEditorsListItem1: "concettualizzazione e pianificazione del lavoro, acquisizione, analisi e interpretazione dei dati di ricerca;",
                codiceEticoAuthorsEditorsListItem2: "editing e/o revisioni critiche delle opere volte a produrre contenuti intellettuali di alta qualit;",
                codiceEticoAuthorsEditorsListItem3: "approvazione finale 'Send-to-Press' della versione da pubblicare;",
                codiceEticoAuthorsEditorsListItem4: "l'assunzione di responsabilit per tutti gli aspetti del lavoro e la garanzia che le domande relative all'accuratezza o all'integrit di qualsiasi parte del lavoro siano state adeguatamente esaminate al momento della consegna.",
                codiceEticoParaAuthorsEditorsResponsibilities: "Le responsabilit specifiche degli editori e degli autori corrispondenti includono:",
                codiceEticoAuthorsEditorsListItem5: "l'editing di manoscritti e bozze, la gestione delle revisioni e la ripresentazione dei manoscritti revisionati fino all'accettazione;",
                codiceEticoAuthorsEditorsListItem6: "la firma del contratto di pubblicazione di eventuali coautori o dell'editore, con la procura dei coautori;",
                codiceEticoAuthorsEditorsListItem7: "l'azione di portavoce per conto di tutti i coautori su questioni relative all'etica della pubblicazione, al riutilizzo dei contenuti o alla disponibilit di dati, materiali, risorse, ecc.",
                codiceEticoParaAuthorsEditorsSupport: "La casa editrice supporta gli autori nelle controversie sulla paternit e sull'acquisizione e l'uso di identificatori secondo gli standard internazionali del settore (es. Open Researcher and Contributor ID - ORCID e International Standard Name Identifier - ISNI -).",
                codiceEticoH3Affiliations: "V. Affiliazioni",
                codiceEticoParaAffiliations: "Tutte le affiliazioni delle pubblicazioni de L'ERMA devono rappresentare l'istituzione/le istituzioni in cui la ricerca presentata  stata condotta e/o supportata e/o approvata. Nel caso di contenuti divulgativi, ogni affiliazione deve rappresentare l'istituzione o le istituzioni a cui  affiliato ciascun autore.",
                codiceEticoH3FreedomOfSpeech: "VI. Libert di parola e censura",
                codiceEticoParaFreedomOfSpeech: "L'ERMA  pienamente impegnata nella promozione del principio di libert di parola e di espressione. La casa editrice mira a diffondere la conoscenza al pubblico pi ampio possibile e a servire la comunit accademica. A questo proposito, L'ERMA si ispira anche alla Posizione del COPE sulla Censura (2018).",
                codiceEticoH3IntellectualProperty: "VII. Protezione della propriet intellettuale e plagio",
                codiceEticoParaIntellectualProperty1: "L'ERMA non tollera il plagio in nessuna delle sue pubblicazioni e si riserva il diritto di verificare l'originalit delle opere da pubblicare con mezzi appropriati. I contributi sospettati di plagio, in tutto o in parte, vengono rifiutati. Se il plagio viene scoperto dopo la pubblicazione, il Consiglio di Amministrazione della casa editrice adotter misure proporzionate, come il ritiro o la richiesta di correzione.",
                codiceEticoParaIntellectualPropertyMayOccur: "Il plagio pu verificarsi in relazione a tutti i tipi di fonti e media, inclusi:",
                codiceEticoIntellectualPropertyListItem1: "testi, illustrazioni, citazioni musicali, codice sorgente, ecc;",
                codiceEticoIntellectualPropertyListItem2: "materiale scaricato da siti web o tratto da manoscritti o altri media;",
                codiceEticoIntellectualPropertyListItem3: "materiale pubblicato e non pubblicato, incluse lezioni, presentazioni e letteratura grigia.",
                codiceEticoParaIntellectualPropertyReport: "Lettori, revisori ed editori sono invitati a segnalare qualsiasi sospetto di plagio contattando l'editore via e-mail all'indirizzo lerma@lerma.it.",
                codiceEticoH3Duplication: "VIII. Duplicazione della pubblicazione",
                codiceEticoParaDuplication1: "La pubblicazione duplicata o ridondante, o 'auto-plagio', si verifica quando un'opera, o parti di essa, viene pubblicata pi di una volta dall'autore/dagli autori senza un'adeguata contro-referenza o giustificazione per la sovrapposizione.",
                codiceEticoParaDuplication2: "Ci pu avvenire sia nella stessa lingua che in una lingua diversa.",
                codiceEticoParaDuplicationAccepted: "La sovrapposizione sostanziale tra le pubblicazioni pu essere accettata solo se:",
                codiceEticoDuplicationListItem1: "si ritiene che da un punto di vista editoriale ci rafforzi il discorso accademico;",
                codiceEticoDuplicationListItem2: "si ha una chiara approvazione dalla pubblicazione originale;",
                codiceEticoDuplicationListItem3: "la citazione della fonte  stata inclusa.",
                codiceEticoParaDuplicationSubmission: "Quando gli autori sottopongono un manoscritto per la pubblicazione come monografia autonoma, in una rivista o collana L'ERMA, tali manoscritti non devono essere stati sottoposti a un'altra casa editrice, accettati per la pubblicazione o la stampa in un'altra rivista, collana o altro.",
                codiceEticoParaDuplicationPreprint: "Tuttavia, il deposito di una pre-print sul sito web dell'autore, in un repository istituzionale o in un archivio di pre-print  consentito in quanto non  considerato una pubblicazione precedente o duplicata.",
                codiceEticoParaDuplicationReport: "Lettori, revisori ed editori sono incoraggiati a segnalare qualsiasi sospetto di duplicazione contattando l'editore all'indirizzo lerma@lerma.it.",
                codiceEticoH3PersonalData: "IX. Trattamento dei dati personali",
                codiceEticoParaPersonalData: "La ricerca scientifica che coinvolge persone deve rispettare le norme sul trattamento dei dati personali (Regolamento UE 679/2016 e D.Lgs. 101/2018 di attuazione) e conformarsi agli standard etici e legali internazionali per la ricerca. Gli autori sono tenuti a rispettare i diritti alla privacy dei partecipanti e a ottenere il consenso alla pubblicazione prima di inviare il manoscritto.",
                codiceEticoH3ConflictsOfInterests: "X. Conflitto di interessi e finanziamento",
                codiceEticoParaConflictsOfInterests1: "L'ERMA si impegna a garantire che le sue pubblicazioni siano prive di indebite influenze. Autori, personale de L'ERMA, editori e revisori delle pubblicazioni de L'ERMA sono tenuti a dichiarare eventuali interessi concorrenti che possano interferire con l'obiettivit o l'integrit di una pubblicazione.",
                codiceEticoParaConflictsOfInterests2: "I conflitti di interesse possono sorgere in situazioni che sono considerate influenzare indebitamente la presentazione, la revisione o la pubblicazione di un'opera e possono essere di natura finanziaria, non finanziaria, professionale, contrattuale o personale.",
                codiceEticoParaConflictsOfInterestsReport: "Chiunque sospetti un conflitto di interessi non dichiarato riguardo a un'opera pubblicata o in fase di esame presso L'ERMA deve informare l'editore.",
                codiceEticoH3Calumny: "XI. Calunnia, diffamazione e libert di parola",
                codiceEticoParaCalumny: "La libert di parola  fondamentale per un editore accademico. Erma garantisce che non vengano pubblicate dichiarazioni false che possano danneggiare la reputazione di individui, gruppi o organizzazioni.",
                codiceEticoH3Retractions: "XII. Ritrattazioni e correzioni",
                codiceEticoParaRetractions1: "Gli editori delle riviste gestiranno le ritrattazioni e le correzioni in linea con le linee guida COPE sulle ritrattazioni. In caso di errori dell'autore, la rivista pubblicher una correzione tramite il caporedattore. Se gli errori sono dovuti alla rivista, la rivista si corregger pubblicando un erratum/errata corrige.",
                codiceEticoParaRetractions2: "Le ritrattazioni riguardano solitamente articoli con gravi limitazioni dovute a risultati o conclusioni inaffidabili, o che contengono plagio sostanziale. Gli editori delle riviste che pubblicano manoscritti che sono gi stati sottoposti a revisione possono apportare modifiche minori, come la composizione tipografica o la correzione delle bozze, ma qualsiasi correzione sostanziale verr effettuata in linea con le linee guida sulle ritrattazioni di cui sopra.",
                codiceEticoParaRetractions3: "Eccezionalmente, la casa editrice potrebbe essere tenuta a rimuovere un articolo pubblicato online in conformit con obblighi legali, come nei casi di diffamazione, violazione della privacy o riservatezza. In queste circostanze, la rimozione dell'articolo coincider con un avviso che indichi chiaramente il motivo della rimozione dell'articolo completo.",
                codiceEticoParaRetractionsMonographs: "Nel caso di monografie, la segnalazione di eventuali problemi legali, etici o di sicurezza sar seguita da una notifica immediata all'autore e da un impegno della casa editrice a indagare sulle circostanze. Se il problema riguarda l'integrit o l'accuratezza del contenuto stesso, pu essere considerata una correzione o una ritrattazione e il ritiro dalla vendita. Se un contenuto viene ritirato, l'integrit di altre opere affiliate (ad esempio altri volumi di una serie) sar comunque preservata.",
                codiceEticoParaRetractionsMisconduct: "Se una pubblicazione risulta essere il risultato di una cattiva condotta di ricerca o di frode, verr ritirata o sottoposta a correzione appropriata.",
                codiceEticoH3ImageManipulation: "XIII. Manipolazione, falsificazione e fabbricazione di immagini",
                codiceEticoParaImageManipulation: "Quando i dati di ricerca vengono raccolti o presentati sotto forma di immagini, la loro modifica pu travisare i risultati ottenuti o il loro significato. La modifica delle immagini non  consentita quando porta alla falsificazione, alla fabbricazione o al travisamento dei risultati presentati.",
                codiceEticoH3SubsidiaryLicenses: "XIV. Licenze e diritti sussidiari",
                codiceEticoParaSubsidiaryLicenses: "L'ERMA concede licenze e diritti sussidiari a terzi che consentono la riproduzione, il riutilizzo o l'adattamento del contenuto, originariamente pubblicato dalla casa editrice, in diversi contesti, lingue e territori. Tuttavia, ci  soggetto al rifiuto dell'approvazione per la pubblicazione in caso di dubbi sull'integrit e l'accuratezza dell'edizione autorizzata.",
                codiceEticoH3ResearchData: "XV. Gestione dei dati di ricerca",
                codiceEticoParaResearchData1: "L'ERMA supporta la trasparenza e l'apertura dei dati e degli altri materiali associati alla ricerca. Pertanto, gli autori sono incoraggiati a mantenere registrazioni accurate dei dati generati nel contesto di una specifica attivit di ricerca, necessarie per convalidare i risultati. Ove appropriato e consentito, l'editore incoraggia gli autori a:",
                codiceEticoResearchDataListItem1: "depositare i dati in un repository, o in un'ubicazione di archiviazione appropriata, per ulteriore condivisione e utilizzo;",
                codiceEticoResearchDataListItem2: "indicare il repository in una dichiarazione di disponibilit dei dati che gli autori possono includere nel paratesto della loro pubblicazione.",
                codiceEticoParaResearchData2: "L'ERMA fornisce agli autori guida e supporto riguardo alla possibilit di collegare i loro dati di ricerca alla pubblicazione, sia sulla piattaforma dell'editore che tramite servizi di terze parti.",
                codiceEticoH3IntegrityOfRecords: "XVI. Integrit dei registri",
                codiceEticoParaIntegrityOfRecords1: "La casa editrice mantiene almeno tre registri delle sue pubblicazioni con i relativi metadati bibliografici, il primo sulla sua piattaforma, il secondo nel catalogo L'ERMA (sia in formato cartaceo che digitale), quindi nell'Indice del Servizio Bibliotecario Nazionale (ISBN stampa/USB digitale), il terzo nella biblioteca digitale di un aggregatore di servizi bibliografici.",
                codiceEticoParaIntegrityOfRecords2: "Nelle attivit di marketing, le rappresentazioni di contenuti scientifici pubblicati da L'ERMA non vengono alterate o manipolate in alcun modo.",
                codiceEticoParaIntegrityOfRecords3: "Quando un prodotto (capitolo, articolo, monografia o rivista) viene acquistato o sottoscritto, viene fornito per intero al cliente, che non ha il diritto di alterarne il contenuto in alcun modo che non sia conforme ai termini della licenza in base alla quale  stato pubblicato.",
                codiceEticoH3Marketing: "XVII. Comunicazioni di marketing tramite social media",
                codiceEticoParaMarketing1: "I social media, i comunicati stampa e le mailing list sono strumenti potenti per diffondere le pubblicazioni de L'ERMA e raggiungere nuovi lettori. Per seguire le migliori pratiche nell'uso dei media, la casa editrice utilizza le piattaforme di social media: Facebook, Instagram, X.",
                codiceEticoParaMarketing2: "Eventuali campagne di comunicazione sui social media affidate a terzi sono sempre condotte in accordo con l'Ufficio Comunicazione.",
                codiceEticoH3Advertising: "XVIII. Pubblicit",
                codiceEticoParaAdvertising1: "Il modello di business de L'ERMA si basa su una pubblicit appropriata e mirata. I prodotti editoriali e i servizi clienti sono pubblicizzati tramite il sito web online e il catalogo editoriale annuale, disponibile sia in versione cartacea che digitale.",
                codiceEticoParaAdvertising2: "Laddove presente, la pubblicit deve: essere indipendente dalle decisioni editoriali su ci che L'ERMA pubblica; essere distinta dal contenuto.",
                codiceEticoParaAdvertising3: "L'ERMA si riserva il diritto di rifiutare o rimuovere qualsiasi pubblicit se ritiene che sia in conflitto con le Linee guida etiche per la pubblicazione di ricerche accademiche o con il suo Codice etico. Ci avviene in conformit con le linee guida dell'Advertising Standards Authority.",
                codiceEticoLastUpdated: "Ultimo aggiornamento 27 febbraio 2024",

                normeEditorialiTitle: "Linee Guida Editoriali - Norme Redazionali",
                normeEditorialiSubmissionInfo: "Gli articoli devono essere inviati a:",
                normeEditorialiH3SubmissionProcedure: "Procedura di invio:",
                normeEditorialiListItem1: "I contributi devono essere inviati in formato digitale .doc (Microsoft Word) come allegato e-mail.",
                normeEditorialiListItem2: "I contenuti saranno esaminati da almeno due revisori anonimi e, se necessario, verranno restituiti all'autore per eventuali correzioni e modifiche.",
                normeEditorialiListItem3: "Verr inviata una sola serie di bozze agli autori, che dovranno correggerle e restituirle entro la scadenza stabilita dagli editori.",
                normeEditorialiListItem4: "Per quanto riguarda le illustrazioni, un file contenente didascalie e crediti fotografici deve essere inviato separatamente. Il testo deve essere accompagnato da una copia digitale delle immagini da pubblicare (si prega di utilizzare WeTransfer se le immagini sono troppo pesanti per essere inviate come allegati e-mail).",
                normeEditorialiListItem5: "Le immagini devono essere in formato JPG o TIFF e con una risoluzione minima di 300 dpi (definizione dei pixel). Tutte le immagini inviate per la pubblicazione devono essere conformi alle norme sul copyright e deve esserci un accordo (o un modulo di liberatoria) sulla riproduzione delle immagini da parte del titolare del copyright prima della pubblicazione. L'autore  l'unico responsabile dell'ottenimento di tali permessi. Nessuna immagine senza tali documenti di accompagnamento verr pubblicata.",
                normeEditorialiH3ArticleRequirements: "Requisiti dell'articolo:",
                normeEditorialiArticleReqListItem1: "Un abstract di circa 500 caratteri / 100 parole nella lingua del testo e in inglese.",
                normeEditorialiArticleReqListItem2: "Titolo in inglese.",
                normeEditorialiArticleReqListItem3: "5 parole chiave in italiano e in inglese.",
                normeEditorialiArticleReqListItem4: "Note a pi di pagina.",
                normeEditorialiArticleReqListItem5: "Indirizzo e-mail e indirizzo dell'autore.",
                normeEditorialiArticleReqListItem6: "Affiliazione istituzionale dell'autore.",
                normeEditorialiH3FormattingGuidelines: "Linee guida di formattazione:",
                normeEditorialiFormattingListItem1: "Le citazioni sono inserite tra virgolette doppie \"...\".",
                normeEditorialiFormattingListItem2: "Le virgolette singole sono utilizzate per enfatizzare parole o espressioni specifiche '...'.",
                normeEditorialiFormattingListItem3: "Le traslitterazioni da altre lingue (come, ad esempio, dal greco o dall'arabo) sono in corsivo.",
                normeEditorialiFormattingListItem4: "Se nel testo vengono utilizzati caratteri speciali (come nel caso del greco), il font deve essere specificato.",
                normeEditorialiFormattingListItem5: "Le fonti latine e greche devono essere citate utilizzando le abbreviazioni in: Thesaurus Linguae Latinae, The Online Liddell-Scott-Jones Greek-English Lexicon (http://stephanus.tlg.uci.edu/lsj/01-authors_and_works.html) e, se non presenti, G.W.H. LAMPE, A Patristic Greek Lexicon, Oxford 1961.",
                normeEditorialiH3CommonAbbreviations: "Abbreviazioni comuni:",
                normeEditorialiNote: "Nota: Questo  un riepilogo delle linee guida editoriali complete. Per le regole bibliografiche complete, si prega di fare riferimento al documento completo.",
            }
        };

        let currentLang = localStorage.getItem('lang') || 'en'; // Default to English or saved preference

        function setLanguage(lang) {
            currentLang = lang;
            localStorage.setItem('lang', lang);
            document.documentElement.lang = lang; // Set HTML lang attribute
            
            // Update all elements with data-lang-key
            document.querySelectorAll('[data-lang-key]').forEach(element => {
                const key = element.getAttribute('data-lang-key');
                if (translations[lang] && translations[lang][key]) {
                    // Handle innerHTML for bold tags in paragraphs
                    if (element.tagName === 'P' && (key.includes('Para') || key.includes('Subtitle'))) {
                        element.innerHTML = translations[lang][key];
                    } else {
                        element.textContent = translations[lang][key];
                    }
                }
            });

            // Update specific placeholders manually as textContent doesn't work for them
            const publicSearchInput = document.getElementById('publicSearchInput');
            if (publicSearchInput) {
                publicSearchInput.placeholder = translations[lang]['searchPlaceholder'];
            }
            
            // Update button texts that change based on context (Add/Update)
            // Ensure submitBookBtn is defined before accessing it
            const submitBookBtnLocal = document.getElementById('submitBookBtn');
            if (submitBookBtnLocal) {
                if (editingBookId) {
                    submitBookBtnLocal.textContent = translations[lang]['msgUpdating'];
                } else {
                    submitBookBtnLocal.textContent = translations[lang]['addPublicationButton'];
                }
            }

            // Update modal buttons if they are visible
            const modalOkBtn = document.querySelector('#messageModal button');
            if (modalOkBtn) modalOkBtn.textContent = translations[lang]['modalOkBtn'];

            const confirmYesBtn = document.getElementById('confirmYesBtn');
            if (confirmYesBtn) confirmYesBtn.textContent = translations[lang]['confirmYesBtn'];
            const confirmNoBtn = document.getElementById('confirmNoBtn');
            if (confirmNoBtn) confirmNoBtn.textContent = translations[lang]['confirmNoBtn'];

            // Update dynamically generated text in file input displays
            const coverImageFileNameDisplayLocal = document.getElementById('coverImageFileNameDisplay');
            const pdfFileNameDisplayLocal = document.getElementById('pdfFileNameDisplay'); // Corrected reference

            if (currentCoverImageFile) {
                if (coverImageFileNameDisplayLocal) coverImageFileNameDisplayLocal.textContent = `${translations[currentLang]['msgSelected']}: ${getOriginalFileNameFromUnique(currentCoverImageFile.name)}`;
            } else if (editingBookId && currentCoverImageFileName) { // Changed to use currentCoverImageFileName
                if (coverImageFileNameDisplayLocal) coverImageFileNameDisplayLocal.textContent = `${translations[currentLang]['msgCurrentCover']}: ${getOriginalFileNameFromUnique(currentCoverImageFileName)}`;
            } else {
                if (coverImageFileNameDisplayLocal) coverImageFileNameDisplayLocal.textContent = '';
            }

            if (currentPdfFile) {
                if (pdfFileNameDisplayLocal) pdfFileNameDisplayLocal.textContent = `${translations[currentLang]['msgSelected']}: ${getOriginalFileNameFromUnique(currentPdfFile.name)}`;
            } else if (editingBookId && currentPdfFileName) { // Changed to use currentPdfFileName
                if (pdfFileNameDisplayLocal) pdfFileNameDisplayLocal.textContent = `${translations[currentLang]['msgCurrentPdf']}: ${getOriginalFileNameFromUnique(currentPdfFileName)}`;
            } else {
                if (pdfFileNameDisplayLocal) pdfFileNameDisplayLocal.textContent = '';
            }

            // Update dynamically generated text in file input displays
            // This function needs to be called after updating the relevant variables (currentCoverImageFile, currentPdfFile, editingBookId, currentCoverImageFileName, currentPdfFileName, currentPdfURL)
            // The logic in `setLanguage` to update these displays is correct provided these variables hold the correct state.

            // Update potentially dynamic content like "by Author"
            document.querySelectorAll('.book-card-author').forEach(el => {
                const author = el.dataset.author; // Assuming you add data-author attribute later if needed
                el.textContent = `${translations[currentLang]['byAuthor']} ${author}`;
            });
            // Update the no data messages if they are currently visible
            const homeViewLocal = document.getElementById('homeView');
            const noBooksMessageElement = document.getElementById('noBooksMessage');
            if (homeViewLocal && (homeViewLocal.classList.contains('flex') || !homeViewLocal.classList.contains('hidden'))) {
                if (noBooksMessageElement && !noBooksMessageElement.classList.contains('hidden')) {
                    noBooksMessageElement.textContent = translations[currentLang]['noPublicationsMessage'];
                }
            }
            const adminDashboardViewLocal = document.getElementById('adminDashboardView');
            const noAdminBooksMessage = document.getElementById('noAdminBooksMessage');
            if (adminDashboardViewLocal && (adminDashboardViewLocal.classList.contains('flex') || !adminDashboardViewLocal.classList.contains('hidden'))) {
                if (noAdminBooksMessage && !noAdminBooksMessage.classList.contains('hidden')) {
                    noAdminBooksMessage.textContent = translations[currentLang]['noPublicationsUploadedYet'];
                }
            }
        }

        // Event listeners for language buttons
        // Assigned directly as these are in the header and always available
        document.getElementById('langEnBtn').addEventListener('click', () => setLanguage('en'));
        document.getElementById('langItBtn').addEventListener('click', () => setLanguage('it'));

        // Message Modal Functions
        function showMessageModal(messageKey) {
            const message = translations[currentLang][messageKey] || messageKey; // Get translated message
            const modalMessageElement = document.getElementById('modalMessage');
            const messageModal = document.getElementById('messageModal');

            if (modalMessageElement) modalMessageElement.textContent = message;
            if (messageModal) {
                messageModal.classList.remove('hidden');
                messageModal.classList.add('flex'); // Show modal by applying flex
            }
            // Add event listener to close button inside the modal
            const closeBtn = messageModal.querySelector('.close-button');
            if (closeBtn) {
                closeBtn.onclick = closeMessageModal;
            }
        }

        function closeMessageModal() {
            const messageModal = document.getElementById('messageModal');
            const modalMessageElement = document.getElementById('modalMessage');

            if (modalMessageElement) modalMessageElement.textContent = ''; // Clear message
            if (messageModal) {
                messageModal.classList.remove('flex'); // Hide modal by removing flex
                messageModal.classList.add('hidden');
            }
        }

        // Confirmation Modal Functions
        let confirmCallback = null; // Stores the callback for the confirm modal

        function showConfirmModal(messageKey, callback) {
            const message = translations[currentLang][messageKey] || messageKey; // Get translated message
            const confirmMessageElement = document.getElementById('confirmMessage');
            const confirmModal = document.getElementById('confirmModal');

            if (confirmMessageElement) confirmMessageElement.textContent = message;
            if (confirmModal) {
                confirmModal.classList.remove('hidden');
                confirmModal.classList.add('flex');
            }
            confirmCallback = callback;
        }

        document.getElementById('confirmYesBtn').addEventListener('click', () => {
            const confirmModal = document.getElementById('confirmModal');
            if (confirmModal) {
                confirmModal.classList.remove('flex');
                confirmModal.classList.add('hidden');
            }
            if (confirmCallback) {
                confirmCallback(true);
                confirmCallback = null;
            }
        });

        document.getElementById('confirmNoBtn').addEventListener('click', () => {
            const confirmModal = document.getElementById('confirmModal');
            if (confirmModal) {
                confirmModal.classList.remove('flex');
                confirmModal.classList.add('hidden');
            }
            if (confirmCallback) {
                confirmCallback(false);
                confirmCallback = null;
            }
        });

        // Book Details Modal Functions
        function showBookDetailsModal(book) {
            const modalBookCover = document.getElementById('modalBookCover');
            const modalBookTitle = document.getElementById('modalBookTitle');
            const modalBookAuthor = document.getElementById('modalBookAuthor');
            const modalBookDescription = document.getElementById('modalBookDescription');
            const modalDownloadPdfBtn = document.getElementById('modalDownloadPdfBtn');
            const bookDetailsModal = document.getElementById('bookDetailsModal');

            // New metadata elements
            const modalBookPages = document.getElementById('modalBookPages');
            const modalBookFormat = document.getElementById('modalBookFormat');
            const modalBookDoi = document.getElementById('modalBookDoi');
            const modalBookIsbn = document.getElementById('modalBookIsbn');
            const modalBookIssn = document.getElementById('modalBookIssn');
            const modalBookNovelty = document.getElementById('modalBookNovelty');


            if (modalBookCover) modalBookCover.src = book.coverImageUrl || 'https://placehold.co/150x200/cccccc/333333?text=No+Cover';
            if (modalBookTitle) modalBookTitle.textContent = book.title;
            if (modalBookAuthor) modalBookAuthor.textContent = `${translations[currentLang]['byAuthor']} ${book.author}`;
            if (modalBookDescription) modalBookDescription.textContent = book.description || translations[currentLang]['msgNoDescriptionProvided'];
            
            // Populate new metadata fields
            if (modalBookPages) modalBookPages.textContent = book.pages ? `${translations[currentLang]['bookPagesLabel']} ${book.pages}` : '';
            if (modalBookFormat) modalBookFormat.textContent = book.format ? `${translations[currentLang]['bookFormatLabel']} ${book.format}` : '';
            
            if (modalBookDoi) {
                const doiLink = modalBookDoi.querySelector('a');
                if (book.doi) {
                    doiLink.href = `https://doi.org/${book.doi}`;
                    doiLink.textContent = book.doi;
                    modalBookDoi.classList.remove('hidden');
                } else {
                    modalBookDoi.classList.add('hidden');
                    doiLink.textContent = '';
                    doiLink.href = '#';
                }
            }
            if (modalBookIsbn) modalBookIsbn.textContent = book.isbn ? `${translations[currentLang]['isbnLabel']} ${book.isbn}` : '';
            if (modalBookIssn) modalBookIssn.textContent = book.issn ? `${translations[currentLang]['issnLabel']} ${book.issn}` : '';
            if (modalBookNovelty) {
                if (book.isNew) {
                    modalBookNovelty.classList.remove('hidden');
                } else {
                    modalBookNovelty.classList.add('hidden');
                }
            }

            if (modalDownloadPdfBtn) {
                if (book.pdfUrl) {
                    modalDownloadPdfBtn.href = book.pdfUrl;
                    modalDownloadPdfBtn.classList.remove('opacity-50', 'cursor-not-allowed');
                    modalDownloadPdfBtn.onclick = null; // Remove previous onclick
                } else {
                    modalDownloadPdfBtn.href = '#';
                    modalDownloadPdfBtn.classList.add('opacity-50', 'cursor-not-allowed');
                    modalDownloadPdfBtn.onclick = (e) => {
                        e.preventDefault();
                        showMessageModal('msgPdfNotAvailable');
                    };
                }
            }

            if (bookDetailsModal) {
                bookDetailsModal.classList.remove('hidden');
                bookDetailsModal.classList.add('flex');
            }
            // Add event listener to close button inside the modal
            const closeBtn = bookDetailsModal.querySelector('.close-button');
            if (closeBtn) {
                closeBtn.onclick = closeBookDetailsModal;
            }
        }

        function closeBookDetailsModal() {
            const bookDetailsModal = document.getElementById('bookDetailsModal');
            if (bookDetailsModal) {
                bookDetailsModal.classList.remove('flex');
                bookDetailsModal.classList.add('hidden');
            }
        }


        // Firebase Initialization and Authentication state management
        async function initializeFirebase() {
            try {
                // Get the existing app instance or initialize a new one if none exists
                const app = getApps().length ? getApp() : initializeApp(firebaseConfig);
                
                db = getFirestore(app);
                auth = getAuth(app);
                storage = getStorage(app); // Initialize Firebase Storage here!

                // This listener ensures that setupEventListeners runs ONLY after auth state is determined.
                onAuthStateChanged(auth, async (user) => {
                    if (user) {
                        userId = user.uid;
                        console.log("Authenticated with user ID:", userId);
                        isLoggedIn = true; // Set isLoggedIn here based on actual auth state
                    } else {
                        console.warn(translations[currentLang]['msgAuthWarning']);
                        userId = null;
                        isLoggedIn = false; // Set isLoggedIn here
                    }
                    isAuthReady = true; // Auth state has been checked

                    // Now that auth is ready, set up event listeners and initial view.
                    setupEventListeners(); // CALL setupEventListeners here
                    
                    const currentUserIdElement = document.getElementById('currentUserId');
                    if (currentUserIdElement) {
                        currentUserIdElement.textContent = userId || translations[currentLang]['footerUserId'] + ' ' + translations[currentLang]['msgNotAvailable'];
                    }
                });

            } catch (error) {
                console.error("Error initializing Firebase:", error);
                showMessageModal("msgFirebaseInitFailed");
            }
        }

        // --- View Management ---
        // Variables for views and buttons - these will be assigned inside setupEventListeners
        // Declared as `null` initially to ensure they are assigned later.
        let homeView = null, aboutView = null, contactView = null, adminLoginView = null, adminDashboardView = null, codiceEticoView = null, normeEditorialiView = null;
        let homeViewBtn = null, aboutViewBtn = null, contactViewBtn = null, adminLoginBtn = null, adminLogoutBtn = null, codiceEticoViewBtn = null, normeEditorialiViewBtn = null;
        let publicSearchInput = null;
        let adminLoginForm = null, usernameInput = null, passwordInput = null, loginErrorMessage = null;
        let uploadBookForm = null, bookTitleInput = null, bookAuthorInput = null, bookDescriptionInput = null, bookPagesInput = null, bookFormatInput = null, bookDoiInput = null, bookIsbnInput = null, bookIssnInput = null, bookIsNewCheckbox = null, coverImageFileInput = null, coverImageFileNameDisplay = null, uploadedCoverPreview = null, pdfFileInput = null, pdfFileNameDisplay = null, submitBookBtn = null, cancelEditBtn = null, formTitle = null;
        let adminBooksList = null, noAdminBooksMessage = null, noBooksMessage = null, booksContainer = null;

        function showView(viewId) {
            // All these variables should be assigned in setupEventListeners, which runs once auth is ready.
            const allViews = [homeView, aboutView, contactView, adminLoginView, adminDashboardView, codiceEticoView, normeEditorialiView];
            allViews.forEach(view => {
                if (view) {
                    view.classList.remove('flex');
                    view.classList.add('hidden');
                }
            });

            const targetView = document.getElementById(viewId);
            if (targetView) {
                targetView.classList.remove('hidden');
                targetView.classList.add('flex');
            }

            if (viewId === 'homeView') {
                if (userId) {
                    loadBooks();
                } else {
                    if (booksContainer && noBooksMessage) {
                        booksContainer.innerHTML = '';
                        noBooksMessage.textContent = translations[currentLang]['msgPublicContentAuthRequired'];
                        noBooksMessage.classList.remove('hidden');
                    }
                }
            } else if (viewId === 'adminDashboardView' && isLoggedIn) {
                loadBooksForAdmin();
            }
            setLanguage(currentLang); // Reapply translations after view change
        }

        // Function to set up all event listeners and initial view after DOM is ready AND Firebase Auth is ready
        function setupEventListeners() {
            // Assign ALL DOM elements to variables here
            homeView = document.getElementById('homeView');
            aboutView = document.getElementById('aboutView');
            contactView = document.getElementById('contactView');
            adminLoginView = document.getElementById('adminLoginView');
            adminDashboardView = document.getElementById('adminDashboardView');
            codiceEticoView = document.getElementById('codiceEticoView'); // New
            normeEditorialiView = document.getElementById('normeEditorialiView'); // New

            homeViewBtn = document.getElementById('homeViewBtn');
            aboutViewBtn = document.getElementById('aboutViewBtn');
            contactViewBtn = document.getElementById('contactViewBtn');
            adminLoginBtn = document.getElementById('adminLoginBtn');
            adminLogoutBtn = document.getElementById('adminLogoutBtn');
            codiceEticoViewBtn = document.getElementById('codiceEticoViewBtn'); // New
            normeEditorialiViewBtn = document.getElementById('normeEditorialiViewBtn'); // New
            
            publicSearchInput = document.getElementById('publicSearchInput');

            adminLoginForm = document.getElementById('adminLoginForm');
            usernameInput = document.getElementById('username');
            passwordInput = document.getElementById('password');
            loginErrorMessage = document.getElementById('loginErrorMessage');

            uploadBookForm = document.getElementById('uploadBookForm');
            bookTitleInput = document.getElementById('bookTitle');
            bookAuthorInput = document.getElementById('bookAuthor');
            bookDescriptionInput = document.getElementById('bookDescription');
            bookPagesInput = document.getElementById('bookPages'); // New
            bookFormatInput = document.getElementById('bookFormat'); // New
            bookDoiInput = document.getElementById('bookDoi'); // New
            bookIsbnInput = document.getElementById('bookIsbn'); // New
            bookIssnInput = document.getElementById('bookIssn'); // New
            bookIsNewCheckbox = document.getElementById('bookIsNew'); // New
            coverImageFileInput = document.getElementById('coverImageFile');
            coverImageFileNameDisplay = document.getElementById('coverImageFileNameDisplay');
            uploadedCoverPreview = document.getElementById('uploadedCoverPreview');
            pdfFileInput = document.getElementById('pdfFile');
            pdfFileNameDisplay = document.getElementById('pdfFileNameDisplay');
            submitBookBtn = document.getElementById('submitBookBtn');
            cancelEditBtn = document.getElementById('cancelEditBtn');
            formTitle = document.getElementById('formTitle');
            adminBooksList = document.getElementById('adminBooksList');
            noAdminBooksMessage = document.getElementById('noAdminBooksMessage');
            noBooksMessage = document.getElementById('noBooksMessage');
            booksContainer = document.getElementById('booksContainer');

            // Set initial language and display home view
            setLanguage(currentLang); // Apply initial translations
            showView('homeView'); // Show the first view, which will trigger loadBooks

            // Attach Event Listeners for Navigation
            if (homeViewBtn) homeViewBtn.addEventListener('click', () => showView('homeView'));
            if (codiceEticoViewBtn) codiceEticoViewBtn.addEventListener('click', () => showView('codiceEticoView')); // New
            if (normeEditorialiViewBtn) normeEditorialiViewBtn.addEventListener('click', () => showView('normeEditorialiView')); // New
            if (aboutViewBtn) aboutViewBtn.addEventListener('click', () => showView('aboutView'));
            if (contactViewBtn) contactViewBtn.addEventListener('click', () => showView('contactView'));
            if (adminLoginBtn) adminLoginBtn.addEventListener('click', () => showView('adminLoginView'));
            
            // The exploreBooksBtn was removed from HTML, so its listener is no longer needed.

            if (adminLogoutBtn) {
                adminLogoutBtn.addEventListener('click', async () => {
                    try {
                        await signOut(auth);
                        isLoggedIn = false;
                        showView('homeView');
                        showMessageModal("msgLoggedOut");
                    } catch (error) {
                        console.error("Error signing out:", error);
                        showMessageModal("msgErrorLoggingOut");
                    }
                });
            }

            // Admin Login Form Listener
            if (adminLoginForm) {
                adminLoginForm.addEventListener('submit', async (e) => {
                    e.preventDefault();
                    const email = usernameInput.value;
                    const password = passwordInput.value;

                    try {
                        await signInWithEmailAndPassword(auth, email, password);
                        isLoggedIn = true;
                        showView('adminDashboardView');
                        if (loginErrorMessage) loginErrorMessage.textContent = '';
                        if (usernameInput) usernameInput.value = '';
                        if (passwordInput) passwordInput.value = '';
                        loadBooksForAdmin();
                    } catch (error) {
                        console.error("Firebase Login Error:", error.code, error.message);
                        if (loginErrorMessage) {
                            if (error.code === 'auth/user-not-found' || error.code === 'auth/wrong-password' || error.code === 'auth/invalid-credential') {
                                loginErrorMessage.textContent = translations[currentLang]['msgLoginInvalid'];
                            } else if (error.code === 'auth/too-many-requests') {
                                loginErrorMessage.textContent = translations[currentLang]['msgLoginTooManyAttempts'];
                            } else {
                                loginErrorMessage.textContent = translations[currentLang]['msgLoginFailedGeneric'] + error.message;
                            }
                        }
                    }
                });
            }

            // File input change listeners
            if (coverImageFileInput) {
                coverImageFileInput.addEventListener('change', async (e) => {
                    if (!isLoggedIn) {
                        showMessageModal("msgLoginRequiredForUpload");
                        e.target.value = ''; // Clear selection
                        return;
                    }
                    if (e.target.files.length > 0) {
                        const file = e.target.files[0];
                        // Store the full unique filename including timestamp for later deletion/reference
                        const uniqueFileName = `${Date.now()}_${file.name}`;
                        currentCoverImageFile = file; // Store the actual file object for form reset
                        currentCoverImageFileName = uniqueFileName; // Store the unique name

                        // Display a loading message
                        if(uploadedCoverPreview) {
                            uploadedCoverPreview.src = ''; // Clear preview
                            uploadedCoverPreview.style.display = 'none';
                        }
                        if(coverImageFileNameDisplay) coverImageFileNameDisplay.textContent = `${translations[currentLang]['msgUploading']} ${file.name}...`;

                        // Upload to Firebase Storage using the unique filename
                        const imageStorageRef = ref(storage, `artifacts/${firebaseConfig.projectId}/public/files/covers/${uniqueFileName}`);
                        try {
                            const snapshot = await uploadBytes(imageStorageRef, file);
                            currentCoverImageURL = await getDownloadURL(snapshot.ref);
                            if(uploadedCoverPreview) {
                                uploadedCoverPreview.src = currentCoverImageURL;
                                uploadedCoverPreview.style.display = 'block';
                            }
                            if(coverImageFileNameDisplay) coverImageFileNameDisplay.textContent = `${translations[currentLang]['msgUploaded']}: ${file.name}`; // Display original filename
                            showMessageModal("msgCoverUploaded");
                        } catch (error) {
                            console.error("Error uploading cover image to Firebase Storage:", error);
                            showMessageModal(`${translations[currentLang]['msgFailedUploadCover']}: ${error.message}. ${translations[currentLang]['msgCheckStorageRulesOrNetwork']}`);
                            currentCoverImageFile = null; // Reset file object
                            currentCoverImageFileName = '';
                            if(coverImageFileNameDisplay) coverImageFileNameDisplay.textContent = translations[currentLang]['msgUploadFailed'];
                            if(uploadedCoverPreview) {
                                uploadedCoverPreview.style.display = 'none';
                                uploadedCoverPreview.src = '';
                            }
                        }
                    } else {
                        currentCoverImageFile = null;
                        currentCoverImageFileName = '';
                        if(coverImageFileNameDisplay) coverImageFileNameDisplay.textContent = '';
                        currentCoverImageURL = '';
                        if(uploadedCoverPreview) {
                            uploadedCoverPreview.src = '';
                            uploadedCoverPreview.style.display = 'none';
                        }
                    }
                });
            }

            if (pdfFileInput) {
                pdfFileInput.addEventListener('change', async (e) => {
                    if (!isLoggedIn) {
                        showMessageModal("msgLoginRequiredForUpload");
                        e.target.value = '';
                        return;
                    }
                    if (e.target.files.length > 0) {
                        const file = e.target.files[0];
                        // Store the full unique filename including timestamp for later deletion/reference
                        const uniqueFileName = `${Date.now()}_${file.name}`;
                        currentPdfFile = file; // Store the actual file object for form reset
                        currentPdfFileName = uniqueFileName; // Store the unique name

                        // Display a loading message
                        if(pdfFileNameDisplay) pdfFileNameDisplay.textContent = `${translations[currentLang]['msgUploading']} ${file.name}...`;

                        // Upload to Firebase Storage using the unique filename
                        const pdfStorageRef = ref(storage, `artifacts/${firebaseConfig.projectId}/public/files/pdfs/${uniqueFileName}`);
                        try {
                            const snapshot = await uploadBytes(pdfStorageRef, file);
                            currentPdfURL = await getDownloadURL(snapshot.ref);
                            if(pdfFileNameDisplay) pdfFileNameDisplay.textContent = `${translations[currentLang]['msgUploaded']}: ${file.name}`; // Display original filename
                            showMessageModal("msgPdfUploaded");
                        } catch (error) {
                            console.error("Error uploading PDF to Firebase Storage:", error);
                            showMessageModal(`${translations[currentLang]['msgFailedUploadPdf']}: ${error.message}. ${translations[currentLang]['msgCheckStorageRulesOrNetwork']}`);
                            currentPdfFile = null; // Reset file object
                            currentPdfFileName = '';
                            if(pdfFileNameDisplay) pdfFileNameDisplay.textContent = translations[currentLang]['msgUploadFailed'];
                            currentPdfURL = '';
                        }
                    } else {
                        currentPdfFile = null;
                        currentPdfFileName = '';
                        if(pdfFileNameDisplay) pdfFileNameDisplay.textContent = '';
                        currentPdfURL = '';
                    }
                });
            }

            // Upload/Edit Form Listener
            if (uploadBookForm) {
                uploadBookForm.addEventListener('submit', async (e) => {
                    e.preventDefault();
                    if (!isLoggedIn) {
                        showMessageModal("msgLoginRequiredToAddEdit");
                        return;
                    }
                    if (!isAuthReady) {
                        showMessageModal("msgFirebaseNotReady");
                        return;
                    }

                    const title = bookTitleInput.value.trim();
                    const author = bookAuthorInput.value.trim();
                    const description = bookDescriptionInput.value.trim();
                    const pages = bookPagesInput.value.trim(); // New
                    const format = bookFormatInput.value.trim(); // New
                    const doi = bookDoiInput.value.trim(); // New
                    const isbn = bookIsbnInput.value.trim(); // New
                    const issn = bookIssnInput.value.trim(); // New
                    const isNew = bookIsNewCheckbox.checked; // New


                    let pdfUrlToSave = currentPdfURL;
                    let coverImageUrlToSave = currentCoverImageURL;
                    let pdfFileNameToSave = currentPdfFileName;
                    let coverImageFileNameToSave = currentCoverImageFileName;

                    if (!title || !author) {
                        showMessageModal("msgFillTitleAuthor");
                        return;
                    }

                    if (editingBookId) {
                        const bookSnap = await getDoc(doc(db, BOOKS_COLLECTION_PATH, editingBookId));
                        const existingBook = bookSnap.exists() ? bookSnap.data() : null;

                        // If no new PDF was selected, use existing URL and unique filename from Firestore
                        if (!currentPdfFile) {
                            pdfUrlToSave = existingBook?.pdfUrl || '';
                            pdfFileNameToSave = existingBook?.pdfFileName || ''; // Use the unique filename from storage
                        }
                        // If no new cover was selected, use existing URL and unique filename from Firestore
                        if (!currentCoverImageFile) {
                            coverImageUrlToSave = existingBook?.coverImageUrl || '';
                            coverImageFileNameToSave = existingBook?.coverImageFileName || ''; // Use the unique filename from storage
                        }
                    } else { // For new books, ensure files are selected AND uploaded
                        if (!currentPdfFile || !currentPdfURL) {
                            showMessageModal("msgSelectPdfWaitUpload");
                            return;
                        }
                        if (!currentCoverImageFile || !currentCoverImageURL) {
                            showMessageModal("msgSelectCoverWaitUpload");
                            return;
                        }
                    }

                    // Final check that URLs are available after all logic
                    if (!pdfUrlToSave) {
                        showMessageModal("msgPdfMissing");
                        return;
                    }
                    if (!coverImageUrlToSave) {
                        showMessageModal("msgCoverMissing");
                        return;
                    }

                    if (submitBookBtn) {
                        submitBookBtn.textContent = editingBookId ? translations[currentLang]['msgUpdating'] : translations[currentLang]['msgAdding'];
                        submitBookBtn.disabled = true;
                    }
                    
                    try {
                        const bookData = {
                            title: title,
                            author: author,
                            description: description,
                            pages: pages, // New field
                            format: format, // New field
                            doi: doi, // New field
                            isbn: isbn, // New field
                            issn: issn, // New field
                            isNew: isNew, // New field
                            coverImageUrl: coverImageUrlToSave,
                            coverImageFileName: coverImageFileNameToSave, // This will now correctly store the unique name
                            pdfUrl: pdfUrlToSave,
                            pdfFileName: pdfFileNameToSave, // This will now correctly store the unique name
                            timestamp: new Date().toISOString()
                        };

                        if (editingBookId) {
                            await updateDoc(doc(db, BOOKS_COLLECTION_PATH, editingBookId), bookData);
                            showMessageModal("msgPublicationUpdated");
                        } else {
                            await addDoc(collection(db, BOOKS_COLLECTION_PATH), bookData);
                            showMessageModal("msgPublicationAdded");
                        }

                        resetBookForm();
                    } catch (error) {
                        console.error("Error saving document: ", error);
                        showMessageModal(`${translations[currentLang]['msgErrorSavingPublication']}: ${error.message}. ${translations[currentLang]['msgCheckFirestoreRules']}`);
                    } finally {
                        if (submitBookBtn) {
                            submitBookBtn.textContent = editingBookId ? translations[currentLang]['updatePublicationButton'] : translations[currentLang]['addPublicationButton'];
                            submitBookBtn.disabled = false;
                            setLanguage(currentLang);
                        }
                    }
                });
            }

            // Cancel Edit Listener
            if (cancelEditBtn) {
                cancelEditBtn.addEventListener('click', () => {
                    resetBookForm();
                    showMessageModal("msgEditCancelled");
                });
            }

            // Public Search Input Listener
            if (publicSearchInput) {
                publicSearchInput.addEventListener('input', (e) => {
                    loadBooks(e.target.value);
                });
            }

            // Modals backdrop click
            const messageModal = document.getElementById('messageModal');
            if (messageModal) {
                messageModal.addEventListener('click', function(event) {
                    if (event.target === messageModal) {
                        closeMessageModal();
                    }
                });
            }
            
            const confirmModal = document.getElementById('confirmModal');
            if (confirmModal) {
                confirmModal.addEventListener('click', function(event) {
                    if (event.target === confirmModal) {
                        confirmModal.classList.remove('flex');
                        confirmModal.classList.add('hidden');
                        if (confirmCallback) {
                            confirmCallback(false);
                            confirmCallback = null;
                        }
                    }
                });
            }

            const bookDetailsModal = document.getElementById('bookDetailsModal');
            if (bookDetailsModal) {
                bookDetailsModal.addEventListener('click', function(event) {
                    if (event.target === bookDetailsModal) {
                        closeBookDetailsModal();
                    }
                });
            }
        } // End of setupEventListeners

        // --- Book Management (Firestore) ---
        const BOOKS_COLLECTION_PATH = `artifacts/${firebaseConfig.projectId}/public/data/books`;

        // Function to load and display books in the public view
        async function loadBooks(searchTerm = '') {
            if (!isAuthReady || !userId) {
                if (noBooksMessage) {
                    noBooksMessage.innerHTML = translations[currentLang]['msgPublicContentAuthRequired'];
                    noBooksMessage.classList.remove('hidden');
                }
                if (booksContainer) {
                    booksContainer.innerHTML = '';
                }
                return;
            }

            if (!booksContainer) { console.error("booksContainer not found in loadBooks."); return; }
            if (!noBooksMessage) { console.error("noBooksMessage not found in loadBooks."); return; }

            noBooksMessage.classList.add('hidden');
            booksContainer.innerHTML = '';

            try {
                const q = query(collection(db, BOOKS_COLLECTION_PATH));
                onSnapshot(q, (querySnapshot) => {
                    let books = [];
                    querySnapshot.forEach((doc) => {
                        books.push({ id: doc.id, ...doc.data() });
                    });

                    const lowerCaseSearchTerm = searchTerm.toLowerCase();
                    const filteredBooks = books.filter(book =>
                        book.title.toLowerCase().includes(lowerCaseSearchTerm) ||
                        book.author.toLowerCase().includes(lowerCaseSearchTerm) ||
                        (book.description && book.description.toLowerCase().includes(lowerCaseSearchTerm)) ||
                        (book.pages && book.pages.toLowerCase().includes(lowerCaseSearchTerm)) || // New search field
                        (book.format && book.format.toLowerCase().includes(lowerCaseSearchTerm)) || // New search field
                        (book.doi && book.doi.toLowerCase().includes(lowerCaseSearchTerm)) || // New search field
                        (book.isbn && book.isbn.toLowerCase().includes(lowerCaseSearchTerm)) || // New search field
                        (book.issn && book.issn.toLowerCase().includes(lowerCaseSearchTerm))    // New search field
                    );

                    booksContainer.innerHTML = '';
                    if (filteredBooks.length === 0) {
                        noBooksMessage.textContent = translations[currentLang]['msgNoBooksFoundSearch'];
                        noBooksMessage.classList.remove('hidden');
                        return;
                    }

                    noBooksMessage.classList.add('hidden');

                    filteredBooks.forEach((book) => {
                        // Truncate description for card view
                        const truncatedDescription = book.description && book.description.length > 150 
                            ? book.description.substring(0, 147) + '...' 
                            : (book.description || translations[currentLang]['msgNoDescriptionProvided']);

                        const bookCard = `
                            <div class="bg-neutral-100 p-4 rounded-xl shadow-md flex flex-col items-center text-center transition duration-300 hover:shadow-lg book-card" data-book-id="${book.id}">
                                <img src="${book.coverImageUrl || 'https://placehold.co/150x200/cccccc/333333?text=No+Cover'}" alt="${book.title}" class="w-36 h-48 object-cover rounded-lg mb-4 shadow-sm">
                                <h3 class="text-xl font-semibold mb-2 text-gray-800">${book.title}</h3>
                                <p class="text-gray-600 text-sm mb-3">${translations[currentLang]['byAuthor']} ${book.author}</p>
                                <p class="text-gray-700 text-sm h-20 overflow-hidden">${truncatedDescription}</p> <!-- Changed h-12 to h-20 -->
                                <button class="mt-auto bg-blue-500 hover:bg-blue-600 text-white font-semibold py-2 px-4 rounded-lg shadow-md transition duration-300 transform hover:scale-105 mt-4" onclick="showBookDetailsModalWithId('${book.id}')" data-lang-key="viewDetailsButton">View Details</button>
                            </div>
                        `;
                        booksContainer.innerHTML += bookCard;
                    });
                });
            } catch (error) {
                console.error("Error setting up Firestore listener for books:", error);
                showMessageModal("msgErrorLoadingPublications");
                if (noBooksMessage) {
                    noBooksMessage.textContent = translations[currentLang]['msgErrorLoadingPublications'];
                }
            }
        }

        // Function to load and display books in the admin dashboard
        async function loadBooksForAdmin() {
            if (!isAuthReady || !isLoggedIn) {
                console.warn("Not authorized to load admin books. Please log in.");
                return;
            }
            if (!adminBooksList) { console.error("adminBooksList not found in loadBooksForAdmin."); return; }
            if (!noAdminBooksMessage) { console.error("noAdminBooksMessage not found in loadBooksForAdmin."); return; }

            adminBooksList.innerHTML = '';
            noAdminBooksMessage.classList.add('hidden');

            try {
                const q = query(collection(db, BOOKS_COLLECTION_PATH));
                onSnapshot(q, (querySnapshot) => {
                    adminBooksList.innerHTML = '';
                    if (querySnapshot.empty) {
                        if (noAdminBooksMessage) {
                            noAdminBooksMessage.classList.remove('hidden');
                            noAdminBooksMessage.textContent = translations[currentLang]['noPublicationsUploadedYet'];
                        }
                        return;
                    }

                    noAdminBooksMessage.classList.add('hidden');

                    querySnapshot.forEach((docRef) => {
                        const book = docRef.data();
                        const bookId = docRef.id;
                        // Display original filename for better readability in Admin UI
                        const pdfDisplayFileName = getOriginalFileNameFromUnique(book.pdfFileName) || translations[currentLang]['msgNotAvailable'];
                        const coverDisplayFileName = getOriginalFileNameFromUnique(book.coverImageFileName) || translations[currentLang]['msgNotAvailable'];

                        const bookItem = `
                            <div class="bg-neutral-100 p-4 rounded-xl shadow-sm grid grid-cols-1 md:grid-cols-3 items-center gap-4">
                                <div class="flex items-center col-span-1 md:col-span-2">
                                    <img src="${book.coverImageUrl || 'https://placehold.co/50x60/cccccc/333333?text=Cover'}" alt="${book.title}" class="w-12 h-16 object-cover rounded-lg mr-4 shadow-sm">
                                    <div>
                                        <h4 class="text-lg font-semibold text-gray-800">${book.title}</h4>
                                        <p class="text-gray-600 text-sm">${book.author}</p>
                                        <p class="text-gray-500 text-xs">${translations[currentLang]['uploadPdfFileLabel']}: ${pdfDisplayFileName}</p>
                                        <p class="text-gray-500 text-xs">${translations[currentLang]['uploadCoverImageLabel']}: ${coverDisplayFileName}</p>
                                        <p class="text-gray-500 text-xs">${translations[currentLang]['bookPagesLabel']}: ${book.pages || translations[currentLang]['msgNotAvailable']}</p>
                                        <p class="text-gray-500 text-xs">${translations[currentLang]['bookFormatLabel']}: ${book.format || translations[currentLang]['msgNotAvailable']}</p>
                                        <p class="text-gray-500 text-xs">${translations[currentLang]['bookDoiLabel']}: ${book.doi || translations[currentLang]['msgNotAvailable']}</p>
                                        <p class="text-gray-500 text-xs">${translations[currentLang]['bookIsbnLabel']}: ${book.isbn || translations[currentLang]['msgNotAvailable']}</p>
                                        <p class="text-gray-500 text-xs">${translations[currentLang]['bookIssnLabel']}: ${book.issn || translations[currentLang]['msgNotAvailable']}</p>
                                        <p class="text-xs ${book.isNew ? 'text-green-600 font-semibold' : 'text-gray-400'}" >${book.isNew ? translations[currentLang]['isNoveltyLabel'] : ''}</p>
                                    </div>
                                </div>
                                <div class="flex flex-col md:flex-row space-y-2 md:space-y-0 md:space-x-2 justify-end">
                                    <button data-id="${bookId}" class="edit-book-btn bg-stone-500 hover:bg-stone-600 text-white py-1 px-3 rounded-lg text-sm shadow-md transition duration-300 transform hover:scale-105" data-lang-key="editButton">Edit</button>
                                    <button data-id="${bookId}" class="delete-book-btn bg-red-500 hover:bg-red-600 text-white py-1 px-3 rounded-lg text-sm shadow-md transition duration-300 transform hover:scale-105" data-lang-key="deleteButton">Delete</button>
                                </div>
                            </div>
                        `;
                        if (adminBooksList) adminBooksList.innerHTML += bookItem;
                    });

                    document.querySelectorAll('.edit-book-btn').forEach(button => {
                        button.addEventListener('click', (e) => editBook(e.target.dataset.id));
                    });
                    document.querySelectorAll('.delete-book-btn').forEach(button => {
                        button.addEventListener('click', (e) => deleteBook(e.target.dataset.id));
                    });
                    setLanguage(currentLang); // Re-apply translations for dynamically added buttons
                });
            } catch (error) {
                console.error("Error setting up Firestore listener for admin books:", error);
                showMessageModal("msgErrorLoadingAdminPublications");
                if (noAdminBooksMessage) {
                    noAdminBooksMessage.textContent = translations[currentLang]['msgErrorLoadingAdminPublications'];
                }
            }
        }


        // --- Add/Edit Book Logic ---
        let editingBookId = null; // Stores the ID of the book being edited
        let currentCoverImageFile = null; // Stores the actual File object for upload
        let currentPdfFile = null; // Stores the actual File object for upload
        let currentCoverImageURL = ''; // Stores the Firebase Storage URL of the selected/existing cover image
        let currentCoverImageFileName = ''; // Stores the name of the selected/existing image file (includes timestamp)
        let currentPdfFileName = ''; // Stores the name of the selected/existing PDF file (includes timestamp)
        let currentPdfURL = ''; // Stores the Firebase Storage URL of the selected/existing PDF file


        // Helper to extract original file name from unique timestamped name (for display)
        function getOriginalFileNameFromUnique(uniqueFileName) {
            if (!uniqueFileName) return '';
            const parts = uniqueFileName.split('_');
            if (parts.length > 1 && !isNaN(Number(parts[0]))) { // Check if first part is a number (timestamp)
                parts.shift(); // Remove the timestamp
                return parts.join('_'); // Rejoin the rest
            }
            return uniqueFileName; // Return as is if no timestamp prefix
        }


        // --- Form Reset ---
        function resetBookForm() {
            if (uploadBookForm) uploadBookForm.reset();
            if (bookTitleInput) bookTitleInput.value = '';
            if (bookAuthorInput) bookAuthorInput.value = '';
            if (bookDescriptionInput) bookDescriptionInput.value = '';
            if (bookPagesInput) bookPagesInput.value = ''; // New
            if (bookFormatInput) bookFormatInput.value = ''; // New
            if (bookDoiInput) bookDoiInput.value = ''; // New
            if (bookIsbnInput) bookIsbnInput.value = ''; // New
            if (bookIssnInput) bookIssnInput.value = ''; // New
            if (bookIsNewCheckbox) bookIsNewCheckbox.checked = false; // New
            if (coverImageFileInput) coverImageFileInput.value = '';
            if (pdfFileInput) pdfFileInput.value = '';
            if (coverImageFileNameDisplay) coverImageFileNameDisplay.textContent = '';
            if (pdfFileNameDisplay) pdfFileNameDisplay.textContent = '';
            if (uploadedCoverPreview) {
                uploadedCoverPreview.src = '';
                uploadedCoverPreview.style.display = 'none';
            }
            if (formTitle) formTitle.textContent = translations[currentLang]['uploadNewPublicationTitle'];
            if (submitBookBtn) submitBookBtn.textContent = translations[currentLang]['addPublicationButton'];
            if (cancelEditBtn) cancelEditBtn.classList.add('hidden');
            editingBookId = null;
            currentCoverImageFile = null;
            currentPdfFile = null;
            currentCoverImageURL = '';
            currentCoverImageFileName = ''; // Reset unique filename
            currentPdfFileName = ''; // Reset unique filename
            currentPdfURL = '';
        }

        // Function to show book details in a modal given book ID
        window.showBookDetailsModalWithId = async function(bookId) {
            if (!isAuthReady) {
                showMessageModal("msgFirebaseNotReady");
                return;
            }
            try {
                const bookRef = doc(db, BOOKS_COLLECTION_PATH, bookId);
                const bookSnap = await getDoc(bookRef);

                if (bookSnap.exists()) {
                    showBookDetailsModal(bookSnap.data());
                } else {
                    showMessageModal("msgBookNotFound");
                }
            } catch (error) {
                console.error("Error fetching book for details:", error);
                showMessageModal("msgErrorLoadingBook");
            }
        };

        // --- Edit Book Logic ---
        async function editBook(bookId) {
            if (!isAuthReady || !isLoggedIn) {
                showMessageModal("msgLoginRequiredToEdit");
                return;
            }

            try {
                const bookRef = doc(db, BOOKS_COLLECTION_PATH, bookId);
                const bookSnap = await getDoc(bookRef);

                if (bookSnap.exists()) {
                    const bookData = bookSnap.data();
                    editingBookId = bookId;

                    // Populate the form with existing data
                    bookTitleInput.value = bookData.title;
                    bookAuthorInput.value = bookData.author;
                    bookDescriptionInput.value = bookData.description;
                    bookPagesInput.value = bookData.pages || ''; // New
                    bookFormatInput.value = bookData.format || ''; // New
                    bookDoiInput.value = bookData.doi || ''; // New
                    bookIsbnInput.value = bookData.isbn || ''; // New
                    bookIssnInput.value = bookData.issn || ''; // New
                    bookIsNewCheckbox.checked = bookData.isNew || false; // New

                    // Set cover image preview and currentCoverImageURL
                    uploadedCoverPreview.src = bookData.coverImageUrl || '';
                    uploadedCoverPreview.style.display = bookData.coverImageUrl ? 'block' : 'none';
                    coverImageFileInput.value = ''; // Important: Clear native file input value
                    currentCoverImageURL = bookData.coverImageUrl || ''; // Store the existing URL
                    currentCoverImageFileName = bookData.coverImageFileName || ''; // Store the unique filename from Firestore
                    coverImageFileNameDisplay.textContent = currentCoverImageFileName ? `${translations[currentLang]['msgCurrentCover']}: ${getOriginalFileNameFromUnique(currentCoverImageFileName)}` : translations[currentLang]['msgNoCoverSelected'];

                    // Set PDF display and currentPdfURL
                    pdfFileInput.value = ''; // Important: Clear native file input value
                    currentPdfURL = bookData.pdfUrl || ''; // Store the existing URL
                    currentPdfFileName = bookData.pdfFileName || ''; // Store the unique filename from Firestore
                    pdfFileNameDisplay.textContent = currentPdfFileName ? `${translations[currentLang]['msgCurrentPdf']}: ${getOriginalFileNameFromUnique(currentPdfFileName)}` : translations[currentLang]['msgNoPdfSelected'];


                    // Change form title and button text
                    formTitle.textContent = translations[currentLang]['editPublicationTitle'];
                    submitBookBtn.textContent = translations[currentLang]['updatePublicationButton'];
                    cancelEditBtn.classList.remove('hidden'); // Show cancel button

                    // Scroll to the form
                    window.scrollTo({ top: uploadBookForm.offsetTop, behavior: 'smooth' });
                } else {
                    showMessageModal("msgBookNotFound");
                }
            } catch (error) {
                console.error("Error fetching book for edit:", error);
                showMessageModal("msgErrorLoadingBook");
            }
        }


        // --- Delete Book Logic ---
        async function deleteBook(bookId) {
            if (!isLoggedIn) {
                showMessageModal("msgLoginRequiredToDelete");
                return;
            }
            if (!isAuthReady) {
                 showMessageModal("msgFirebaseNotReady");
                 return;
            }

            showConfirmModal("msgConfirmDelete", async (confirmed) => {
                if (confirmed) {
                    try {
                        const bookRef = doc(db, BOOKS_COLLECTION_PATH, bookId);
                        const bookSnap = await getDoc(bookRef);
                        const bookData = bookSnap.data();

                        // Attempt to delete files from Firebase Storage first
                        // Use the stored unique filenames to construct storage references
                        if (bookData.pdfFileName) {
                            try {
                                const pdfStorageRef = ref(storage, `artifacts/${firebaseConfig.projectId}/public/files/pdfs/${bookData.pdfFileName}`);
                                await deleteObject(pdfStorageRef);
                                console.log("PDF deleted from Storage:", bookData.pdfFileName);
                            } catch (storageError) {
                                console.warn("Could not delete PDF from Storage (might not exist or permission issue):", bookData.pdfFileName, storageError);
                                // showMessageModal(`Error deleting PDF: ${storageError.message}.`); // Don't block if file already gone
                            }
                        }
                        if (bookData.coverImageFileName) {
                            try {
                                const coverStorageRef = ref(storage, `artifacts/${firebaseConfig.projectId}/public/files/covers/${bookData.coverImageFileName}`);
                                await deleteObject(coverStorageRef);
                                console.log("Cover image deleted from Storage:", bookData.coverImageFileName);
                            } catch (storageError) {
                                console.warn("Could not delete cover image from Storage (might not exist or permission issue):", bookData.coverImageFileName, storageError);
                                // showMessageModal(`Error deleting cover image: ${storageError.message}.`); // Don't block if file already gone
                            }
                        }

                        // Finally, delete the document from Firestore
                        await deleteDoc(bookRef);
                        showMessageModal("msgPublicationDeleted");
                        // onSnapshot listeners will automatically update loadBooksForAdmin and loadBooks
                    } catch (error) {
                        console.error("Error removing document: ", error);
                        showMessageModal("msgErrorDeletingPublication");
                    }
                }
            });
        }

        // Initialize Firebase when the window loads
        window.onload = function() {
            initializeFirebase();
            document.getElementById('currentYear').textContent = new Date().getFullYear();
        };
    </script>
</body>
</html>
