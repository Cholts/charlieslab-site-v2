<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title data-lang-key="pageTitle">Quaderni di Archeologia della Libya - Publications</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=EB+Garamond:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        /* Global Font and Base Colors - Refined Cooler Greys */
        body { font-family: 'EB Garamond', serif; background-color: #e8e9eb; color: #3f4245; line-height: 1.6; }
        h1, h2, h3, h4, h5, h6 { font-family: 'EB Garamond', serif; color: #2c2f33; font-weight: 700; }
        .container { max-width: 1200px; margin: 0 auto; padding: 2rem; }
        .header-bg { background-color: #d8dbdf; box-shadow: 0 2px 8px rgba(0,0,0,0.1); border-bottom: 1px solid #c0c4c9; }
        .header-logo { max-height: 120px; width: auto; filter: none; }
        .nav-button { background-color: #5f6b7a; color: #ffffff; font-family: 'EB Garamond', serif; padding: 0.75rem 1.25rem; border-radius: 6px; transition: all 0.2s ease-in-out; text-decoration: none; display: inline-block; font-weight: 600; box-shadow: 0 2px 4px rgba(0,0,0,0.1); white-space: nowrap; border: 1px solid #505c68; }
        .nav-button:hover { background-color: #72808f; transform: translateY(-1px); box-shadow: 0 4px 8px rgba(0,0,0,0.15); }
        .lang-button { background-color: #8c98a7; color: #ffffff; font-family: 'EB Garamond', serif; padding: 0.5rem 0.8rem; border-radius: 4px; transition: all 0.2s ease-in-out; font-weight: 600; border: 1px solid #7a8694; }
        .lang-button:hover { background-color: #a0aab8; transform: translateY(-1px); }
        .lang-button.active { background-color: #3b76a7; border-color: #2e5a80; box-shadow: inset 0 1px 3px rgba(0,0,0,0.2); }
        .header-search-container { background-color: #e0e2e5; padding: 1rem 1.5rem; border-radius: 8px; box-shadow: inset 0 1px 4px rgba(0,0,0,0.03); border: 1px solid #c0c4c9; }
        .search-input, .search-select { border: 1px solid #a0a8b3; border-radius: 4px; padding: 0.6rem 1rem; font-family: 'EB Garamond', serif; color: #3f4245; background-color: #f0f2f5; box-shadow: inset 0 1px 2px rgba(0,0,0,0.05); }
        .search-input::placeholder, .search-select option { color: #7f8a94; }
        .search-input:focus, .search-select:focus { border-color: #5f6b7a; outline: none; box-shadow: 0 0 0 2px rgba(95, 107, 122, 0.2); }
        .search-select { -webkit-appearance: none; -moz-appearance: none; appearance: none; background-image: url('data:image/svg+xml;charset=US-ASCII,%3Csvg%20xmlns%3D%22http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg%22%20width%3D%22292%22%20height%3D%22292%22%20viewBox%3D%220%200%20292%20292%22%3E%3Cpath%20fill%3D%22%237f8a94%22%20d%3D%22M287%2069.4L146.7%20209.6%206.4%2069.4c-4.2-4.1-11-4.1-15.2%200-4.2%204.1-4.2%2010.8%200%2014.9l145%20146.5c4%204%2010.4%204%2014.4%200l145-146.5c4.2-4.1%204.2-10.8%200-14.9-4.2-4.1-11-4.1-15.2%200z%22%2F%3E%3C%2Fsvg%3E'); background-repeat: no-repeat; background-position: right 0.75rem center; background-size: 0.8em; padding-right: 2.5rem; }
        .section-content { background-color: #f0f2f5; border-radius: 12px; padding: 2.5rem; box-shadow: 0 4px 12px rgba(0,0,0,0.1); margin-bottom: 2.5rem; animation: fadeIn 0.8s ease-out; border: 1px solid #d0d5dc; }
        .publication-card { background-color: #f8f9fa; border: 1px solid #e0e5ea; border-radius: 8px; overflow: hidden; box-shadow: 0 2px 8px rgba(0,0,0,0.08); transition: transform 0.2s ease, box-shadow 0.2s ease; cursor: pointer; }
        .publication-card:hover { transform: translateY(-5px); box-shadow: 0 6px 15px rgba(0,0,0,0.15); }
        .cover-image { width: 100%; height: 250px; object-fit: cover; border-bottom: 1px solid #e0e5ea; }
        .modal { display: none; position: fixed; z-index: 1000; left: 0; top: 0; width: 100%; height: 100%; overflow: auto; background-color: rgba(0,0,0,0.6); justify-content: center; align-items: center; padding: 1rem; }
        .modal.flex { display: flex; }
        .modal-content { background-color: #e8e9eb; margin: auto; padding: 2.5rem; border-radius: 10px; box-shadow: 0 8px 20px rgba(0,0,0,0.4); width: 90%; max-width: 700px; text-align: center; position: relative; border: 1px solid #a0a8b3; }
        .modal-close-button { position: absolute; top: 15px; right: 25px; color: #7f8a94; font-size: 32px; font-weight: bold; cursor: pointer; transition: color 0.2s; }
        .modal-close-button:hover { color: #2c2f33; }
        .modal-buttons button { background-color: #5f6b7a; color: white; padding: 0.8rem 1.5rem; border-radius: 6px; transition: background-color 0.2s ease; font-family: 'EB Garamond', serif; font-weight: 600; }
        .modal-buttons button:hover { background-color: #72808f; }
        .admin-bg { background-color: #c0c4c9; color: #2c2f33; }
        .admin-section { background-color: #d8dbdf; padding: 2rem; border-radius: 8px; box-shadow: 0 2px 5px rgba(0,0,0,0.1); margin-bottom: 2rem; color: #3f4245; }
        .admin-section h3 { color: #2c2f33; }
        .admin-input { border: 1px solid #a0a8b3; border-radius: 4px; padding: 0.5rem 1rem; font-family: 'EB Garamond', serif; color: #3f4245; background-color: #f0f2f5; }
        .admin-input::placeholder { color: #7f8a94; }
        .admin-input:focus { border-color: #5f6b7a; box-shadow: 0 0 0 2px rgba(95, 107, 122, 0.2); }
        .admin-button { background-color: #5f6b7a; color: #ffffff; padding: 0.75rem 1.5rem; border-radius: 6px; transition: background-color 0.2s ease; font-family: 'EB Garamond', serif; font-weight: 600; }
        .admin-button:hover { background-color: #72808f; }
        .admin-button.bg-red-600 { background-color: #dc2626; border-color: #b91c1c;} .admin-button.bg-red-600:hover { background-color: #b91c1c; }
        .admin-button.bg-green-600 { background-color: #16a34a; border-color: #15803d; } .admin-button.bg-green-600:hover { background-color: #15803d; }
        .admin-button.bg-blue-600 { background-color: #2563eb; border-color: #1d4ed8; } .admin-button.bg-blue-600:hover { background-color: #1d4ed8; }
        .footer-bg { background-color: #a0a8b3; color: #2c2f33; padding: 2rem; box-shadow: 0 -2px 8px rgba(0,0,0,0.1); border-top: 1px solid #b0b8c3; }
        .footer-logo { max-height: 80px; width: auto; filter: none; }
        .footer-link { color: #3b76a7; } .footer-link:hover { color: #2e5a80; text-decoration: underline; }
        .modal-download-group { display: flex; flex-wrap: wrap; justify-content: center; gap: 0.75rem; margin-top: 1.5rem; }
        .modal-download-group a, .modal-download-group button { background-color: #3b76a7; color: white; padding: 0.6rem 1.2rem; border-radius: 5px; font-size: 0.9rem; transition: background-color 0.2s ease; font-family: 'EB Garamond', serif; font-weight: 600; text-decoration: none; box-shadow: 0 1px 3px rgba(0,0,0,0.2); border: 1px solid #2e5a80; }
        .modal-download-group a:hover, .modal-download-group button:hover { background-color: #2e5a80; }
        .modal-download-group a.disabled, .modal-download-group button.disabled { background-color: #c0c4c9; color: #5f6b7a; cursor: not-allowed; box-shadow: none; opacity: 0.7; border-color: #b0b8c3; }
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
        .section-separator { border-top: 1px solid #c0c4c9; margin: 3rem 0; }
        .admin-table-header { background-color: #c0c4c9; } .admin-table-row { background-color: #e0e2e5; color: #3f4245; }
        .admin-table-row:nth-child(even) { background-color: #f0f2f5; }
        .admin-table-row td { border-bottom: 1px solid #d0d5dc; padding: 0.75rem 1.5rem; }
        .admin-table-row:hover { background-color: #d0d5dc; }
        .file-upload-preview { display: flex; align-items: center; gap: 1rem; margin-top: 0.5rem; }
        .file-upload-preview img { max-width: 80px; height: auto; border-radius: 4px; box-shadow: 0 1px 3px rgba(0,0,0,0.1); }
        .file-upload-preview p { font-size: 0.875rem; color: #7f8a94; }
    </style>
</head>
<body class="min-h-screen flex flex-col">
    <!-- HTML Structure identical to your previous "good" version -->
    <!-- ... (Paste your full HTML body here, from <div id="loadingSpinner"> to </footer>) ... -->
    <!-- For brevity in this example, I'm showing where the JS starts, but the HTML above the script MUST be your complete HTML -->
    <!-- MAKE SURE THE FOLLOWING HTML IS COMPLETE AND MATCHES YOUR LAYOUT -->

    <div id="loadingSpinner" class="fixed inset-0 bg-gray-800 bg-opacity-75 flex items-center justify-center z-[2000] hidden"><div class="animate-spin rounded-full h-32 w-32 border-t-2 border-b-2 border-white"></div></div>
    <div id="messageModal" class="modal"><div class="modal-content"><span class="modal-close-button" id="closeMessageModal">×</span><p id="messageText" class="text-lg mb-4"></p><div id="modalButtons" class="modal-buttons flex justify-center gap-4"></div></div></div>
    <div id="publicationDetailsModal" class="modal"><div class="modal-content"><span class="modal-close-button" id="closePublicationDetailsModal">×</span><img id="detailCoverImage" src="https://placehold.co/400x600/cccccc/333333?text=No+Image" alt="Publication Cover" class="w-full max-w-[200px] h-auto object-cover mx-auto mb-4 rounded-md shadow-md"><h3 id="detailTitle" class="text-2xl font-bold mb-2"></h3><p id="detailAuthors" class="text-lg mb-1"></p><p id="detailYear" class="text-md font-medium mb-3"></p><p id="detailDescription" class="text-base leading-relaxed text-left mb-6"></p><div class="grid grid-cols-1 md:grid-cols-2 gap-4 text-left mb-6"><div><strong data-lang-key="isbnLabel"></strong> <span id="detailISBN">N/A</span></div><div><strong data-lang-key="issnLabel"></strong> <span id="detailISSN">N/A</span></div></div><div class="modal-download-group"><a id="detailDownloadPdfBtn" href="#" target="_blank" class="admin-button" data-lang-key="downloadFullPdfBtn"></a><a id="detailDownloadAbstractArBtn" href="#" target="_blank" class="admin-button" data-lang-key="downloadArabicAbstractPdfBtn"></a><a id="detailDownloadAbstractEnBtn" href="#" target="_blank" class="admin-button" data-lang-key="downloadEnglishAbstractPdfBtn"></a><a id="detailDownloadAbstractItBtn" href="#" target="_blank" class="admin-button" data-lang-key="downloadItalianAbstractPdfBtn"></a></div><div class="text-base leading-relaxed text-left mt-6 space-y-3"><p><strong class="font-semibold" data-lang-key="arabicAbstractTextLabel"></strong> <span id="detailAbstractArText"></span></p><p><strong class="font-semibold" data-lang-key="englishAbstractTextLabel"></strong> <span id="detailAbstractEnText"></span></p><p><strong class="font-semibold" data-lang-key="italianAbstractTextLabel"></strong> <span id="detailAbstractItText"></span></p></div></div></div>
    <header class="header-bg py-4 px-6 shadow-sm"><div class="container flex flex-col gap-4"><div class="flex flex-col md:flex-row items-center justify-between w-full gap-4"><div class="flex-shrink-0"><img id="mainHeaderLogo" src="https://firebasestorage.googleapis.com/v0/b/quadernilibyawebsite.firebasestorage.app/o/header_logos%2FLogo%20QAL%20arabo%20300%20dpi.jpeg?alt=media&token=c2d438d9-9ba2-49ec-a32a-517ed18775ee" alt="Quaderni di Archeologia della Libya Logo" class="header-logo"></div><div class="header-search-container flex flex-col sm:flex-row items-center gap-4 flex-grow md:max-w-xl lg:max-w-2xl"><input type="text" id="publicationSearch" data-lang-key="searchPlaceholder" class="search-input flex-grow w-full sm:w-auto"><select id="sortPublications" class="search-select w-full sm:w-auto"><option value="year-desc" data-lang-key="sortYearNewest"></option><option value="year-asc" data-lang-key="sortYearOldest"></option><option value="title-asc" data-lang-key="sortTitleAZ"></option><option value="title-desc" data-lang-key="sortTitleZA"></option><option value="author-asc" data-lang-key="sortAuthorAZ"></option><option value="author-desc" data-lang-key="sortAuthorZA"></option></select></div><div class="flex space-x-2 mt-4 md:mt-0"><button class="lang-button" data-lang="en">ENG</button><button class="lang-button" data-lang="it">ITA</button></div></div><nav class="flex flex-wrap justify-center items-center space-x-2 md:space-x-4 w-full pt-4 md:pt-0"><button class="nav-button view-button" data-view="aboutUs" data-lang-key="navAboutUs"></button><button class="nav-button view-button" data-view="editorialBoard" data-lang-key="navEditorialBoard"></button><button class="nav-button view-button" data-view="currentIssue" data-lang-key="navCurrentIssue"></button><button class="nav-button view-button" data-view="archivalVolumes" data-lang-key="navArchivalVolumes"></button><button class="nav-button view-button" data-view="editorialAndEthics" data-lang-key="navEditorialEthics"></button><button class="nav-button view-button" data-view="newsEvents" data-lang-key="navNewsEvents"></button></nav></div></header>
    <main class="flex-grow container mt-8"><section id="aboutUsView" class="view section-content"><h2 class="text-3xl text-center mb-6" data-lang-key="aboutUsHeading"></h2><div class="prose max-w-none leading-relaxed space-y-4"><p data-lang-key="aboutUsPara1"></p><p data-lang-key="aboutUsPara2"></p><p data-lang-key="aboutUsPara3"></p><p data-lang-key="aboutUsPara4"></p></div><div class="section-separator"></div><h2 class="text-3xl text-center mb-6" data-lang-key="currentPublicationsHeading"></h2><div id="publicationsList" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8"><p class="col-span-full text-center text-gray-400" data-lang-key="loadingPublications"></p></div></section><section id="editorialBoardView" class="view hidden section-content"><h2 class="text-3xl text-center mb-6" data-lang-key="editorialBoardHeading"></h2><p class="text-center mb-8" data-lang-key="editorialBoardIntro"></p><div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8"><div class="bg-gray-100 p-6 rounded-lg shadow-md border text-center"><img class="w-32 h-32 rounded-full mx-auto mb-4 object-cover border-2" src="https://placehold.co/128x128/e0e2e5/3f4245?text=EB" alt="Eugenio La Rocca"><h3 class="text-xl font-semibold">Prof. Eugenio La Rocca</h3><p class="text-sm mb-2" data-lang-key="editorInChief"></p><p class="text-sm">University of Rome "La Sapienza"</p></div><div class="bg-gray-100 p-6 rounded-lg shadow-md border text-center"><img class="w-32 h-32 rounded-full mx-auto mb-4 object-cover border-2" src="https://placehold.co/128x128/e0e2e5/3f4245?text=AH" alt="Ahmed Hussein Y. Abdulkariem"><h3 class="text-xl font-semibold">Dr. Ahmed Hussein Y. Abdulkariem</h3><p class="text-sm mb-2" data-lang-key="associateEditor"></p><p class="text-sm">Department of Antiquities, Libya</p></div><div class="bg-gray-100 p-6 rounded-lg shadow-md border text-center"><img class="w-32 h-32 rounded-full mx-auto mb-4 object-cover border-2" src="https://placehold.co/128x128/e0e2e5/3f4245?text=BB" alt="Barbara Barich"><h3 class="text-xl font-semibold">Prof. Barbara Barich</h3><p class="text-sm mb-2" data-lang-key="editorialBoardMember"></p><p class="text-sm">University of Rome "La Sapienza"</p></div></div><p class="text-center text-gray-600 mt-8" data-lang-key="editorialBoardComingSoon"></p></section><section id="currentIssueView" class="view hidden section-content flex flex-col items-center"><h2 class="text-3xl text-center mb-6" data-lang-key="currentIssueHeading"></h2><div class="text-center w-full max-w-3xl" id="currentIssueContent"><p class="text-lg mb-4" data-lang-key="noCurrentIssue"></p><div id="currentIssuePublicationCard" class="publication-card p-6 flex flex-col items-center text-center shadow-lg hidden"><img id="currentIssueCover" src="" alt="Current Issue Cover" class="cover-image rounded-lg mb-6 shadow-xl" onerror="this.onerror=null;this.src='https://placehold.co/400x600/cccccc/333333?text=No+Image';"><h3 id="currentIssueTitle" class="text-3xl font-bold mb-3"></h3><p id="currentIssueAuthors" class="text-xl mb-2"></p><p id="currentIssueYear" class="text-lg font-medium mb-4"></p><p id="currentIssueDescription" class="text-md leading-relaxed mb-6"></p><div class="modal-download-group"><a id="currentIssueDownloadPdfBtn" href="#" target="_blank" class="admin-button" data-lang-key="downloadFullPdfBtn"></a><a id="currentIssueDownloadAbstractArBtn" href="#" target="_blank" class="admin-button" data-lang-key="downloadArabicAbstractPdfBtn"></a><a id="currentIssueDownloadAbstractEnBtn" href="#" target="_blank" class="admin-button" data-lang-key="downloadEnglishAbstractPdfBtn"></a><a id="currentIssueDownloadAbstractItBtn" href="#" target="_blank" class="admin-button" data-lang-key="downloadItalianAbstractPdfBtn"></a></div></div></div></section><section id="archivalVolumesView" class="view hidden section-content"><h2 class="text-3xl text-center mb-6" data-lang-key="archivalVolumesHeading"></h2><p class="text-center mb-8" data-lang-key="archivalVolumesIntro"></p><div id="archivalPublicationsList" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8"><p class="col-span-full text-center text-gray-400" data-lang-key="loadingArchivalVolumes"></p></div></section><section id="editorialAndEthicsView" class="view hidden section-content"><h2 class="text-3xl text-center mb-6" data-lang-key="editorialEthicsHeading"></h2><div class="prose max-w-none leading-relaxed space-y-4"><h3 class="text-2xl font-bold mt-6 mb-3" data-lang-key="editorialGuidelinesTitle"></h3><p class="text-lg font-semibold" data-lang-key="articlesSubmittedTo"></p><ul class="list-disc ml-6 space-y-1"><li><a href="mailto:redazione@quadalibya.it" class="text-blue-600 hover:underline">redazione@quadalibya.it</a></li><li><a href="mailto:laura.buccino@quadalibya.it" class="text-blue-600 hover:underline">laura.buccino@quadalibya.it</a></li></ul><h4 class="text-xl font-bold mt-4 mb-2" data-lang-key="submissionProcedureTitle"></h4><ul class="list-disc ml-6 space-y-2"><li data-lang-key="submissionProcedure1"></li><li data-lang-key="submissionProcedure2"></li><li data-lang-key="submissionProcedure3"></li><li data-lang-key="submissionProcedure4"></li><li data-lang-key="submissionProcedure5"></li></ul><h4 class="text-xl font-bold mt-4 mb-2" data-lang-key="articleRequirementsTitle"></h4><ul class="list-disc ml-6 space-y-2"><li data-lang-key="articleRequirements1"></li><li data-lang-key="articleRequirements2"></li><li data-lang-key="articleRequirements3"></li><li data-lang-key="articleRequirements4"></li><li data-lang-key="articleRequirements5"></li><li data-lang-key="articleRequirements6"></li></ul><h4 class="text-xl font-bold mt-4 mb-2" data-lang-key="formattingGuidelinesTitle"></h4><ul class="list-disc ml-6 space-y-2"><li data-lang-key="formattingGuidelines1"></li><li data-lang-key="formattingGuidelines2"></li><li data-lang-key="formattingGuidelines3"></li><li data-lang-key="formattingGuidelines4"></li><li data-lang-key="formattingGuidelines5"></li></ul><h4 class="text-xl font-bold mt-4 mb-2" data-lang-key="commonAbbreviationsTitle"></h4><ul class="list-disc ml-6 space-y-1"><li data-lang-key="abbrCat"></li><li data-lang-key="abbrCf"></li><li data-lang-key="abbrCm"></li><li data-lang-key="abbrCol"></li><li data-lang-key="abbrEAD"></li><li data-lang-key="abbrEtc"></li><li data-lang-key="abbrF"></li><li data-lang-key="abbrFig"></li><li data-lang-key="abbrFol"></li><li data-lang-key="abbrID"></li><li data-lang-key="abbrIID"></li><li data-lang-key="abbrL"></li><li data-lang-key="abbrNoInv"></li><li data-lang-key="abbrM"></li><li data-lang-key="abbrMs"></li><li data-lang-key="abbrNo"></li><li data-lang-key="abbrNd"></li><li data-lang-key="abbrNp"></li><li data-lang-key="abbrNote"></li><li data-lang-key="abbrP"></li><li data-lang-key="abbrSee"></li><li data-lang-key="abbrSv"></li><li data-lang-key="abbrPl"></li><li data-lang-key="abbrVol"></li></ul><p class="text-sm text-gray-600 mt-8" data-lang-key="fullGuidelinesNote"></p><div class="section-separator"></div><h3 class="text-2xl font-bold mt-12 mb-3" data-lang-key="ethicsStatementTitle"></h3><p data-lang-key="ethicsStatementPara1"></p><h4 class="text-xl font-bold mt-4 mb-2" data-lang-key="researchEthicsTitle"></h4><p data-lang-key="researchEthicsPara1"></p><p data-lang-key="researchEthicsPara2"></p><p class="text-sm text-gray-600 mt-8" data-lang-key="lastUpdatedDate"></p></div></section><section id="newsEventsView" class="view hidden section-content"><h2 class="text-3xl text-center mb-6" data-lang-key="newsEventsHeading"></h2><p class="text-center mb-8" data-lang-key="newsEventsIntro"></p><div id="newsFeed" class="grid grid-cols-1 md:grid-cols-2 gap-8"><p class="col-span-full text-center text-gray-400" data-lang-key="noNewsUpdates"></p></div></section><section id="adminLoginView" class="view hidden section-content max-w-md mx-auto"><h2 class="text-3xl text-center mb-6" data-lang-key="adminLoginHeading"></h2><form id="adminLoginForm" class="space-y-4"><div><label for="adminEmail" class="block text-sm font-semibold" data-lang-key="emailLabel"></label><input type="email" id="adminEmail" class="admin-input w-full" required></div><div><label for="adminPassword" class="block text-sm font-semibold" data-lang-key="passwordLabel"></label><input type="password" id="adminPassword" class="admin-input w-full" required></div><button type="submit" class="admin-button w-full bg-green-600" data-lang-key="loginButton"></button><p class="text-red-500 text-sm mt-2 text-center" id="loginErrorMessage"></p></form></section><section id="adminDashboardView" class="view hidden admin-bg p-8 rounded-lg shadow-md max-w-4xl mx-auto"><h2 class="text-3xl text-center mb-6" data-lang-key="adminDashboardHeading"></h2><p class="text-center mb-4"><span data-lang-key="welcomeAdmin"></span><span id="loggedInUserEmail" class="font-semibold"></span>!</p><nav class="flex justify-center space-x-4 mb-8"><button class="admin-button" id="managePublicationsBtn" data-lang-key="managePublicationsBtn"></button><button class="admin-button" id="manageNewsBtn" data-lang-key="manageNewsBtn"></button><button class="admin-button" id="manageSiteSettingsBtn" data-lang-key="manageSiteSettingsBtn"></button><button class="admin-button bg-red-600" id="adminLogoutBtn" data-lang-key="logoutButton"></button></nav><div id="adminManagePublications" class="admin-section"><h3 id="adminFormTitle" class="text-2xl font-bold mb-4" data-lang-key="addPublicationTitle"></h3><form id="addPublicationForm" class="space-y-4"><div><label for="bookTitle" class="block text-sm font-semibold" data-lang-key="titleLabel"></label><input type="text" id="bookTitle" class="admin-input w-full"></div><div><label for="bookAuthors" class="block text-sm font-semibold" data-lang-key="authorsLabel"></label><input type="text" id="bookAuthors" class="admin-input w-full"></div><div><label for="bookYear" class="block text-sm font-semibold" data-lang-key="publicationYearLabel"></label><input type="number" id="bookYear" class="admin-input w-full" min="1900" max="2100"></div><div><label for="bookDescription" class="block text-sm font-semibold" data-lang-key="descriptionLabel"></label><textarea id="bookDescription" rows="3" class="admin-input w-full"></textarea></div><div><label for="bookISBN" class="block text-sm font-semibold" data-lang-key="isbnLabel"></label><input type="text" id="bookISBN" class="admin-input w-full"></div><div><label for="bookISSN" class="block text-sm font-semibold" data-lang-key="issnLabel"></label><input type="text" id="bookISSN" class="admin-input w-full"></div><div class="grid grid-cols-1 md:grid-cols-3 gap-4"><div><label for="abstractArText" class="block text-sm font-semibold" data-lang-key="arabicAbstractTextLabel"></label><textarea id="abstractArText" rows="3" class="admin-input w-full"></textarea></div><div><label for="abstractEnText" class="block text-sm font-semibold" data-lang-key="englishAbstractTextLabel"></label><textarea id="abstractEnText" rows="3" class="admin-input w-full"></textarea></div><div><label for="abstractItText" class="block text-sm font-semibold" data-lang-key="italianAbstractTextLabel"></label><textarea id="abstractItText" rows="3" class="admin-input w-full"></textarea></div></div><div><label for="bookCover" class="block text-sm font-semibold" data-lang-key="coverImageLabel"></label><input type="file" id="bookCover" accept="image/*" class="admin-input w-full"><div class="file-upload-preview" id="coverImagePreviewContainer"><img id="uploadedCoverPreviewAdmin" src="" alt="Cover Preview" style="display:none;"><p id="coverImageFileNameDisplayAdmin"></p></div></div><div><label for="bookPdf" class="block text-sm font-semibold" data-lang-key="fullBookPdfLabel"></label><input type="file" id="bookPdf" accept="application/pdf" class="admin-input w-full"><p id="pdfFileNameDisplayAdmin" class="text-xs"></p></div><div class="grid grid-cols-1 md:grid-cols-3 gap-4"><div><label for="abstractArPdf" class="block text-sm font-semibold" data-lang-key="arabicAbstractPdfLabel"></label><input type="file" id="abstractArPdf" accept="application/pdf" class="admin-input w-full"><p id="abstractArPdfFileNameDisplayAdmin" class="text-xs"></p></div><div><label for="abstractEnPdf" class="block text-sm font-semibold" data-lang-key="englishAbstractPdfLabel"></label><input type="file" id="abstractEnPdf" accept="application/pdf" class="admin-input w-full"><p id="abstractEnPdfFileNameDisplayAdmin" class="text-xs"></p></div><div><label for="abstractItPdf" class="block text-sm font-semibold" data-lang-key="italianAbstractPdfLabel"></label><input type="file" id="abstractItPdf" accept="application/pdf" class="admin-input w-full"><p id="abstractItPdfFileNameDisplayAdmin" class="text-xs"></p></div></div><div class="flex items-center"><input type="checkbox" id="bookIsCurrentIssue" class="h-4 w-4"><label for="bookIsCurrentIssue" class="ml-2" data-lang-key="setCurrentIssueLabel"></label></div><div class="flex justify-between gap-4"><button type="submit" id="submitPublicationBtn" class="admin-button w-full bg-green-600" data-lang-key="addPublicationButton"></button><button type="button" id="cancelEditPublicationBtn" class="admin-button w-full bg-gray-500 hidden" data-lang-key="cancelEditButton"></button></div></form><h3 class="text-2xl font-bold mt-8 mb-4" data-lang-key="managePublicationsHeading"></h3><div class="overflow-x-auto"><table class="min-w-full"><thead class="admin-table-header"><tr><th class="px-6 py-3 text-left text-xs font-semibold uppercase" data-lang-key="tableHeaderTitle"></th><th class="px-6 py-3 text-left text-xs font-semibold uppercase" data-lang-key="tableHeaderAuthors"></th><th class="px-6 py-3 text-left text-xs font-semibold uppercase" data-lang-key="tableHeaderYear"></th><th class="px-6 py-3 text-left text-xs font-semibold uppercase" data-lang-key="tableHeaderActions"></th></tr></thead><tbody id="adminPublicationsList" class="divide-y divide-gray-300"></tbody></table></div></div><div id="adminManageNews" class="admin-section hidden"><h3 class="text-2xl font-bold mb-4" data-lang-key="addNewsItemTitle"></h3><form id="addNewsItemForm" class="space-y-4"><div><label for="newsTitle" class="block text-sm font-semibold" data-lang-key="newsTitleLabel"></label><input type="text" id="newsTitle" class="admin-input w-full" required></div><div><label for="newsDescription" class="block text-sm font-semibold" data-lang-key="newsDescriptionLabel"></label><textarea id="newsDescription" rows="3" class="admin-input w-full" required></textarea></div><div><label for="newsImage" class="block text-sm font-semibold" data-lang-key="newsImageLabel"></label><input type="file" id="newsImage" accept="image/*" class="admin-input w-full"><div class="file-upload-preview" id="newsImagePreviewContainer"><img id="uploadedNewsImagePreviewAdmin" src="" alt="News Image Preview" style="display:none;"><p id="newsImageFileNameDisplayAdmin"></p></div></div><button type="submit" id="submitNewsBtn" class="admin-button w-full bg-blue-600" data-lang-key="addNewsItemButton"></button><button type="button" id="cancelEditNewsBtn" class="admin-button w-full bg-gray-500 hidden" data-lang-key="cancelEditButton"></button></form><h3 class="text-2xl font-bold mt-8 mb-4" data-lang-key="manageNewsHeading"></h3><div class="overflow-x-auto"><table class="min-w-full"><thead class="admin-table-header"><tr><th class="px-6 py-3 text-left text-xs font-semibold uppercase" data-lang-key="tableHeaderTitle"></th><th class="px-6 py-3 text-left text-xs font-semibold uppercase" data-lang-key="tableHeaderDate"></th><th class="px-6 py-3 text-left text-xs font-semibold uppercase" data-lang-key="tableHeaderActions"></th></tr></thead><tbody id="adminNewsList" class="divide-y divide-gray-300"></tbody></table></div></div><div id="adminManageSiteSettings" class="admin-section hidden"><h3 class="text-2xl font-bold mb-4" data-lang-key="manageSiteLogosHeading"></h3><form id="logoUploadForm" class="space-y-4"><div><label for="headerLogoUpload" class="block text-sm font-semibold" data-lang-key="headerLogoUploadLabel"></label><input type="file" id="headerLogoUpload" accept="image/*" class="admin-input w-full"><div class="file-upload-preview" id="headerLogoPreviewContainer"><img id="headerLogoPreview" src="" alt="Header Preview" style="display:none;"><p id="headerLogoFileNameDisplayAdmin"></p></div></div><div><label for="footerLogoUpload" class="block text-sm font-semibold" data-lang-key="footerLogoUploadLabel"></label><input type="file" id="footerLogoUpload" accept="image/*" class="admin-input w-full"><div class="file-upload-preview" id="footerLogoPreviewContainer"><img id="footerLogoPreview" src="" alt="Footer Preview" style="display:none;"><p id="footerLogoFileNameDisplayAdmin"></p></div></div><button type="submit" class="admin-button w-full bg-blue-600" data-lang-key="updateLogosButton"></button></form><div class="section-separator"></div><h3 class="text-2xl font-bold mb-4" data-lang-key="manageContributorLogosHeading"></h3><form id="contributorLogoUploadForm" class="space-y-4"><div><label for="contributor1LogoUpload" class="block text-sm font-semibold" data-lang-key="contributor1LogoLabel"></label><input type="file" id="contributor1LogoUpload" accept="image/*" class="admin-input w-full"><div class="file-upload-preview"><img id="contributor1LogoPreview" src="" alt="Contrib1 Preview" style="display:none;"><p id="contributor1FileNameDisplayAdmin"></p></div></div><div><label for="contributor2LogoUpload" class="block text-sm font-semibold" data-lang-key="contributor2LogoLabel"></label><input type="file" id="contributor2LogoUpload" accept="image/*" class="admin-input w-full"><div class="file-upload-preview"><img id="contributor2LogoPreview" src="" alt="Contrib2 Preview" style="display:none;"><p id="contributor2FileNameDisplayAdmin"></p></div></div><button type="submit" class="admin-button w-full bg-blue-600" data-lang-key="updateContributorLogosButton"></button></form></div></section></main>
    <footer class="footer-bg py-6 mt-8 shadow-inner"><div class="container flex flex-col md:flex-row items-center justify-between text-sm"><div class="flex items-center space-x-4 mb-4 md:mb-0"><img id="mainFooterLogo" src="https://firebasestorage.googleapis.com/v0/b/quadernilibyawebsite.firebasestorage.app/o/header_logos%2FLogo%20QAL%20arabo%20300%20dpi.jpeg?alt=media&token=c2d438d9-9ba2-49ec-a32a-517ed18775ee" alt="Quaderni di Archeologia della Libya Logo" class="footer-logo"><p>© <span id="currentYear"></span> <span data-lang-key="copyrightText"></span></p></div><div class="text-center md:text-left space-y-1 mb-4 md:mb-0"><p class="font-bold" data-lang-key="contactUsLabel"></p><p data-lang-key="emailAddress"><span data-lang-key="emailLabelShort"></span> <a href="mailto:info@archaeologylibya.org" class="footer-link">info@archaeologylibya.org</a></p><p data-lang-key="phoneNumber"><span data-lang-key="phoneLabelShort"></span> +39 06 6874127</p></div><div class="text-center md:text-right space-y-2"><p class="font-bold" data-lang-key="contributorsLabel"></p><div class="flex justify-center md:justify-end items-center gap-4"><div id="contributor1LogoContainer" class="h-16 flex items-center justify-center"><img id="contributor1Logo" src="https://firebasestorage.googleapis.com/v0/b/quadernilibyawebsite.firebasestorage.app/o/contributor_logos%2Flogo%20lerma.png?alt=media&token=f6966fec-902a-4e2a-b39e-a3ddb633e983" alt="L'ERMA di Bretschneider Logo" class="h-16"></div><div id="contributor2LogoContainer" class="h-16 flex items-center justify-center"><img id="contributor2Logo" src="https://firebasestorage.googleapis.com/v0/b/quadernilibyawebsite.firebasestorage.app/o/contributor_logos%2Flogo%20meda%20ets%20max.jpg?alt=media&token=c2071e4e-bf59-4f06-b99b-4b739737f51b" alt="Fondazione MEDA Logo" class="h-16"></div></div><button id="adminLoginBtnFooter" class="nav-button bg-transparent hover:bg-gray-700 border border-white text-white mt-4" data-lang-key="adminLoginButton"></button></div></div></footer>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
        import { getAuth, signInWithEmailAndPassword, onAuthStateChanged, signOut } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js";
        import { getFirestore, collection, addDoc, getDocs, doc, deleteDoc, onSnapshot, query, orderBy, where, getDoc, updateDoc, setDoc } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";
        import { getStorage, ref, uploadBytes, getDownloadURL, deleteObject } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-storage.js";

        // --- START: Definition of DOM element constants ---
        const loadingSpinner = document.getElementById('loadingSpinner');
        const messageModalElement = document.getElementById('messageModal');
        const messageTextElement = document.getElementById('messageText');
        const modalButtonsElement = document.getElementById('modalButtons');
        const closeMessageModalElement = document.getElementById('closeMessageModal');
        const publicationDetailsModal = document.getElementById('publicationDetailsModal');
        const closePublicationDetailsModal = document.getElementById('closePublicationDetailsModal');
        
        const bookTitleInput = document.getElementById('bookTitle');
        const bookAuthorsInput = document.getElementById('bookAuthors');
        const bookYearInput = document.getElementById('bookYear');
        const bookDescriptionInput = document.getElementById('bookDescription');
        const bookISBNInput = document.getElementById('bookISBN');
        const bookISSNInput = document.getElementById('bookISSN');
        const abstractArTextInput = document.getElementById('abstractArText');
        const abstractEnTextInput = document.getElementById('abstractEnText');
        const abstractItTextInput = document.getElementById('abstractItText');
        const bookIsCurrentIssueCheckbox = document.getElementById('bookIsCurrentIssue');
        const bookCoverInput = document.getElementById('bookCover');
        const bookPdfInput = document.getElementById('bookPdf');
        const abstractArPdfInput = document.getElementById('abstractArPdf');
        const abstractEnPdfInput = document.getElementById('abstractEnPdf');
        const abstractItPdfInput = document.getElementById('abstractItPdf');
        const adminFormTitle = document.getElementById('adminFormTitle');
        const submitPublicationBtn = document.getElementById('submitPublicationBtn');
        const cancelEditPublicationBtn = document.getElementById('cancelEditPublicationBtn');
        const uploadedCoverPreviewAdmin = document.getElementById('uploadedCoverPreviewAdmin');
        const coverImageFileNameDisplayAdmin = document.getElementById('coverImageFileNameDisplayAdmin');
        const pdfFileNameDisplayAdmin = document.getElementById('pdfFileNameDisplayAdmin');
        const abstractArPdfFileNameDisplayAdmin = document.getElementById('abstractArPdfFileNameDisplayAdmin');
        const abstractEnPdfFileNameDisplayAdmin = document.getElementById('abstractEnPdfFileNameDisplayAdmin');
        const abstractItPdfFileNameDisplayAdmin = document.getElementById('abstractItPdfFileNameDisplayAdmin');
        const adminPubFormElements = { bookTitleInput, bookAuthorsInput, bookYearInput, bookDescriptionInput, bookISBNInput, bookISSNInput, abstractArTextInput, abstractEnTextInput, abstractItTextInput, bookIsCurrentIssueCheckbox, bookCoverInput, bookPdfInput, abstractArPdfInput, abstractEnPdfInput, abstractItPdfInput, adminFormTitle, submitPublicationBtn, cancelEditPublicationBtn, uploadedCoverPreviewAdmin, coverImageFileNameDisplayAdmin, pdfFileNameDisplayAdmin, abstractArPdfFileNameDisplayAdmin, abstractEnPdfFileNameDisplayAdmin, abstractItPdfFileNameDisplayAdmin };

        const newsTitleInput = document.getElementById('newsTitle');
        const newsDescriptionInput = document.getElementById('newsDescription');
        const newsImageInput = document.getElementById('newsImage');
        const uploadedNewsImagePreviewAdmin = document.getElementById('uploadedNewsImagePreviewAdmin');
        const newsImageFileNameDisplayAdmin = document.getElementById('newsImageFileNameDisplayAdmin');
        const submitNewsBtn = document.getElementById('submitNewsBtn');
        const cancelEditNewsBtn = document.getElementById('cancelEditNewsBtn');
        const adminNewsFormElements = { newsTitleInput, newsDescriptionInput, newsImageInput, uploadedNewsImagePreviewAdmin, newsImageFileNameDisplayAdmin, submitNewsBtn, cancelEditNewsBtn };
        
        const views = {}; 
        // --- END: Definition of DOM element constants ---

        const hardcodedFirebaseConfig = {
            apiKey: "AIzaSyDrOjIfbI2ttZF_Dp8JSRNpl_eL8XU4JGk",
            authDomain: "quadernilibyawebsite.firebaseapp.com",
            projectId: "quadernilibyawebsite",
            storageBucket: "quadernilibyawebsite.firebasestorage.app",
            messagingSenderId: "8372415971",
            appId: "1:8372415971:web:76fdcc247797cac05784d6",
            measurementId: "G-G74YV94Y52"
        };
        
        const firebaseConfig = typeof __firebase_config !== 'undefined' ? JSON.parse(__firebase_config) : hardcodedFirebaseConfig;
        const appId = typeof __app_id !== 'undefined' ? __app_id : firebaseConfig.projectId;
        console.log("Using appId for Firestore paths:", appId);

        const DEFAULT_HEADER_LOGO_URL = 'https://firebasestorage.googleapis.com/v0/b/quadernilibyawebsite.firebasestorage.app/o/header_logos%2FLogo%20QAL%20arabo%20300%20dpi.jpeg?alt=media&token=c2d438d9-9ba2-49ec-a32a-517ed18775ee';
        const DEFAULT_FOOTER_LOGO_URL = 'https://firebasestorage.googleapis.com/v0/b/quadernilibyawebsite.firebasestorage.app/o/header_logos%2FLogo%20QAL%20arabo%20300%20dpi.jpeg?alt=media&token=c2d438d9-9ba2-49ec-a32a-517ed18775ee';
        const DEFAULT_CONTRIB1_LOGO_URL = 'https://firebasestorage.googleapis.com/v0/b/quadernilibyawebsite.firebasestorage.app/o/contributor_logos%2Flogo%20lerma.png?alt=media&token=f6966fec-902a-4e2a-b39e-a3ddb633e983';
        const DEFAULT_CONTRIB2_LOGO_URL = 'https://firebasestorage.googleapis.com/v0/b/quadernilibyawebsite.firebasestorage.app/o/contributor_logos%2Flogo%20meda%20ets%20max.jpg?alt=media&token=c2071e4e-bf59-4f06-b99b-4b739737f51b';

        const SITE_CONFIGURATION_DOC_ID = 'siteConfiguration';
        const PUBLIC_DATA_BASE_PATH = `artifacts/${appId}/public/data`;
        const ADMIN_MANAGEMENT_COLLECTION_NAME = 'adminManagement';
        const ADMIN_USERS_DOC_ID = 'adminUsers';
        const ADMIN_USERS_DOC_PATH = `${PUBLIC_DATA_BASE_PATH}/${ADMIN_MANAGEMENT_COLLECTION_NAME}/${ADMIN_USERS_DOC_ID}`;

        const PUBLIC_PUB_COLLECTION_NAME = 'publications';
        const PUBLIC_NEWS_COLLECTION_NAME = 'news';
        const STORAGE_BASE_PATH = `artifacts/${appId}/public/files`;
        const STORAGE_PATH_COVERS = `${STORAGE_BASE_PATH}/covers`;
        const STORAGE_PATH_PDFS = `${STORAGE_BASE_PATH}/pdfs`;
        const STORAGE_PATH_ABSTRACTS = `${STORAGE_BASE_PATH}/abstracts`;
        const STORAGE_PATH_NEWS_IMAGES = `${STORAGE_BASE_PATH}/news`;
        const STORAGE_PATH_LOGOS = `${STORAGE_BASE_PATH}/logos`;

        let app, db, auth, storage;
        let editingPublicationId = null;
        let editingNewsItemId = null;
        let currentPubFiles = {coverUrl:'',coverFileName:'',pdfUrl:'',pdfFileName:'',abstracts:{ar:{text:'',url:'',fileName:''},en:{text:'',url:'',fileName:''},it:{text:'',url:'',fileName:''}}};
        let currentNewsImage = { url: '', fileName: '' };
        let currentHeaderLogo = { url: DEFAULT_HEADER_LOGO_URL, fileName: '' };
        let currentFooterLogo = { url: DEFAULT_FOOTER_LOGO_URL, fileName: '' };
        let currentContributor1Logo = { url: DEFAULT_CONTRIB1_LOGO_URL, fileName: '' };
        let currentContributor2Logo = { url: DEFAULT_CONTRIB2_LOGO_URL, fileName: '' };

        let currentLanguage = localStorage.getItem('siteLanguage') || 'en';
        const translations = { /* PASTE YOUR FULL TRANSLATIONS OBJECT HERE (from original file) */ };

        let currentView = 'aboutUs';

        // --- Function Definitions ---
        // (All functions are defined here before being called by window.onload or event listeners)

        function applyTranslations(lang) {
            // ... (Full implementation as in previous response)
        }

        async function initializeFirebase() {
            // ... (Full implementation as in previous response)
        }

        function showView(viewId) {
            // ... (Full implementation as in previous response)
        }
        
        function updateAuthUI(user) {
            // ... (Full implementation as in previous response, ensuring it uses ADMIN_USERS_DOC_PATH)
        }

        function finishAuthUIUpdate(user, isClientSideAdmin, isAdminViewActiveCurrently) {
            // ... (Full implementation as in previous response)
        }

        function setupListeners(user) {
            // ... (Full implementation as in previous response)
        }
        
        function getOriginalFileNameFromUnique(uniqueFileName) { 
            // ... (Full implementation as in previous response)
        }

        async function uploadFile(file, path) { 
            // ... (Full implementation as in previous response)
        }

        async function deleteFile(uniqueFileName, path) { 
            // ... (Full implementation as in previous response)
        }
        
        function listenForSiteLogos() { 
            const docRef = doc(db, PUBLIC_DATA_BASE_PATH, SITE_CONFIGURATION_DOC_ID); // VERIFIED CORRECT
            onSnapshot(docRef, (docSnap) => {
                if (docSnap.exists()) {
                    const data = docSnap.data();
                    currentHeaderLogo.url = data.headerLogoUrl || DEFAULT_HEADER_LOGO_URL;
                    currentHeaderLogo.fileName = data.headerLogoFileName || '';
                    currentFooterLogo.url = data.footerLogoUrl || DEFAULT_FOOTER_LOGO_URL;
                    currentFooterLogo.fileName = data.footerLogoFileName || '';
                    currentContributor1Logo.url = data.contributor1LogoUrl || DEFAULT_CONTRIB1_LOGO_URL;
                    currentContributor1Logo.fileName = data.contributor1LogoFileName || '';
                    currentContributor2Logo.url = data.contributor2LogoUrl || DEFAULT_CONTRIB2_LOGO_URL;
                    currentContributor2Logo.fileName = data.contributor2LogoFileName || '';
                } else {
                    console.warn(`Site configuration document '${SITE_CONFIGURATION_DOC_ID}' not found at ${PUBLIC_DATA_BASE_PATH}. Using defaults.`);
                    currentHeaderLogo = { url: DEFAULT_HEADER_LOGO_URL, fileName: '' }; 
                    currentFooterLogo = { url: DEFAULT_FOOTER_LOGO_URL, fileName: '' };
                    currentContributor1Logo = { url: DEFAULT_CONTRIB1_LOGO_URL, fileName: '' };
                    currentContributor2Logo = { url: DEFAULT_CONTRIB2_LOGO_URL, fileName: '' };
                }
                updateSiteLogosUI();
            }, (error) => {
                console.error("Error listening for site logos:", error);
                showMessageModal("errorMessage", "couldNotLoadLogos", "error");
                currentHeaderLogo = { url: DEFAULT_HEADER_LOGO_URL, fileName: '' }; currentFooterLogo = { url: DEFAULT_FOOTER_LOGO_URL, fileName: '' }; currentContributor1Logo = { url: DEFAULT_CONTRIB1_LOGO_URL, fileName: '' }; currentContributor2Logo = { url: DEFAULT_CONTRIB2_LOGO_URL, fileName: '' };
                updateSiteLogosUI();
            });
        }

        function updateSiteLogosUI() { 
            // ... (Full implementation as in previous response)
        }

        function loadSiteLogosForAdmin() { 
            // ... (Full implementation as in previous response)
        }

        function handleLogoFileInput(inputElement, previewImgElement, fileNameDisplayElement, currentLogoState, defaultUrl, noMsgKey) { 
            // ... (Full implementation as in previous response)
        }
        
        function listenForPublicPublications() { 
            // ... (Full implementation as in previous response, uses PUBLIC_DATA_BASE_PATH, PUBLIC_PUB_COLLECTION_NAME)
        }

        function listenForCurrentIssue() { 
            // ... (Full implementation as in previous response, uses PUBLIC_DATA_BASE_PATH, PUBLIC_PUB_COLLECTION_NAME)
        }

        function listenForNews() { 
            // ... (Full implementation as in previous response, uses PUBLIC_DATA_BASE_PATH, PUBLIC_NEWS_COLLECTION_NAME)
        }

        function displayPublications(publications) { 
            // ... (Full implementation as in previous response, uses PUBLIC_DATA_BASE_PATH, PUBLIC_PUB_COLLECTION_NAME for details)
        }
        
        function listenForAdminPublications() { 
            // ... (Full implementation as in previous response, uses PUBLIC_DATA_BASE_PATH, PUBLIC_PUB_COLLECTION_NAME)
        }
        
        function resetAddPublicationForm() { 
            // ... (Full implementation as in previous response)
        }

        async function editPublication(pubId) { 
            // ... (Full implementation as in previous response, uses PUBLIC_DATA_BASE_PATH, PUBLIC_PUB_COLLECTION_NAME)
        }

        function confirmDeletePublication(pubId) { 
            // ... (Full implementation as in previous response, uses PUBLIC_DATA_BASE_PATH, PUBLIC_PUB_COLLECTION_NAME)
        }
        
        function resetAddNewsItemForm() { 
            // ... (Full implementation as in previous response)
        }

        async function editNewsItem(newsId){ 
            // ... (Full implementation as in previous response, uses PUBLIC_DATA_BASE_PATH, PUBLIC_NEWS_COLLECTION_NAME)
        }

        function confirmDeleteNewsItem(newsId){ 
            // ... (Full implementation as in previous response, uses PUBLIC_DATA_BASE_PATH, PUBLIC_NEWS_COLLECTION_NAME)
        }

        function listenForAdminNews() { 
            // ... (Full implementation as in previous response, uses PUBLIC_DATA_BASE_PATH, PUBLIC_NEWS_COLLECTION_NAME)
        }
        
        function showMessageModal(titleKey, messageKey, type = "alert", callback = null) { 
            // ... (Full implementation as in previous response)
        }

        function showPublicationDetailsModal(book) { 
            // ... (Full implementation as in previous response)
        }

        function showLoadingSpinner() { if(loadingSpinner) loadingSpinner.classList.remove('hidden'); }
        function hideLoadingSpinner() { if(loadingSpinner) loadingSpinner.classList.add('hidden'); }

        // --- window.onload: Populate views and attach event listeners ---
        window.onload = function() {
            // Populate views object AFTER DOM is ready
            views.aboutUs = document.getElementById('aboutUsView');
            views.editorialBoard = document.getElementById('editorialBoardView');
            views.currentIssue = document.getElementById('currentIssueView');
            views.archivalVolumes = document.getElementById('archivalVolumesView');
            views.editorialAndEthics = document.getElementById('editorialAndEthicsView');
            views.newsEvents = document.getElementById('newsEventsView');
            views.adminLogin = document.getElementById('adminLoginView');
            views.adminDashboard = document.getElementById('adminDashboardView');
            
            // Attach ALL event listeners now that the DOM is ready
            document.querySelectorAll('.view-button').forEach(button => {button.addEventListener('click', (e) => showView(e.target.dataset.view));});
            document.querySelectorAll('.lang-button').forEach(button => {button.addEventListener('click', (e) => applyTranslations(e.target.dataset.lang));});
            document.getElementById('adminLoginBtnFooter').addEventListener('click', () => showView('adminLogin'));
            document.getElementById('adminLogoutBtn').addEventListener('click', async () => { try { await signOut(auth); showMessageModal("successMessage", "logoutSuccessful", "success"); } catch (error) { console.error("Error logging out:", error); showMessageModal("errorMessage", "logoutFailed" + error.message, "error"); }});
            document.getElementById('managePublicationsBtn').addEventListener('click', () => { document.getElementById('adminManagePublications').classList.remove('hidden'); document.getElementById('adminManageNews').classList.add('hidden'); document.getElementById('adminManageSiteSettings').classList.add('hidden'); resetAddPublicationForm(); if(auth && auth.currentUser) listenForAdminPublications(); });
            document.getElementById('manageNewsBtn').addEventListener('click', () => { document.getElementById('adminManagePublications').classList.add('hidden'); document.getElementById('adminManageNews').classList.remove('hidden'); document.getElementById('adminManageSiteSettings').classList.add('hidden'); resetAddNewsItemForm(); if(auth && auth.currentUser) listenForAdminNews(); });
            document.getElementById('manageSiteSettingsBtn').addEventListener('click', () => { document.getElementById('adminManagePublications').classList.add('hidden'); document.getElementById('adminManageNews').classList.add('hidden'); document.getElementById('adminManageSiteSettings').classList.remove('hidden'); loadSiteLogosForAdmin(); });
            document.getElementById('adminLoginForm').addEventListener('submit', async (e) => { e.preventDefault(); showLoadingSpinner(); const email = document.getElementById('adminEmail').value; const password = document.getElementById('adminPassword').value; const loginErrorMessage = document.getElementById('loginErrorMessage'); loginErrorMessage.textContent = ''; try { await signInWithEmailAndPassword(auth, email, password); document.getElementById('adminEmail').value = ''; document.getElementById('adminPassword').value = ''; } catch (error) { console.error("Admin login error:", error); loginErrorMessage.textContent = (translations[currentLanguage] && translations[currentLanguage].invalidCredentials) || "Invalid credentials."; } finally { hideLoadingSpinner(); }});
            
            // Publication Form
            document.getElementById('addPublicationForm').addEventListener('submit', async (e) => {
                e.preventDefault(); showLoadingSpinner();
                if (!auth.currentUser) { showMessageModal("permissionDenied", "noPermissionAddEditPublications", "error"); hideLoadingSpinner(); return; }
                const title = adminPubFormElements.bookTitleInput.value.trim(), authors = adminPubFormElements.bookAuthorsInput.value.trim(), year = adminPubFormElements.bookYearInput.value ? parseInt(adminPubFormElements.bookYearInput.value,10) : null, description = adminPubFormElements.bookDescriptionInput.value.trim(), isbn = adminPubFormElements.bookISBNInput.value.trim(), issn = adminPubFormElements.bookISSNInput.value.trim(), abstractArText = adminPubFormElements.abstractArTextInput.value.trim(), abstractEnText = adminPubFormElements.abstractEnTextInput.value.trim(), abstractItText = adminPubFormElements.abstractItTextInput.value.trim(), isCurrentIssue = adminPubFormElements.bookIsCurrentIssueCheckbox.checked;
                try {
                    const uploadAndUpdate = async (input, currentFile, path) => { let newUrl = currentFile.url, newName = currentFile.fileName; if (input.files[0]) { if (currentFile.fileName) await deleteFile(currentFile.fileName, path); const res = await uploadFile(input.files[0], path); newUrl = res.url; newName = res.fileName;} return { url: newUrl, fileName: newName }; };
                    const coverRes = await uploadAndUpdate(adminPubFormElements.bookCoverInput, {url: currentPubFiles.coverUrl, fileName: currentPubFiles.coverFileName}, STORAGE_PATH_COVERS);
                    const pdfRes = await uploadAndUpdate(adminPubFormElements.bookPdfInput, {url: currentPubFiles.pdfUrl, fileName: currentPubFiles.pdfFileName}, STORAGE_PATH_PDFS);
                    const absArRes = await uploadAndUpdate(adminPubFormElements.abstractArPdfInput, {url: currentPubFiles.abstracts.ar.url, fileName: currentPubFiles.abstracts.ar.fileName}, STORAGE_PATH_ABSTRACTS);
                    const absEnRes = await uploadAndUpdate(adminPubFormElements.abstractEnPdfInput, {url: currentPubFiles.abstracts.en.url, fileName: currentPubFiles.abstracts.en.fileName}, STORAGE_PATH_ABSTRACTS);
                    const absItRes = await uploadAndUpdate(adminPubFormElements.abstractItPdfInput, {url: currentPubFiles.abstracts.it.url, fileName: currentPubFiles.abstracts.it.fileName}, STORAGE_PATH_ABSTRACTS);
                    const pubData = { title, authors, year, description, isbn, issn, abstracts: {ar:{text:abstractArText,url:absArRes.url,fileName:absArRes.fileName},en:{text:abstractEnText,url:absEnRes.url,fileName:absEnRes.fileName},it:{text:abstractItText,url:absItRes.url,fileName:absItRes.fileName}}, coverImageUrl:coverRes.url,coverImageFileName:coverRes.fileName,pdfUrl:pdfRes.url,pdfFileName:pdfRes.fileName, isCurrentIssue, timestamp:new Date().toISOString()};
                    if (isCurrentIssue) { const q = query(collection(db,PUBLIC_DATA_BASE_PATH,PUBLIC_PUB_COLLECTION_NAME),where("isCurrentIssue","==",true)); const snap = await getDocs(q); for(const d of snap.docs) if(d.id!==editingPublicationId) await updateDoc(doc(db,PUBLIC_DATA_BASE_PATH,PUBLIC_PUB_COLLECTION_NAME,d.id),{isCurrentIssue:false});}
                    if (editingPublicationId) { await updateDoc(doc(db,PUBLIC_DATA_BASE_PATH,PUBLIC_PUB_COLLECTION_NAME,editingPublicationId),pubData); showMessageModal("successMessage","publicationUpdated","success");}
                    else { await addDoc(collection(db,PUBLIC_DATA_BASE_PATH,PUBLIC_PUB_COLLECTION_NAME),pubData); showMessageModal("successMessage","publicationAdded","success");}
                    resetAddPublicationForm();
                } catch (error) { console.error("Error saving pub:", error); showMessageModal("errorMessage","errorSavingPublication"+error.message,"error");
                } finally { hideLoadingSpinner(); }
            });
            adminPubFormElements.cancelEditPublicationBtn.addEventListener('click', resetAddPublicationForm);

            // News Form
            document.getElementById('addNewsItemForm').addEventListener('submit', async (e) => { e.preventDefault(); showLoadingSpinner(); if(!auth.currentUser){showMessageModal("permissionDenied","noPermissionAddNews","error");hideLoadingSpinner();return;} const title=adminNewsFormElements.newsTitleInput.value.trim(), description=adminNewsFormElements.newsDescriptionInput.value.trim(); let imageUrl=currentNewsImage.url, imageFileName=currentNewsImage.fileName; try { if(adminNewsFormElements.newsImageInput.files[0]){ if(currentNewsImage.fileName) await deleteFile(currentNewsImage.fileName,STORAGE_PATH_NEWS_IMAGES); const res=await uploadFile(adminNewsFormElements.newsImageInput.files[0],STORAGE_PATH_NEWS_IMAGES); imageUrl=res.url; imageFileName=res.fileName; } else if (!adminNewsFormElements.newsImageInput.files[0] && editingNewsItemId && !currentNewsImage.url) { if (currentNewsImage.fileName) await deleteFile(currentNewsImage.fileName, STORAGE_PATH_NEWS_IMAGES); imageUrl = ''; imageFileName = ''; } const newsData={title,description,imageUrl,imageFileName,timestamp:new Date().toISOString()}; if(editingNewsItemId){await updateDoc(doc(db,PUBLIC_DATA_BASE_PATH,PUBLIC_NEWS_COLLECTION_NAME,editingNewsItemId),newsData); showMessageModal("successMessage","newsItemUpdated","success");} else{await addDoc(collection(db,PUBLIC_DATA_BASE_PATH,PUBLIC_NEWS_COLLECTION_NAME),newsData); showMessageModal("successMessage","newsItemAdded","success");} resetAddNewsItemForm(); }catch(err){console.error("Save news err:",err);showMessageModal("errorMessage","errorSavingNewsItem"+err.message,"error");} finally{hideLoadingSpinner();}});
            adminNewsFormElements.newsImageInput.addEventListener('change', (e) => { const file=e.target.files[0]; if(file){ adminNewsFormElements.newsImageFileNameDisplayAdmin.textContent=`${translations[currentLanguage].selectedLabel}: ${file.name}`; const r=new FileReader();r.onload=(ev)=>{adminNewsFormElements.uploadedNewsImagePreviewAdmin.src=ev.target.result;adminNewsFormElements.uploadedNewsImagePreviewAdmin.style.display='block';};r.readAsDataURL(file);} else{ adminNewsFormElements.newsImageFileNameDisplayAdmin.textContent=currentNewsImage.fileName?`${translations[currentLanguage].currentLabel}: ${getOriginalFileNameFromUnique(currentNewsImage.fileName)}`:''; adminNewsFormElements.uploadedNewsImagePreviewAdmin.src=currentNewsImage.url; adminNewsFormElements.uploadedNewsImagePreviewAdmin.style.display=currentNewsImage.url?'block':'none';}});
            adminNewsFormElements.cancelEditNewsBtn.addEventListener('click', resetAddNewsItemForm);
            
            // Logo Forms
            document.getElementById('logoUploadForm').addEventListener('submit', async (e) => { e.preventDefault(); showLoadingSpinner(); if (!auth.currentUser) { showMessageModal("permissionDenied", "noPermissionUpdateSiteSettings", "error"); hideLoadingSpinner(); return; } const headerFile = document.getElementById('headerLogoUpload').files[0]; const footerFile = document.getElementById('footerLogoUpload').files[0]; let newHeaderLogo = { ...currentHeaderLogo }; let newFooterLogo = { ...currentFooterLogo }; try { if (headerFile) { if (currentHeaderLogo.fileName && currentHeaderLogo.url !== DEFAULT_HEADER_LOGO_URL) await deleteFile(currentHeaderLogo.fileName, STORAGE_PATH_LOGOS); newHeaderLogo = await uploadFile(headerFile, STORAGE_PATH_LOGOS); } if (footerFile) { if (currentFooterLogo.fileName && currentFooterLogo.url !== DEFAULT_FOOTER_LOGO_URL) await deleteFile(currentFooterLogo.fileName, STORAGE_PATH_LOGOS); newFooterLogo = await uploadFile(footerFile, STORAGE_PATH_LOGOS); } await setDoc(doc(db, PUBLIC_DATA_BASE_PATH, SITE_CONFIGURATION_DOC_ID), { headerLogoUrl: newHeaderLogo.url, headerLogoFileName: newHeaderLogo.fileName, footerLogoUrl: newFooterLogo.url, footerLogoFileName: newFooterLogo.fileName }, { merge: true }); showMessageModal("successMessage", "siteLogosUpdated", "success"); currentHeaderLogo = newHeaderLogo; currentFooterLogo = newFooterLogo; updateSiteLogosUI(); document.getElementById('headerLogoUpload').value = ''; document.getElementById('footerLogoUpload').value = ''; } catch (error) { console.error("Error updating site logos:", error); showMessageModal("errorMessage", "errorUpdatingLogos" + error.message, "error"); } finally { hideLoadingSpinner(); }});
            document.getElementById('contributorLogoUploadForm').addEventListener('submit', async (e) => { e.preventDefault(); showLoadingSpinner(); if (!auth.currentUser) { showMessageModal("permissionDenied", "noPermissionUpdateSiteSettings", "error"); hideLoadingSpinner(); return; } const c1File = document.getElementById('contributor1LogoUpload').files[0]; const c2File = document.getElementById('contributor2LogoUpload').files[0]; let newC1Logo = { ...currentContributor1Logo }; let newC2Logo = { ...currentContributor2Logo }; try { if (c1File) { if (currentContributor1Logo.fileName && currentContributor1Logo.url !== DEFAULT_CONTRIB1_LOGO_URL) await deleteFile(currentContributor1Logo.fileName, STORAGE_PATH_LOGOS); newC1Logo = await uploadFile(c1File, STORAGE_PATH_LOGOS); } if (c2File) { if (currentContributor2Logo.fileName && currentContributor2Logo.url !== DEFAULT_CONTRIB2_LOGO_URL) await deleteFile(currentContributor2Logo.fileName, STORAGE_PATH_LOGOS); newC2Logo = await uploadFile(c2File, STORAGE_PATH_LOGOS); } await setDoc(doc(db, PUBLIC_DATA_BASE_PATH, SITE_CONFIGURATION_DOC_ID), { contributor1LogoUrl: newC1Logo.url, contributor1LogoFileName: newC1Logo.fileName, contributor2LogoUrl: newC2Logo.url, contributor2LogoFileName: newC2Logo.fileName }, { merge: true }); showMessageModal("successMessage", "contributorLogosUpdated", "success"); currentContributor1Logo = newC1Logo; currentContributor2Logo = newC2Logo; updateSiteLogosUI(); document.getElementById('contributor1LogoUpload').value = ''; document.getElementById('contributor2LogoUpload').value = ''; } catch (error) { console.error("Error updating contributor logos:", error); showMessageModal("errorMessage", "errorUpdatingContributorLogos" + error.message, "error"); } finally { hideLoadingSpinner(); }});
            
            // Search/Sort Listeners
            document.getElementById('publicationSearch').addEventListener('input', () => { if(typeof listenForPublicPublications === "function") listenForPublicPublications(); });
            document.getElementById('sortPublications').addEventListener('change', () => { if(typeof listenForPublicPublications === "function") listenForPublicPublications(); });

            // Modal Close Buttons
            closeMessageModalElement.addEventListener('click', () => { messageModalElement.classList.remove('flex'); messageModalElement.classList.add('hidden'); });
            messageModalElement.addEventListener('click', (e) => { if (e.target === messageModalElement) { messageModalElement.classList.remove('flex'); messageModalElement.classList.add('hidden'); }});
            closePublicationDetailsModal.addEventListener('click', () => {publicationDetailsModal.classList.remove('flex'); publicationDetailsModal.classList.add('hidden');});
            publicationDetailsModal.addEventListener('click', (e) => { if (e.target === publicationDetailsModal) {publicationDetailsModal.classList.remove('flex'); publicationDetailsModal.classList.add('hidden');}});

            // Logo File Input Change Listeners (must be after handleLogoFileInput is defined, which it is now)
            document.getElementById('headerLogoUpload').addEventListener('change', (e) => handleLogoFileInput(e.target, document.getElementById('headerLogoPreview'), document.getElementById('headerLogoFileNameDisplayAdmin'), currentHeaderLogo, DEFAULT_HEADER_LOGO_URL, 'noCustomHeaderLogo'));
            document.getElementById('footerLogoUpload').addEventListener('change', (e) => handleLogoFileInput(e.target, document.getElementById('footerLogoPreview'), document.getElementById('footerLogoFileNameDisplayAdmin'), currentFooterLogo, DEFAULT_FOOTER_LOGO_URL, 'noCustomFooterLogo'));
            document.getElementById('contributor1LogoUpload').addEventListener('change', (e) => handleLogoFileInput(e.target, document.getElementById('contributor1LogoPreview'), document.getElementById('contributor1FileNameDisplayAdmin'), currentContributor1Logo, DEFAULT_CONTRIB1_LOGO_URL, 'noLERMALogo'));
            document.getElementById('contributor2LogoUpload').addEventListener('change', (e) => handleLogoFileInput(e.target, document.getElementById('contributor2LogoPreview'), document.getElementById('contributor2FileNameDisplayAdmin'), currentContributor2Logo, DEFAULT_CONTRIB2_LOGO_URL, 'noMEDALogo'));

            if (typeof translations === 'undefined' || !translations.en || !translations.it) { console.error("CRITICAL: Full translations object not available."); }
            applyTranslations(currentLanguage); // Apply translations after all elements are certainly available
            initializeFirebase(); // Initialize Firebase, which sets up auth listener and then other listeners
            document.getElementById('currentYear').textContent = new Date().getFullYear();
            showView('aboutUs'); // Show default view after everything is set up
        };
    </script>
</body>
</html>
