<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title data-lang-key="pageTitle">Quaderni di Archeologia della Libya - Publications</title>
    <!-- Tailwind CSS CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Google Fonts: EB Garamond for global text and headings -->
    <link href="https://fonts.googleapis.com/css2?family=EB+Garamond:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        /* Global Font and Base Colors - Refined Cooler Greys */
        body {
            font-family: 'EB Garamond', serif; /* Apply Garamond globally */
            background-color: #e8e9eb; /* Very light cool grey */
            color: #3f4245; /* Dark charcoal-blue for body text */
            line-height: 1.6;
        }

        /* Headings Font - Consistent Garamond */
        h1, h2, h3, h4, h5, h6 {
            font-family: 'EB Garamond', serif;
            color: #2c2f33; /* Even darker blue-grey for headings */
            font-weight: 700;
        }

        /* Container for main content */
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 2rem;
        }

        /* Header Specific Styles */
        .header-bg {
            background-color: #d8dbdf; /* Lighter cool grey for header */
            box-shadow: 0 2px 8px rgba(0,0,0,0.1); /* Subtle shadow */
            border-bottom: 1px solid #c0c4c9; /* A finer line */
        }
        .header-logo {
            max-height: 90px;
            width: auto;
            filter: none; /* No filter needed for lighter background */
        }
        .nav-button {
            background-color: #5f6b7a; /* Muted blue-grey for buttons */
            color: #ffffff; /* White text */
            font-family: 'EB Garamond', serif;
            padding: 0.75rem 1.25rem;
            border-radius: 6px;
            transition: all 0.2s ease-in-out;
            text-decoration: none;
            display: inline-block;
            font-weight: 600;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            white-space: nowrap;
            border: 1px solid #505c68; /* Distinct border */
        }
        .nav-button:hover {
            background-color: #72808f; /* Slightly lighter on hover */
            transform: translateY(-1px);
            box-shadow: 0 4px 8px rgba(0,0,0,0.15);
        }

        /* Translation Buttons */
        .lang-button {
            background-color: #8c98a7; /* Even lighter blue-grey for lang buttons */
            color: #ffffff;
            font-family: 'EB Garamond', serif;
            padding: 0.5rem 0.8rem;
            border-radius: 4px;
            transition: all 0.2s ease-in-out;
            font-weight: 600;
            border: 1px solid #7a8694;
        }
        .lang-button:hover {
            background-color: #a0aab8;
            transform: translateY(-1px);
        }
        .lang-button.active {
            background-color: #3b76a7; /* Active blue */
            border-color: #2e5a80;
            box-shadow: inset 0 1px 3px rgba(0,0,0,0.2);
        }

        /* Search Bar Styling */
        .header-search-container {
            background-color: #e0e2e5; /* Lighter cool grey for search area */
            padding: 1rem 1.5rem;
            border-radius: 8px;
            box-shadow: inset 0 1px 4px rgba(0,0,0,0.03);
            border: 1px solid #c0c4c9;
        }
        .search-input, .search-select {
            border: 1px solid #a0a8b3; /* Medium cool grey border */
            border-radius: 4px;
            padding: 0.6rem 1rem;
            font-family: 'EB Garamond', serif;
            color: #3f4245; /* Dark text */
            background-color: #f0f2f5; /* Off-white for inputs */
            box-shadow: inset 0 1px 2px rgba(0,0,0,0.05);
        }
        .search-input::placeholder, .search-select option {
            color: #7f8a94; /* Placeholder text color */
        }
        .search-input:focus, .search-select:focus {
            border-color: #5f6b7a; /* Muted blue-grey on focus */
            outline: none;
            box-shadow: 0 0 0 2px rgba(95, 107, 122, 0.2); /* Light blue-grey focus ring */
        }
        .search-select {
            -webkit-appearance: none;
            -moz-appearance: none;
            appearance: none;
            background-image: url('data:image/svg+xml;charset=US-ASCII,%3Csvg%20xmlns%3D%22http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg%22%20width%3D%22292%22%20height%3D%22292%22%20viewBox%3D%220%200%20292%20292%22%3E%3Cpath%20fill%3D%22%237f8a94%22%20d%3D%22M287%2069.4L146.7%20209.6%206.4%2069.4c-4.2-4.1-11-4.1-15.2%200-4.2%204.1-4.2%2010.8%200%2014.9l145%20146.5c4%204%2010.4%204%2014.4%200l145-146.5c4.2-4.1%204.2-10.8%200-14.9-4.2-4.1-11-4.1-15.2%200z%22%2F%3E%3C%2Fsvg%3E');
            background-repeat: no-repeat;
            background-position: right 0.75rem center;
            background-size: 0.8em;
            padding-right: 2.5rem;
        }

        /* General Section Styling */
        .section-content {
            background-color: #f0f2f5; /* Off-white, slightly darker light grey for main content sections */
            border-radius: 12px;
            padding: 2.5rem;
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
            margin-bottom: 2.5rem;
            animation: fadeIn 0.8s ease-out;
            border: 1px solid #d0d5dc; /* Subtle cool grey border */
        }

        /* Publication Cards */
        .publication-card {
            background-color: #f8f9fa; /* Even lighter for cards */
            border: 1px solid #e0e5ea; /* Very light cool grey border */
            border-radius: 8px;
            overflow: hidden;
            box-shadow: 0 2px 8px rgba(0,0,0,0.08);
            transition: transform 0.2s ease, box-shadow 0.2s ease;
            cursor: pointer;
        }
        .publication-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 6px 15px rgba(0,0,0,0.15);
        }
        .cover-image {
            width: 100%;
            height: 250px;
            object-fit: cover;
            border-bottom: 1px solid #e0e5ea;
        }

        /* Modal Styles */
        .modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            overflow: auto;
            background-color: rgba(0,0,0,0.6); /* Standard overlay */
            justify-content: center;
            align-items: center;
            padding: 1rem;
        }
        .modal.flex {
            display: flex;
        }
        .modal-content {
            background-color: #e8e9eb; /* Modal content matches body background for harmony */
            margin: auto;
            padding: 2.5rem;
            border-radius: 10px;
            box-shadow: 0 8px 20px rgba(0,0,0,0.4);
            width: 90%;
            max-width: 700px;
            text-align: center;
            position: relative;
            border: 1px solid #a0a8b3;
        }
        .modal-close-button {
            position: absolute;
            top: 15px;
            right: 25px;
            color: #7f8a94;
            font-size: 32px;
            font-weight: bold;
            cursor: pointer;
            transition: color 0.2s;
        }
        .modal-close-button:hover {
            color: #2c2f33;
        }
        .modal-buttons button {
            background-color: #5f6b7a;
            color: white;
            padding: 0.8rem 1.5rem;
            border-radius: 6px;
            transition: background-color 0.2s ease;
            font-family: 'EB Garamond', serif;
            font-weight: 600;
        }
        .modal-buttons button:hover {
            background-color: #72808f;
        }

        /* Admin Specific Styles */
        .admin-bg {
            background-color: #c0c4c9; /* Slightly darker cool grey for admin area */
            color: #2c2f33; /* Dark text for admin */
        }
        .admin-section {
            background-color: #d8dbdf; /* Lighter cool grey for admin sections */
            padding: 2rem;
            border-radius: 8px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
            margin-bottom: 2rem;
            color: #3f4245; /* Dark text inside admin sections */
        }
        .admin-section h3 {
            color: #2c2f33; /* Ensure headings are dark */
        }
        .admin-input {
            border: 1px solid #a0a8b3;
            border-radius: 4px;
            padding: 0.5rem 1rem;
            font-family: 'EB Garamond', serif;
            color: #3f4245;
            background-color: #f0f2f5;
        }
        .admin-input::placeholder {
            color: #7f8a94;
        }
        .admin-input:focus {
            border-color: #5f6b7a;
            box-shadow: 0 0 0 2px rgba(95, 107, 122, 0.2);
        }
        .admin-button {
            background-color: #5f6b7a;
            color: #ffffff;
            padding: 0.75rem 1.5rem;
            border-radius: 6px;
            transition: background-color 0.2s ease;
            font-family: 'EB Garamond', serif;
            font-weight: 600;
        }
        .admin-button:hover {
            background-color: #72808f;
        }
        .admin-button.bg-red-600 { background-color: #dc2626; border-color: #b91c1c;} /* Tailwind red */
        .admin-button.bg-red-600:hover { background-color: #b91c1c; }
        .admin-button.bg-green-600 { background-color: #16a34a; border-color: #15803d; } /* Tailwind green */
        .admin-button.bg-green-600:hover { background-color: #15803d; }
        .admin-button.bg-blue-600 { background-color: #2563eb; border-color: #1d4ed8; } /* Tailwind blue */
        .admin-button.bg-blue-600:hover { background-color: #1d4ed8; }

        /* Footer Styles */
        .footer-bg {
            background-color: #a0a8b3; /* Medium cool grey for footer */
            color: #2c2f33; /* Dark text */
            padding: 2rem;
            box-shadow: 0 -2px 8px rgba(0,0,0,0.1);
            border-top: 1px solid #b0b8c3;
        }
        .footer-logo {
            max-height: 60px;
            width: auto;
            filter: none; /* No filter needed for lighter background */
        }
        .footer-link {
            color: #3b76a7; /* Professional blue for links */
        }
        .footer-link:hover {
            color: #2e5a80; /* Darker blue on hover */
            text-decoration: underline;
        }

        /* Specific style for abstract/pdf download buttons in modal */
        .modal-download-group {
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
            gap: 0.75rem;
            margin-top: 1.5rem;
        }
        .modal-download-group a, .modal-download-group button {
            background-color: #3b76a7; /* A professional blue for downloads */
            color: white;
            padding: 0.6rem 1.2rem;
            border-radius: 5px;
            font-size: 0.9rem;
            transition: background-color 0.2s ease;
            font-family: 'EB Garamond', serif;
            font-weight: 600;
            text-decoration: none;
            box-shadow: 0 1px 3px rgba(0,0,0,0.2);
            border: 1px solid #2e5a80;
        }
        .modal-download-group a:hover, .modal-download-group button:hover {
            background-color: #2e5a80;
        }
        .modal-download-group button.disabled {
            background-color: #c0c4c9; /* Light grey for disabled */
            color: #5f6b7a;
            cursor: not-allowed;
            box-shadow: none;
            opacity: 0.7;
            border-color: #b0b8c3;
        }

        /* Animations */
        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        /* Section separator for content within a view */
        .section-separator {
            border-top: 1px solid #c0c4c9;
            margin: 3rem 0;
        }

        /* Table styling for admin */
        .admin-table-header {
            background-color: #c0c4c9;
        }
        .admin-table-row {
            background-color: #e0e2e5;
            color: #3f4245;
        }
        .admin-table-row:nth-child(even) {
            background-color: #f0f2f5; /* Slightly different for alternating rows */
        }
        .admin-table-row td {
            border-bottom: 1px solid #d0d5dc;
            padding: 0.75rem 1.5rem;
        }
        .admin-table-row:hover {
            background-color: #d0d5dc;
        }
        .file-upload-preview {
            display: flex;
            align-items: center;
            gap: 1rem;
            margin-top: 0.5rem;
        }
        .file-upload-preview img {
            max-width: 80px;
            height: auto;
            border-radius: 4px;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
        }
        .file-upload-preview p {
            font-size: 0.875rem;
            color: #7f8a94;
        }
    </style>
</head>
<body class="min-h-screen flex flex-col">
    <!-- Loading Spinner -->
    <div id="loadingSpinner" class="fixed inset-0 bg-gray-800 bg-opacity-75 flex items-center justify-center z-[2000] hidden">
        <div class="animate-spin rounded-full h-32 w-32 border-t-2 border-b-2 border-white"></div>
    </div>

    <!-- Modals -->
    <div id="messageModal" class="modal">
        <div class="modal-content">
            <span class="modal-close-button" id="closeMessageModal">&times;</span>
            <p id="messageText" class="text-lg text-gray-800 mb-4"></p>
            <div id="modalButtons" class="modal-buttons"></div>
        </div>
    </div>

    <div id="confirmModal" class="modal">
        <div class="modal-content">
            <span class="modal-close-button" id="closeConfirmModal">&times;</span>
            <p id="confirmMessage" class="text-lg text-gray-800 mb-6"></p>
            <div class="modal-buttons flex justify-center gap-4">
                <button id="confirmYesBtn" class="bg-red-600 hover:bg-red-700 text-white">Yes</button>
                <button id="confirmNoBtn" class="bg-gray-500 hover:bg-gray-600 text-white">No</button>
            </div>
        </div>
    </div>

    <!-- Publication Details Modal -->
    <div id="publicationDetailsModal" class="modal">
        <div class="modal-content">
            <span class="modal-close-button" id="closePublicationDetailsModal">&times;</span>
            <img id="detailCoverImage" src="https://placehold.co/400x600/cccccc/333333?text=No+Image" alt="Publication Cover" class="w-full max-w-[200px] h-auto object-cover mx-auto mb-4 rounded-md shadow-md">
            <h3 id="detailTitle" class="text-2xl font-bold text-gray-800 mb-2"></h3>
            <p id="detailAuthors" class="text-gray-600 text-lg mb-1"></p>
            <p id="detailYear" class="text-gray-500 text-md font-medium mb-3"></p>
            <p id="detailDescription" class="text-gray-700 text-base leading-relaxed text-left mb-6"></p>
            
            <div class="grid grid-cols-1 md:grid-cols-2 gap-4 text-left text-gray-700 mb-6">
                <div><strong data-lang-key="isbnLabel">ISBN:</strong> <span id="detailISBN">N/A</span></div>
                <div><strong data-lang-key="issnLabel">ISSN:</strong> <span id="detailISSN">N/A</span></div>
            </div>

            <div class="modal-download-group">
                <a id="detailDownloadPdfBtn" href="#" target="_blank" class="admin-button" data-lang-key="downloadFullPdfBtn">Download Full PDF</a>
                <button id="detailDownloadAbstractArBtn" class="admin-button" data-lang-key="downloadArabicAbstractPdfBtn">Download Arabic Abstract (PDF)</button>
                <button id="detailDownloadAbstractEnBtn" class="admin-button" data-lang-key="downloadEnglishAbstractPdfBtn">Download English Abstract (PDF)</button>
                <button id="detailDownloadAbstractItBtn" class="admin-button" data-lang-key="downloadItalianAbstractPdfBtn">Download Italian Abstract (PDF)</button>
            </div>
            <div class="text-gray-700 text-base leading-relaxed text-left mt-6 space-y-3">
                <p><strong class="font-semibold" data-lang-key="arabicAbstractTextLabel">Arabic Abstract (Text):</strong> <span id="detailAbstractArText"></span></p>
                <p><strong class="font-semibold" data-lang-key="englishAbstractTextLabel">English Abstract (Text):</strong> <span id="detailAbstractEnText"></span></p>
                <p><strong class="font-semibold" data-lang-key="italianAbstractTextLabel">Italian Abstract (Text):</strong> <span id="detailAbstractItText"></span></p>
            </div>
        </div>
    </div>

    <!-- Header Section -->
    <header class="header-bg py-4 px-6 shadow-sm">
        <div class="container flex flex-col items-center gap-4">
            <!-- Top Row: Logo, Search Bar, and Language Buttons -->
            <div class="flex flex-col md:flex-row items-center justify-between w-full gap-4 mb-4">
                <!-- Logo -->
                <div class="flex-shrink-0">
                    <img id="mainLogo" src="https://placehold.co/200x90/e0e2e5/3f4245?text=Header+Logo" alt="Quaderni di Archeologia della Libya Logo" class="header-logo">
                </div>
                <!-- Search bar and sort options -->
                <div class="header-search-container flex flex-col sm:flex-row items-center gap-4 flex-grow md:max-w-xl lg:max-w-2xl">
                    <input type="text" id="publicationSearch" data-lang-key="searchPlaceholder" placeholder="Search by title, author, year, abstract..." class="search-input flex-grow w-full sm:w-auto">
                    <select id="sortPublications" class="search-select w-full sm:w-auto">
                        <option value="year-desc" data-lang-key="sortYearNewest">Year (Newest First)</option>
                        <option value="year-asc" data-lang-key="sortYearOldest">Year (Oldest First)</option>
                        <option value="title-asc" data-lang-key="sortTitleAZ">Title (A-Z)</option>
                        <option value="title-desc" data-lang-key="sortTitleZA">Title (Z-A)</option>
                        <option value="author-asc" data-lang-key="sortAuthorAZ">Author (A-Z)</option>
                        <option value="author-desc" data-lang-key="sortAuthorZA">Author (Z-A)</option>
                    </select>
                </div>
                <!-- Language Buttons -->
                <div class="flex space-x-2">
                    <button class="lang-button" data-lang="en">ENG</button>
                    <button class="lang-button" data-lang="it">ITA</button>
                </div>
            </div>
           
            <!-- Bottom Row: Navigation buttons -->
            <nav class="flex flex-wrap justify-center items-center space-x-2 md:space-x-4 w-full">
                <button class="nav-button view-button" data-view="aboutUs" data-lang-key="navAboutUs">About Us</button>
                <button class="nav-button view-button" data-view="editorialBoard" data-lang-key="navEditorialBoard">Editorial Board</button>
                <button class="nav-button view-button" data-view="currentIssue" data-lang-key="navCurrentIssue">Current Issue</button>
                <button class="nav-button view-button" data-view="archivalVolumes" data-lang-key="navArchivalVolumes">Archival Volumes</button>
                <button class="nav-button view-button" data-view="editorialAndEthics" data-lang-key="navEditorialEthics">Editorial Guidelines & Code of Ethics</button>
                <button class="nav-button view-button" data-view="newsEvents" data-lang-key="navNewsEvents">News & Current Events</button>
            </nav>
        </div>
    </header>

    <!-- Main Content Area -->
    <main class="flex-grow container mt-8">
        <!-- About Us View (Home Page) -->
        <section id="aboutUsView" class="view section-content">
            <h2 class="text-3xl text-center mb-6" data-lang-key="aboutUsHeading">About Quaderni di Archeologia della Libya</h2>
            <div class="prose max-w-none text-gray-700 leading-relaxed space-y-4">
                <p data-lang-key="aboutUsPara1">Welcome to the official website for <strong>Quaderni di Archeologia della Libya</strong>, a prestigious academic journal dedicated to archaeological research in Libya. Initiated in 1950, this esteemed series documents the significant contributions of Italian archaeological missions in the region, fostering a deeper understanding of its rich ancient history.</p>
                <p data-lang-key="aboutUsPara2">After a brief hiatus, the journal proudly resumed publication in 2018 with a new series, re-establishing itself as a leading scientific platform. We provide an essential venue for scholars interested in the archaeology and history of Libya and the broader Maghreb, ensuring high-quality, peer-reviewed content.</p>
                <p data-lang-key="aboutUsPara3">Our volumes embrace a multidisciplinary approach, featuring articles on epigraphy, ancient and colonial history, the history of archaeology, and territorial studies. Contributions are published in major European languages, complemented by comprehensive English and Arabic abstracts, to promote international academic exchange and collaboration.</p>
                <p data-lang-key="aboutUsPara4">This website serves as a dedicated resource for the series, maintained by L'Erma di Bretschneider, a renowned academic publishing house in Rome. We are committed to upholding the highest standards of scholarly excellence and ensuring the continued global dissemination of groundbreaking research presented in the "Quaderni di Archeologia della Libya."</p>
            </div>
            <div class="section-separator"></div>
            <h2 class="text-3xl text-center mb-6" data-lang-key="currentPublicationsHeading">Current Publications</h2>
            <div id="publicationsList" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8">
                <p class="col-span-full text-center text-gray-400" data-lang-key="loadingPublications">Loading publications...</p>
            </div>
        </section>

        <!-- Editorial Board View -->
        <section id="editorialBoardView" class="view hidden section-content">
            <h2 class="text-3xl text-center mb-6" data-lang-key="editorialBoardHeading">Meet the Editorial Board</h2>
            <p class="text-center text-gray-700 mb-8" data-lang-key="editorialBoardIntro">Our journal is guided by a distinguished panel of scholars and experts in Libyan archaeology and related fields. Their expertise ensures the high quality and academic rigor of our publications.</p>
            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8">
                <!-- Mock Editorial Board Members - These would ideally come from Firestore as well -->
                <div class="bg-gray-100 p-6 rounded-lg shadow-md border border-gray-200 text-center">
                    <img class="w-32 h-32 rounded-full mx-auto mb-4 object-cover border-2 border-gray-300 shadow-sm" src="https://placehold.co/128x128/e0e2e5/3f4245?text=EB" alt="Eugenio La Rocca">
                    <h3 class="text-xl font-semibold text-gray-800">Prof. Eugenio La Rocca</h3>
                    <p class="text-gray-700 text-sm mb-2" data-lang-key="editorInChief">Editor-in-Chief</p>
                    <p class="text-gray-600 text-sm">University of Rome "La Sapienza"</p>
                </div>
                 <div class="bg-gray-100 p-6 rounded-lg shadow-md border border-gray-200 text-center">
                    <img class="w-32 h-32 rounded-full mx-auto mb-4 object-cover border-2 border-gray-300 shadow-sm" src="https://placehold.co/128x128/e0e2e5/3f4245?text=AH" alt="Ahmed Hussein Y. Abdulkariem">
                    <h3 class="text-xl font-semibold text-gray-800">Dr. Ahmed Hussein Y. Abdulkariem</h3>
                    <p class="text-gray-700 text-sm mb-2" data-lang-key="associateEditor">Associate Editor</p>
                    <p class="text-gray-600 text-sm">Department of Antiquities, Libya</p>
                </div>
                <div class="bg-gray-100 p-6 rounded-lg shadow-md border border-gray-200 text-center">
                    <img class="w-32 h-32 rounded-full mx-auto mb-4 object-cover border-2 border-gray-300 shadow-sm" src="https://placehold.co/128x128/e0e2e5/3f4245?text=BB" alt="Barbara Barich">
                    <h3 class="text-xl font-semibold text-gray-800">Prof. Barbara Barich</h3>
                    <p class="text-gray-700 text-sm mb-2" data-lang-key="editorialBoardMember">Editorial Board Member</p>
                    <p class="text-gray-600 text-sm">University of Rome "La Sapienza"</p>
                </div>
            </div>
            <p class="text-center text-gray-600 mt-8" data-lang-key="editorialBoardComingSoon">Full list of the editorial board and their biographies coming soon.</p>
        </section>

        <!-- Current Issue View -->
        <section id="currentIssueView" class="view hidden section-content flex flex-col items-center">
            <h2 class="text-3xl text-center mb-6" data-lang-key="currentIssueHeading">Current Issue</h2>
            <div id="currentIssueContent" class="text-center w-full max-w-3xl">
                <p class="text-gray-700 text-lg mb-4" data-lang-key="noCurrentIssue">No current issue set yet. Check back soon!</p>
                <div id="currentIssuePublicationCard" class="publication-card p-6 flex flex-col items-center text-center shadow-lg transition duration-500 ease-out hidden">
                    <img id="currentIssueCover" src="" alt="Current Issue Cover" class="cover-image rounded-lg mb-6 shadow-xl" onerror="this.onerror=null;this.src='https://placehold.co/400x600/cccccc/333333?text=No+Image';">
                    <h3 id="currentIssueTitle" class="text-3xl font-bold mb-3 text-gray-800"></h3>
                    <p id="currentIssueAuthors" class="text-gray-700 text-xl mb-2"></p>
                    <p id="currentIssueYear" class="text-gray-500 text-lg font-medium mb-4"></p>
                    <p id="currentIssueDescription" class="text-gray-600 text-md leading-relaxed mb-6"></p>
                    <div class="modal-download-group">
                        <a id="currentIssueDownloadPdfBtn" href="#" target="_blank" class="admin-button" data-lang-key="downloadFullPdfBtn">Download Full PDF</a>
                        <button id="currentIssueDownloadAbstractArBtn" class="admin-button" data-lang-key="downloadArabicAbstractPdfBtn">Download Arabic Abstract (PDF)</button>
                        <button id="currentIssueDownloadAbstractEnBtn" class="admin-button" data-lang-key="downloadEnglishAbstractPdfBtn">Download English Abstract (PDF)</button>
                        <button id="currentIssueDownloadAbstractItBtn" class="admin-button" data-lang-key="downloadItalianAbstractPdfBtn">Download Italian Abstract (PDF)</button>
                    </div>
                </div>
            </div>
        </section>

        <!-- Archival Volumes View -->
        <section id="archivalVolumesView" class="view hidden section-content">
            <h2 class="text-3xl text-center mb-6" data-lang-key="archivalVolumesHeading">Archival Volumes</h2>
            <p class="text-center text-gray-700 mb-8" data-lang-key="archivalVolumesIntro">Explore the rich history of archaeological research in Libya through our past publications. Browse by year or special issue below.</p>
            <div id="archivalPublicationsList" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8">
                <p class="col-span-full text-center text-gray-400" data-lang-key="loadingArchivalVolumes">Loading archival volumes...</p>
            </div>
        </section>

        <!-- Editorial Guidelines & Code of Ethics View (Combined) -->
        <section id="editorialAndEthicsView" class="view hidden section-content">
            <h2 class="text-3xl text-center mb-6" data-lang-key="editorialEthicsHeading">Editorial Guidelines & Code of Ethics</h2>
            <div class="prose max-w-none text-gray-700 leading-relaxed space-y-4">
                <h3 class="text-2xl font-bold mt-6 mb-3" data-lang-key="editorialGuidelinesTitle">Editorial Guidelines</h3>
                <p class="text-lg font-semibold" data-lang-key="articlesSubmittedTo">Articles must be submitted to:</p>
                <ul class="list-disc ml-6 space-y-1">
                    <li><a href="mailto:redazione@quadalibya.it" class="text-blue-600 hover:underline">redazione@quadalibya.it</a></li>
                    <li><a href="mailto:laura.buccino@quadalibya.it" class="text-blue-600 hover:underline">laura.buccino@quadalibya.it</a></li>
                </ul>
                <h4 class="text-xl font-bold mt-4 mb-2" data-lang-key="submissionProcedureTitle">Submission Procedure:</h4>
                <ul class="list-disc ml-6 space-y-2">
                    <li data-lang-key="submissionProcedure1">Contributions should be sent in digital format .doc (Microsoft Word) as an e-mail attachment.</li>
                    <li data-lang-key="submissionProcedure2">The contents will be reviewed by at least two anonymous readers and if necessary, will be returned to the author for eventual corrections and changes.</li>
                    <li data-lang-key="submissionProcedure3">Only one set of proofs will be sent to the authors who are expected to correct and return them by the deadline set by the editors.</li>
                    <li data-lang-key="submissionProcedure4">With regard to illustrations, a file including captions and photograph credits should be sent separately. The text should be accompanied by a digital copy of the images to be published (please, use WeTransfer if images are too heavy to be sent as email attachments).</li>
                    <li data-lang-key="submissionProcedure5">The images must be in JPG or TIFF formats and at a minimum resolution of 300 dpi (pixel definition). All images submitted for publication should comply with the copyright rules and there must be an agreement (or a release form) about image reproduction by the copyright owner prior to publication. The author is sole responsible for securing such permits. No image without such accompanying documents will be published.</li>
                </ul>

                <h4 class="text-xl font-bold mt-4 mb-2" data-lang-key="articleRequirementsTitle">Article Requirements:</h4>
                <ul class="list-disc ml-6 space-y-2">
                    <li data-lang-key="articleRequirements1">An abstract of ca. 500 characters / 100 words in the language of the text and in English.</li>
                    <li data-lang-key="articleRequirements2">Title in English.</li>
                    <li data-lang-key="articleRequirements3">5 Keywords in Italian and English.</li>
                    <li data-lang-key="articleRequirements4">Footnotes.</li>
                    <li data-lang-key="articleRequirements5">Address and email address of the author.</li>
                    <li data-lang-key="articleRequirements6">Institutional affiliation of the author.</li>
                </ul>

                <h4 class="text-xl font-bold mt-4 mb-2" data-lang-key="formattingGuidelinesTitle">Formatting Guidelines:</h4>
                <ul class="list-disc ml-6 space-y-2">
                    <li data-lang-key="formattingGuidelines1">Quotes are inserted within double quotation marks "..."</li>
                    <li data-lang-key="formattingGuidelines2">Single quotation marks are used to emphasize specific words or expressions '...'.</li>
                    <li data-lang-key="formattingGuidelines3">Transliterations from other languages (as, for example, from Greek or Arabic) are italicized.</li>
                    <li data-lang-key="formattingGuidelines4">If special characters are used in the text (such as in the case of Greek), the font should be specified.</li>
                    <li data-lang-key="formattingGuidelines5">Latin and Greek sources must be cited using the abbreviations in: Thesaurus Linguae Latinae, The Online Liddell-Scott-Jones Greek-English Lexicon (http://stephanus.tlg.uci.edu/lsj/01-authors_and_works.html) and, if not present, G.W.H. LAMPE, A Patristic Greek Lexicon, Oxford 1961.</li>
                </ul>

                <h4 class="text-xl font-bold mt-4 mb-2" data-lang-key="commonAbbreviationsTitle">Commonly-used Abbreviations:</h4>
                <ul class="list-disc ml-6 space-y-1">
                    <li data-lang-key="abbrCat">cat. = catalogue</li>
                    <li data-lang-key="abbrCf">cf. = confer</li>
                    <li data-lang-key="abbrCm">cm = centimeters</li>
                    <li data-lang-key="abbrCol">col./cols = column/columns</li>
                    <li data-lang-key="abbrEAD">EAD. (small caps) = Eadem</li>
                    <li data-lang-key="abbrEtc">etc. = eccetera</li>
                    <li data-lang-key="abbrF">f./ff. = following / followings</li>
                    <li data-lang-key="abbrFig">fig./figs = figure / figures</li>
                    <li data-lang-key="abbrFol">fol. / fols = folio / folios</li>
                    <li data-lang-key="abbrID">ID. (small caps) = Idem</li>
                    <li data-lang-key="abbrIID">IID. (small caps) = Iidem</li>
                    <li data-lang-key="abbrL">l./ll. = line / lines</li>
                    <li data-lang-key="abbrNoInv">No. inv. = inventory number</li>
                    <li data-lang-key="abbrM">m = meters</li>
                    <li data-lang-key="abbrMs">ms. / mss = manuscript / manuscripts</li>
                    <li data-lang-key="abbrNo">no. / nos = number / numbers</li>
                    <li data-lang-key="abbrNd">n.d. = no date</li>
                    <li data-lang-key="abbrNp">n.p. = no place</li>
                    <li data-lang-key="abbrNote">note = note</li>
                    <li data-lang-key="abbrP">p./pp. = page/pages</li>
                    <li data-lang-key="abbrSee">see = see</li>
                    <li data-lang-key="abbrSv">s.v. (italics) = sub voce</li>
                    <li data-lang-key="abbrPl">pl./pls = plate / plates</li>
                    <li data-lang-key="abbrVol">vol. / vols = volume / volumes</li>
                </ul>
                <p class="text-sm text-gray-600 mt-8" data-lang-key="fullGuidelinesNote">Note: This is a summary of the full editorial guidelines. For complete bibliographic rules, please refer to the comprehensive document.</p>

                <div class="section-separator"></div>

                <h3 class="text-2xl font-bold mt-12 mb-3" data-lang-key="ethicsStatementTitle">Code of Ethics and Malpractice Statement</h3>
                <p data-lang-key="ethicsStatementPara1">This document outlines the ethics principles and good practices applied by the publishing house L'ERMA di Bretschneider (hereafter L'ERMA) to the process of editing and publishing monographs, scientific journals, and other editorial content of scientific, educational, and outreach nature. L'ERMA is inspired by the ethical principles outlined by the Committee on Publication Ethics (hereinafter COPE), an international non-profit organization that aims to support publishers and editors in pursuing high standards of publishing ethics. Although COPE mainly provides guidelines and resources for publishers and editors of scientific journals, these can also be applied to the publication of monographs and other academic content.</p>
                <h4 class="text-xl font-bold mt-4 mb-2" data-lang-key="researchEthicsTitle">I. Research ethics and integrity</h4>
                <p data-lang-key="researchEthicsPara1">L'ERMA publications respect the ethical principles of COPE, which are: Reliability; honesty, respect, and responsibility in all aspects of research; Care, accuracy, and excellence in research practice; Transparency, reproducibility, traceability, and open communication; Attention and respect for all participants and research subjects.</p>
                <p data-lang-key="researchEthicsPara2">Whoever believes that research published by L'ERMA has not been conducted in line with these ethical practices is invited to raise the issue with the publisher at lerma@lerma.it. Where possible, each report will be handled following COPE guidelines, and/or by submitting the matter to the Chairman of the Board of Directors of the publishing house and, if necessary, to the members of the Editorial Board of the publishing house.</p>
                <!-- Further Code of Ethics content here as previously -->
                <p class="text-sm text-gray-600 mt-8" data-lang-key="lastUpdatedDate">Last updated 27 February 2024</p>
            </div>
        </section>

        <!-- News & Current Events View -->
        <section id="newsEventsView" class="view hidden section-content">
            <h2 class="text-3xl text-center mb-6" data-lang-key="newsEventsHeading">News & Current Events</h2>
            <p class="text-center text-gray-700 mb-8" data-lang-key="newsEventsIntro">Stay updated with the latest news, discoveries, and announcements from Quaderni di Archeologia della Libya.</p>
            <div id="newsFeed" class="grid grid-cols-1 md:grid-cols-2 gap-8">
                <p class="col-span-full text-center text-gray-400" data-lang-key="noNewsUpdates">No news updates yet. Check back soon!</p>
            </div>
        </section>

        <!-- Admin Login View -->
        <section id="adminLoginView" class="view hidden section-content max-w-md mx-auto">
            <h2 class="text-3xl text-center mb-6" data-lang-key="adminLoginHeading">Admin Login</h2>
            <form id="adminLoginForm" class="space-y-4">
                <div>
                    <label for="adminEmail" class="block text-sm font-semibold mb-1" data-lang-key="emailLabel">Email:</label>
                    <input type="email" id="adminEmail" class="admin-input w-full" required>
                </div>
                <div>
                    <label for="adminPassword" class="block text-sm font-semibold mb-1" data-lang-key="passwordLabel">Password:</label>
                    <input type="password" id="adminPassword" class="admin-input w-full" required>
                </div>
                <button type="submit" class="admin-button w-full bg-green-600 hover:bg-green-700" data-lang-key="loginButton">Login</button>
                <p class="text-red-400 text-sm mt-2 text-center" id="loginErrorMessage"></p>
            </form>
        </section>

        <!-- Admin Dashboard View -->
        <section id="adminDashboardView" class="view hidden admin-bg p-8 rounded-lg shadow-md max-w-4xl mx-auto">
            <h2 class="text-3xl text-center mb-6" data-lang-key="adminDashboardHeading">Admin Dashboard</h2>
            <p class="text-center text-gray-700 mb-4" data-lang-key="welcomeAdmin">Welcome, <span id="loggedInUserEmail" class="font-semibold"></span>!</p>

            <!-- Admin Nav for sub-sections -->
            <nav class="flex justify-center space-x-4 mb-8">
                <button class="admin-button" id="managePublicationsBtn" data-lang-key="managePublicationsBtn">Manage Publications</button>
                <button class="admin-button" id="manageNewsBtn" data-lang-key="manageNewsBtn">Manage News</button>
                <button class="admin-button" id="manageSiteSettingsBtn" data-lang-key="manageSiteSettingsBtn">Site Settings</button>
                <button class="admin-button bg-red-600 hover:bg-red-700" id="adminLogoutBtn" data-lang-key="logoutButton">Logout</button>
            </nav>

            <!-- Manage Publications Section -->
            <div id="adminManagePublications" class="admin-section">
                <h3 id="adminFormTitle" class="text-2xl font-bold mb-4" data-lang-key="addPublicationTitle">Add New Publication</h3>
                <form id="addPublicationForm" class="space-y-4">
                    <div>
                        <label for="bookTitle" class="block text-sm font-semibold mb-1" data-lang-key="titleLabel">Title:</label>
                        <input type="text" id="bookTitle" class="admin-input w-full" required>
                    </div>
                    <div>
                        <label for="bookAuthors" class="block text-sm font-semibold mb-1" data-lang-key="authorsLabel">Authors (comma-separated):</label>
                        <input type="text" id="bookAuthors" class="admin-input w-full" required>
                    </div>
                     <div>
                        <label for="bookYear" class="block text-sm font-semibold mb-1" data-lang-key="publicationYearLabel">Publication Year:</label>
                        <input type="number" id="bookYear" class="admin-input w-full" min="1900" max="2100" required>
                    </div>
                    <div>
                        <label for="bookDescription" class="block text-sm font-semibold mb-1" data-lang-key="descriptionLabel">Description:</label>
                        <textarea id="bookDescription" rows="3" class="admin-input w-full" required></textarea>
                    </div>
                    <div>
                        <label for="bookISBN" class="block text-sm font-semibold mb-1" data-lang-key="isbnLabel">ISBN:</label>
                        <input type="text" id="bookISBN" class="admin-input w-full">
                    </div>
                    <div>
                        <label for="bookISSN" class="block text-sm font-semibold mb-1" data-lang-key="issnLabel">ISSN:</label>
                        <input type="text" id="bookISSN" class="admin-input w-full">
                    </div>

                    <!-- Abstract Text Areas -->
                    <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                        <div>
                            <label for="abstractArText" class="block text-sm font-semibold mb-1" data-lang-key="arabicAbstractTextLabel">Arabic Abstract (Text):</label>
                            <textarea id="abstractArText" rows="3" class="admin-input w-full"></textarea>
                        </div>
                        <div>
                            <label for="abstractEnText" class="block text-sm font-semibold mb-1" data-lang-key="englishAbstractTextLabel">English Abstract (Text):</label>
                            <textarea id="abstractEnText" rows="3" class="admin-input w-full"></textarea>
                        </div>
                        <div>
                            <label for="abstractItText" class="block text-sm font-semibold mb-1" data-lang-key="italianAbstractTextLabel">Italian Abstract (Text):</label>
                            <textarea id="abstractItText" rows="3" class="admin-input w-full"></textarea>
                        </div>
                    </div>

                    <!-- File Uploads for Cover, PDF, and Abstract PDFs -->
                    <div>
                        <label for="bookCover" class="block text-sm font-semibold mb-1" data-lang-key="coverImageLabel">Cover Image (Optional):</label>
                        <input type="file" id="bookCover" accept="image/*" class="admin-input w-full">
                        <div class="file-upload-preview" id="coverImagePreviewContainer">
                            <img id="uploadedCoverPreviewAdmin" src="" alt="Uploaded Cover Preview" class="max-w-[100px] h-auto rounded-lg shadow-sm" style="display:none;">
                            <p id="coverImageFileNameDisplayAdmin" class="text-xs text-gray-600"></p>
                        </div>
                    </div>
                    <div>
                        <label for="bookPdf" class="block text-sm font-semibold mb-1" data-lang-key="fullBookPdfLabel">Full Book PDF (Optional - First 20 Pages):</label>
                        <input type="file" id="bookPdf" accept="application/pdf" class="admin-input w-full">
                        <p id="pdfFileNameDisplayAdmin" class="text-xs text-gray-600 mt-1"></p>
                    </div>
                    <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                        <div>
                            <label for="abstractArPdf" class="block text-sm font-semibold mb-1" data-lang-key="arabicAbstractPdfLabel">Arabic Abstract (PDF - Optional):</label>
                            <input type="file" id="abstractArPdf" accept="application/pdf" class="admin-input w-full">
                            <p id="abstractArPdfFileNameDisplayAdmin" class="text-xs text-gray-600 mt-1"></p>
                        </div>
                        <div>
                            <label for="abstractEnPdf" class="block text-sm font-semibold mb-1" data-lang-key="englishAbstractPdfLabel">English Abstract (PDF - Optional):</label>
                            <input type="file" id="abstractEnPdf" accept="application/pdf" class="admin-input w-full">
                            <p id="abstractEnPdfFileNameDisplayAdmin" class="text-xs text-gray-600 mt-1"></p>
                        </div>
                        <div>
                            <label for="abstractItPdf" class="block text-sm font-semibold mb-1" data-lang-key="italianAbstractPdfLabel">Italian Abstract (PDF - Optional):</label>
                            <input type="file" id="abstractItPdf" accept="application/pdf" class="admin-input w-full">
                            <p id="abstractItPdfFileNameDisplayAdmin" class="text-xs text-gray-600 mt-1"></p>
                        </div>
                    </div>
                    
                    <div class="flex items-center">
                        <input type="checkbox" id="bookIsCurrentIssue" class="h-4 w-4 text-blue-600 border-gray-300 rounded focus:ring-blue-500">
                        <label for="bookIsCurrentIssue" class="ml-2 block text-sm font-semibold" data-lang-key="setCurrentIssueLabel">Set as Current Issue</label>
                    </div>

                    <div class="flex justify-between gap-4">
                        <button type="submit" id="submitPublicationBtn" class="admin-button w-full bg-green-600 hover:bg-green-700" data-lang-key="addPublicationButton">Add Publication</button>
                        <button type="button" id="cancelEditPublicationBtn" class="admin-button w-full bg-gray-500 hover:bg-gray-600 hidden" data-lang-key="cancelEditButton">Cancel Edit</button>
                    </div>
                </form>

                <h3 class="text-2xl font-bold mt-8 mb-4" data-lang-key="managePublicationsHeading">Manage Existing Publications</h3>
                <div class="overflow-x-auto">
                    <table class="min-w-full divide-y divide-gray-300">
                        <thead class="admin-table-header">
                            <tr>
                                <th scope="col" class="px-6 py-3 text-left text-xs font-semibold uppercase tracking-wider text-gray-800" data-lang-key="tableHeaderTitle">Title</th>
                                <th scope="col" class="px-6 py-3 text-left text-xs font-semibold uppercase tracking-wider text-gray-800" data-lang-key="tableHeaderAuthors">Authors</th>
                                <th scope="col" class="px-6 py-3 text-left text-xs font-semibold uppercase tracking-wider text-gray-800" data-lang-key="tableHeaderYear">Year</th>
                                <th scope="col" class="px-6 py-3 text-left text-xs font-semibold uppercase tracking-wider text-gray-800" data-lang-key="tableHeaderActions">Actions</th>
                            </tr>
                        </thead>
                        <tbody id="adminPublicationsList" class="divide-y divide-gray-300">
                            <tr class="admin-table-row"><td colspan="4" class="px-6 py-4 whitespace-nowrap text-sm text-gray-600" data-lang-key="noPublicationsToManage">No publications to manage.</td></tr>
                        </tbody>
                    </table>
                </div>
            </div>

            <!-- Manage News Section -->
            <div id="adminManageNews" class="admin-section hidden">
                <h3 class="text-2xl font-bold mb-4" data-lang-key="addNewsItemTitle">Add New News Item</h3>
                <form id="addNewsItemForm" class="space-y-4">
                    <div>
                        <label for="newsTitle" class="block text-sm font-semibold mb-1" data-lang-key="newsTitleLabel">News Title:</label>
                        <input type="text" id="newsTitle" class="admin-input w-full" required>
                    </div>
                    <div>
                        <label for="newsDescription" class="block text-sm font-semibold mb-1" data-lang-key="newsDescriptionLabel">News Description:</label>
                        <textarea id="newsDescription" rows="3" class="admin-input w-full" required></textarea>
                    </div>
                    <div>
                        <label for="newsImage" class="block text-sm font-semibold mb-1" data-lang-key="newsImageLabel">News Image (Optional):</label>
                        <input type="file" id="newsImage" accept="image/*" class="admin-input w-full">
                        <div class="file-upload-preview" id="newsImagePreviewContainer">
                            <img id="uploadedNewsImagePreviewAdmin" src="" alt="Uploaded News Image Preview" class="max-w-[100px] h-auto rounded-lg shadow-sm" style="display:none;">
                            <p id="newsImageFileNameDisplayAdmin" class="text-xs text-gray-600"></p>
                        </div>
                    </div>
                    <button type="submit" id="submitNewsBtn" class="admin-button w-full bg-blue-600 hover:bg-blue-700" data-lang-key="addNewsItemButton">Add News Item</button>
                    <button type="button" id="cancelEditNewsBtn" class="admin-button w-full bg-gray-500 hover:bg-gray-600 hidden" data-lang-key="cancelEditButton">Cancel Edit</button>
                </form>

                <h3 class="text-2xl font-bold mt-8 mb-4" data-lang-key="manageNewsHeading">Manage Existing News</h3>
                <div class="overflow-x-auto">
                    <table class="min-w-full divide-y divide-gray-300">
                        <thead class="admin-table-header">
                            <tr>
                                <th scope="col" class="px-6 py-3 text-left text-xs font-semibold uppercase tracking-wider text-gray-800" data-lang-key="tableHeaderTitle">Title</th>
                                <th scope="col" class="px-6 py-3 text-left text-xs font-semibold uppercase tracking-wider text-gray-800" data-lang-key="tableHeaderDate">Date</th>
                                <th scope="col" class="px-6 py-3 text-left text-xs font-semibold uppercase tracking-wider text-gray-800" data-lang-key="tableHeaderActions">Actions</th>
                            </tr>
                        </thead>
                        <tbody id="adminNewsList" class="divide-y divide-gray-300">
                            <tr class="admin-table-row"><td colspan="3" class="px-6 py-4 whitespace-nowrap text-sm text-gray-600" data-lang-key="noNewsToManage">No news items to manage.</td></tr>
                        </tbody>
                    </table>
                </div>
            </div>

            <!-- Manage Site Settings Section (New Admin Feature) -->
            <div id="adminManageSiteSettings" class="admin-section hidden">
                <h3 class="text-2xl font-bold mb-4" data-lang-key="manageSiteLogosHeading">Manage Site Logos</h3>
                <form id="logoUploadForm" class="space-y-4">
                    <div>
                        <label for="headerLogoUpload" class="block text-sm font-semibold mb-1" data-lang-key="headerLogoUploadLabel">Upload Header Logo:</label>
                        <input type="file" id="headerLogoUpload" accept="image/*" class="admin-input w-full">
                        <div class="file-upload-preview" id="headerLogoPreviewContainer">
                            <img id="headerLogoPreview" src="" alt="Header Logo Preview" class="max-w-[100px] h-auto rounded-lg shadow-sm" style="display:none;">
                            <p id="headerLogoFileNameDisplayAdmin" class="text-xs text-gray-600"></p>
                        </div>
                    </div>
                    <div>
                        <label for="footerLogoUpload" class="block text-sm font-semibold mb-1" data-lang-key="footerLogoUploadLabel">Upload Footer Logo:</label>
                        <input type="file" id="footerLogoUpload" accept="image/*" class="admin-input w-full">
                        <div class="file-upload-preview" id="footerLogoPreviewContainer">
                            <img id="footerLogoPreview" src="" alt="Footer Logo Preview" class="max-w-[100px] h-auto rounded-lg shadow-sm" style="display:none;">
                            <p id="footerLogoFileNameDisplayAdmin" class="text-xs text-gray-600"></p>
                        </div>
                    </div>
                    <button type="submit" class="admin-button w-full bg-blue-600 hover:bg-blue-700" data-lang-key="updateLogosButton">Update Logos</button>
                </form>

                <div class="section-separator"></div>

                <h3 class="text-2xl font-bold mb-4" data-lang-key="manageContributorLogosHeading">Manage Contributor Logos</h3>
                <form id="contributorLogoUploadForm" class="space-y-4">
                    <div>
                        <label for="contributor1LogoUpload" class="block text-sm font-semibold mb-1" data-lang-key="contributor1LogoLabel">Upload L'ERMA Logo:</label>
                        <input type="file" id="contributor1LogoUpload" accept="image/*" class="admin-input w-full">
                        <div class="file-upload-preview">
                            <img id="contributor1LogoPreview" src="" alt="L'ERMA Logo Preview" class="max-w-[100px] h-auto rounded-lg shadow-sm" style="display:none;">
                            <p id="contributor1FileNameDisplayAdmin" class="text-xs text-gray-600"></p>
                        </div>
                    </div>
                    <div>
                        <label for="contributor2LogoUpload" class="block text-sm font-semibold mb-1" data-lang-key="contributor2LogoLabel">Upload Fondazione MEDA Logo:</label>
                        <input type="file" id="contributor2LogoUpload" accept="image/*" class="admin-input w-full">
                        <div class="file-upload-preview">
                            <img id="contributor2LogoPreview" src="" alt="Fondazione MEDA Logo Preview" class="max-w-[100px] h-auto rounded-lg shadow-sm" style="display:none;">
                            <p id="contributor2FileNameDisplayAdmin" class="text-xs text-gray-600"></p>
                        </div>
                    </div>
                    <button type="submit" class="admin-button w-full bg-blue-600 hover:bg-blue-700" data-lang-key="updateContributorLogosButton">Update Contributor Logos</button>
                </form>
            </div>

        </section>

    </main>

    <!-- Footer Section -->
    <footer class="footer-bg py-6 mt-8 shadow-inner">
        <div class="container flex flex-col md:flex-row items-center justify-between text-sm">
            <!-- Logo on the left -->
            <div class="flex items-center space-x-4 mb-4 md:mb-0">
                <img id="footerLogo" src="https://placehold.co/150x60/e0e2e5/3f4245?text=Footer+Logo" alt="Quaderni di Archeologia della Libya Logo" class="footer-logo">
                <p>&copy; <span id="currentYear"></span> <span data-lang-key="copyrightText">Quaderni di Archeologia della Libya. All rights reserved.</span></p>
            </div>
            
            <!-- Contact Info -->
            <div class="text-center md:text-left space-y-1 mb-4 md:mb-0">
                <p class="font-bold" data-lang-key="contactUsLabel">Contact Us:</p>
                <p data-lang-key="emailAddress"><span data-lang-key="emailLabelShort">Email:</span> <a href="mailto:info@archaeologylibya.org" class="footer-link">info@archaeologylibya.org</a></p>
                <p data-lang-key="phoneNumber"><span data-lang-key="phoneLabelShort">Phone:</span> +39 06 6874127</p>
            </div>

            <!-- Contributors & Admin Login -->
            <div class="text-center md:text-right space-y-2">
                <p class="font-bold" data-lang-key="contributorsLabel">Contributors:</p>
                <div class="flex justify-center md:justify-end items-center gap-4">
                    <img id="contributor1Logo" src="https://placehold.co/100x40/e0e2e5/3f4245?text=L%27ERMA" alt="L'ERMA di Bretschneider Logo" class="h-10">
                    <img id="contributor2Logo" src="https://placehold.co/100x40/e0e2e5/3f4245?text=MEDA" alt="Fondazione MEDA Logo" class="h-10">
                </div>
                <button id="adminLoginBtnFooter" class="nav-button bg-transparent hover:bg-gray-700 border border-white text-white mt-4" data-lang-key="adminLoginButton">Admin Login</button>
            </div>
        </div>
    </footer>

    <!-- Firebase SDK -->
    <script type="module">
        // Firebase CDN Imports
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
        import { getAuth, signInWithEmailAndPassword, onAuthStateChanged, signOut, signInAnonymously, signInWithCustomToken } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js";
        import { getFirestore, collection, addDoc, getDocs, doc, deleteDoc, onSnapshot, query, orderBy, where, getDoc, updateDoc, setDoc } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";
        import { getStorage, ref, uploadBytes, getDownloadURL, deleteObject } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-storage.js";

        // Global Firebase Variables (Provided by Canvas Environment, or Fallback to hardcoded)
        const hardcodedFirebaseConfig = {
            apiKey: "AIzaSyDrOjIfbI2ttZF_Dp8JSRNpl_eL8XU4JGk",
            authDomain: "quadernilibyawebsite.firebaseapp.com",
            projectId: "quadernilibyawebsite",
            storageBucket: "quadernilibyawebsite.firebasestorage.app",
            messagingSenderId: "8372415971",
            appId: "1:8372415971:web:76fdcc247797cac05784d6",
            measurementId: "G-G74YV94Y52"
        };

        const appId = typeof __app_id !== 'undefined' ? __app_id : hardcodedFirebaseConfig.projectId;
        const firebaseConfig = typeof __firebase_config !== 'undefined' ? JSON.parse(__firebase_config) : hardcodedFirebaseConfig;
        const initialAuthToken = typeof __initial_auth_token !== 'undefined' ? __initial_auth_token : null;

        // --- IMPORTANT: Initial Logo Paths (Placeholders if not set by admin) ---
        const DEFAULT_HEADER_LOGO_URL = 'https://placehold.co/200x90/e0e2e5/3f4245?text=Header+Logo';
        const DEFAULT_FOOTER_LOGO_URL = 'https://placehold.co/150x60/e0e2e5/3f4245?text=Footer+Logo';
        const DEFAULT_CONTRIB1_LOGO_URL = 'https://placehold.co/100x40/e0e2e5/3f4245?text=L%27ERMA';
        const DEFAULT_CONTRIB2_LOGO_URL = 'https://placehold.co/100x40/e0e2e5/3f4245?text=MEDA';

        const SITE_SETTINGS_DOC_ID = 'siteSettings';

        // Firebase Service Instances
        let app, db, auth, storage, userId;

        // Global state for editing and file uploads
        let editingPublicationId = null;
        let editingNewsItemId = null;

        // Current file URLs/names for form management during edits and site settings
        let currentPubFiles = {
            coverUrl: '', coverFileName: '',
            pdfUrl: '', pdfFileName: '',
            abstracts: {
                ar: { text: '', url: '', fileName: '' },
                en: { text: '', url: '', fileName: '' },
                it: { text: '', url: '', fileName: '' }
            }
        };
        let currentNewsImage = { url: '', fileName: '' };
        let currentHeaderLogo = { url: DEFAULT_HEADER_LOGO_URL, fileName: '' };
        let currentFooterLogo = { url: DEFAULT_FOOTER_LOGO_URL, fileName: '' };
        let currentContributor1Logo = { url: DEFAULT_CONTRIB1_LOGO_URL, fileName: '' };
        let currentContributor2Logo = { url: DEFAULT_CONTRIB2_LOGO_URL, fileName: '' };

        // Paths to Firestore collections in `public` scope
        const PUBLIC_PUB_COLLECTION = `artifacts/${appId}/public/data/publications`;
        const PUBLIC_NEWS_COLLECTION = `artifacts/${appId}/public/data/news`;
        const PUBLIC_SETTINGS_COLLECTION = `artifacts/${appId}/public/data/settings`;
        const STORAGE_PATH_COVERS = `artifacts/${appId}/public/files/covers`;
        const STORAGE_PATH_PDFS = `artifacts/${appId}/public/files/pdfs`;
        const STORAGE_PATH_ABSTRACTS = `artifacts/${appId}/public/files/abstracts`;
        const STORAGE_PATH_NEWS_IMAGES = `artifacts/${appId}/public/files/news`;
        const STORAGE_PATH_LOGOS = `artifacts/${appId}/public/files/logos`;


        // --- Translation Setup (Optimized for brevity) ---
        let currentLanguage = localStorage.getItem('siteLanguage') || 'en';

        const translations = {
            en: {
                pageTitle: "QAL - Publications",
                navAboutUs: "About Us", navEditorialBoard: "Editorial Board", navCurrentIssue: "Current Issue",
                navArchivalVolumes: "Archival Volumes", navEditorialEthics: "Editorial Guidelines & Ethics",
                navNewsEvents: "News & Events", adminLoginButton: "Admin Login", logoutButton: "Logout",
                searchPlaceholder: "Search...", sortYearNewest: "Year (Newest)", sortYearOldest: "Year (Oldest)",
                sortTitleAZ: "Title (A-Z)", sortTitleZA: "Title (Z-A)", sortAuthorAZ: "Author (A-Z)",
                sortAuthorZA: "Author (Z-A)", loadingPublications: "Loading...", noPubsFound: "No publications.",
                noSearchResults: "No results.", viewDetailsButton: "Details", confirmDelete: "Confirm Delete",
                confirmDeleteMsg: "Are you sure? Files will be removed.", successMessage: "Success", errorMessage: "Error",
                permissionDenied: "Permission Denied", loadingMessage: "Loading...", unavailable: "Unavailable",
                isbnLabel: "ISBN:", issnLabel: "ISSN:", downloadFullPdfBtn: "Full PDF",
                downloadArabicAbstractPdfBtn: "Arabic Abstract (PDF)", downloadEnglishAbstractPdfBtn: "English Abstract (PDF)",
                downloadItalianAbstractPdfBtn: "Italian Abstract (PDF)", arabicAbstractTextLabel: "Arabic Abstract:",
                englishAbstractTextLabel: "English Abstract:", italianAbstractTextLabel: "Italian Abstract:",
                noDescription: "No description.", pubDetailsNotFound: "Pub details not found.", fullPdfUnavailable: "Full PDF unavail.",
                arabicAbstractPdfUnavailable: "Arabic PDF unavail.", englishAbstractPdfUnavailable: "English PDF unavail.",
                italianAbstractPdfUnavailable: "Italian PDF unavail.",
                aboutUsHeading: "About QAL",
                aboutUsPara1: "Welcome to <strong>Quaderni di Archeologia della Libya</strong>, a journal dedicated to archaeological research in Libya. Started in 1950, it documents Italian archaeological missions, fostering understanding of ancient history.",
                aboutUsPara2: "After a hiatus, the journal resumed in 2018, re-establishing itself as a leading scientific platform. We provide an essential venue for scholars interested in Libya and Maghreb archaeology and history.",
                aboutUsPara3: "Our volumes embrace multidisciplinary approaches, featuring articles on epigraphy, history, and territorial studies. Contributions are in major European languages, with English and Arabic abstracts, for international exchange.",
                aboutUsPara4: "This site is maintained by L'Erma di Bretschneider, a renowned academic publisher. We are committed to high scholarly standards and global dissemination of QAL research.",
                currentPublicationsHeading: "Current Publications", editorialBoardHeading: "Editorial Board",
                editorialBoardIntro: "Our journal is guided by distinguished scholars. Their expertise ensures high quality and rigor.",
                editorInChief: "Editor-in-Chief", associateEditor: "Associate Editor", editorialBoardMember: "Member",
                editorialBoardComingSoon: "Full list and bios coming soon.", currentIssueHeading: "Current Issue",
                noCurrentIssue: "No current issue set. Check back soon!", archivalVolumesHeading: "Archival Volumes",
                archivalVolumesIntro: "Explore past publications. Browse by year or special issue.",
                loadingArchivalVolumes: "Loading archival volumes...", editorialEthicsHeading: "Editorial Guidelines & Code of Ethics",
                editorialGuidelinesTitle: "Editorial Guidelines", articlesSubmittedTo: "Articles to:", submissionProcedureTitle: "Submission:",
                submissionProcedure1: "Send .doc files as email attachment.", submissionProcedure2: "Contents reviewed by two anonymous readers; corrections returned if needed.",
                submissionProcedure3: "One set of proofs sent to authors; return by deadline.", submissionProcedure4: "Captions and credits file separate. Digital images (JPG/TIFF, 300 dpi) via WeTransfer if large.",
                submissionProcedure5: "Images must comply with copyright. Author responsible for permits. No unpermitted images published.",
                articleRequirementsTitle: "Requirements:", articleRequirements1: "Abstract (ca. 100 words) in text language and English.",
                articleRequirements2: "English title.", articleRequirements3: "5 Keywords (Italian/English).",
                articleRequirements4: "Footnotes.", articleRequirements5: "Author address/email.", articleRequirements6: "Institutional affiliation.",
                formattingGuidelinesTitle: "Formatting:", formattingGuidelines1: "Quotes: \"...\"", formattingGuidelines2: "Emphasis: '...'",
                formattingGuidelines3: "Transliterations (e.g., Greek, Arabic): italicized.", formattingGuidelines4: "Special characters (e.g., Greek): specify font.",
                formattingGuidelines5: "Latin/Greek sources: use Thesaurus Linguae Latinae, Online Liddell-Scott-Jones, or G.W.H. LAMPE.",
                commonAbbreviationsTitle: "Abbreviations:", abbrCat: "cat. = catalogue", abbrCf: "cf. = confer", abbrCm: "cm = centimeters",
                abbrCol: "col./cols = column/columns", abbrEAD: "EAD. = Eadem", abbrEtc: "etc. = etcetera",
                abbrF: "f./ff. = following / followings", abbrFig: "fig./figs = figure / figures", abbrFol: "fol. / fols = folio / folios",
                abbrID: "ID. = Idem", abbrIID: "IID. = Iidem", abbrL: "l./ll. = line / lines", abbrNoInv: "No. inv. = inventory number",
                abbrM: "m = meters", abbrMs: "ms. / mss = manuscript / manuscripts", abbrNo: "no. / nos = number / numbers",
                abbrNd: "n.d. = no date", abbrNp: "n.p. = no place", abbrNote: "note = note", abbrP: "p./pp. = page/pages",
                abbrSee: "see = see", abbrSv: "s.v. = sub voce", abbrPl: "pl./pls = plate / plates", abbrVol: "vol. / vols = volume / volumes",
                fullGuidelinesNote: "Summary of guidelines. Full bibliographic rules in comprehensive document.",
                ethicsStatementTitle: "Code of Ethics", ethicsStatementPara1: "This outlines ethics for L'ERMA publications, inspired by COPE principles to ensure high standards in scientific and academic content.",
                researchEthicsTitle: "I. Research ethics and integrity", researchEthicsPara1: "L'ERMA publications adhere to COPE's ethical principles: Reliability, honesty, respect, responsibility, care, accuracy, transparency, and open communication.",
                researchEthicsPara2: "Report ethical concerns to lerma@lerma.it. Reports handled per COPE guidelines and reviewed by the publisher/editorial board.",
                lastUpdatedDate: "Last updated 27 February 2024",
                newsEventsHeading: "News & Events", newsEventsIntro: "Stay updated with QAL news, discoveries, and announcements.",
                noNewsUpdates: "No news yet.", adminLoginHeading: "Admin Login", emailLabel: "Email:", passwordLabel: "Password:",
                loginButton: "Login", adminDashboardHeading: "Admin Dashboard", welcomeAdmin: "Welcome,",
                managePublicationsBtn: "Manage Publications", manageNewsBtn: "Manage News", manageSiteSettingsBtn: "Site Settings",
                addPublicationTitle: "Add Publication", titleLabel: "Title:", authorsLabel: "Authors (comma-separated):",
                publicationYearLabel: "Year:", descriptionLabel: "Description:", coverImageLabel: "Cover Image (Optional):",
                fullBookPdfLabel: "Full PDF (First 20 Pages):", arabicAbstractPdfLabel: "Arabic Abstract (PDF):",
                englishAbstractPdfLabel: "English Abstract (PDF):", italianAbstractPdfLabel: "Italian Abstract (PDF):",
                setCurrentIssueLabel: "Set as Current Issue", addPublicationButton: "Add Pub", updatePublicationButton: "Update Pub",
                cancelEditButton: "Cancel Edit", managePublicationsHeading: "Manage Pubs", tableHeaderTitle: "Title",
                tableHeaderAuthors: "Authors", tableHeaderYear: "Year", tableHeaderActions: "Actions",
                noPublicationsToManage: "No pubs to manage.", addNewsItemTitle: "Add News", newsTitleLabel: "News Title:",
                newsDescriptionLabel: "News Description:", newsImageLabel: "News Image (Optional):",
                addNewsItemButton: "Add News", updateNewsItemButton: "Update News", manageNewsHeading: "Manage News",
                tableHeaderDate: "Date", noNewsToManage: "No news to manage.", manageSiteLogosHeading: "Manage Logos",
                headerLogoUploadLabel: "Header Logo:", footerLogoUploadLabel: "Footer Logo:", updateLogosButton: "Update Logos",
                manageContributorLogosHeading: "Manage Contributor Logos", contributor1LogoLabel: "L'ERMA Logo:",
                contributor2LogoLabel: "MEDA Logo:", updateContributorLogosButton: "Update Contrib Logos",
                copyrightText: "QAL. All rights reserved.", contactUsLabel: "Contact Us:", emailLabelShort: "Email:",
                phoneLabelShort: "Phone:", selectedLabel: "Selected", currentLabel: "Current", currentLabelShort: "Current",
                noCustomHeaderLogo: "No custom header logo.", noCustomFooterLogo: "No custom footer logo.",
                noLERMALogo: "No L'ERMA logo.", noMEDALogo: "No MEDA logo.", fileUploadFailed: "File upload failed: ",
                checkStorageRules: "Check Firebase Storage rules.", fileNotFoundInStorage: "File not found in storage: ",
                fileDeletionFailed: "File deletion failed: ", siteLogosNotFound: "Site logos not found in DB. Using defaults.",
                couldNotLoadLogos: "Could not load site logos.", siteLogosUpdated: "Site logos updated.",
                errorUpdatingLogos: "Error updating site logos: ", contributorLogosUpdated: "Contributor logos updated.",
                errorUpdatingContributorLogos: "Error updating contributor logos: ", errorLoadingPublications: "Error loading publications.",
                checkFirebaseRules: "Check Firebase rules.", errorLoadingCurrentIssue: "Error loading current issue.",
                errorLoadingNews: "Error loading news.", adminLoginSuccessful: "Admin login successful!",
                logoutSuccessful: "Logout successful!", logoutFailed: "Logout failed: ", invalidCredentials: "Invalid credentials.",
                tooManyLoginAttempts: "Too many login attempts. Try again later.", errorLoadingAdminPublications: "Error loading admin publications.",
                noPermissionAddEditPublications: "You do not have permission to add/edit publications.",
                fillAllRequiredFields: "Please fill all required fields.", errorSavingPublication: "Error saving publication",
                publicationUpdated: "Publication updated.", publicationAdded: "Publication added.",
                publicationNotFoundForEdit: "Publication not found for edit.", errorLoadingPublicationForEdit: "Error loading publication for edit",
                publicationNotFoundForDeletion: "Publication not found for deletion.", errorDeletingPublication: "Error deleting publication",
                noPermissionAddNews: "You do not have permission to add news items.", newsItemUpdated: "News item updated.",
                newsItemAdded: "News item added.", errorSavingNewsItem: "Error saving news item",
                newsItemNotFoundForEdit: "News item not found for edit.", errorLoadingNewsItemForEdit: "Error loading news item for edit",
                newsItemNotFoundForDeletion: "News item not found for deletion.", errorDeletingNewsItem: "Error deleting news item",
                errorLoadingAdminNews: "Error loading admin news.", noPermissionUpdateSiteSettings: "You do not have permission to update site settings.",
                yesButton: "Yes", noButton: "No", okButton: "OK", editButton: "Edit", deleteButton: "Delete",
                noArabicAbstract: "No Arabic abstract text.", noEnglishAbstract: "No English abstract text.", noItalianAbstract: "No Italian abstract text."
            },
            it: {
                pageTitle: "QAL - Pubblicazioni",
                navAboutUs: "Chi Siamo", navEditorialBoard: "Comitato Editoriale", navCurrentIssue: "Numero Corrente",
                navArchivalVolumes: "Volumi Archivio", navEditorialEthics: "Linee Guida & Etica",
                navNewsEvents: "Notizie & Eventi", adminLoginButton: "Accesso Admin", logoutButton: "Esci",
                searchPlaceholder: "Cerca...", sortYearNewest: "Anno (Pi Recente)", sortYearOldest: "Anno (Meno Recente)",
                sortTitleAZ: "Titolo (A-Z)", sortTitleZA: "Titolo (Z-A)", sortAuthorAZ: "Autore (A-Z)",
                sortAuthorZA: "Autore (Z-A)", loadingPublications: "Caricamento...", noPubsFound: "Nessuna pubblicazione.",
                noSearchResults: "Nessun risultato.", viewDetailsButton: "Dettagli", confirmDelete: "Conferma Eliminazione",
                confirmDeleteMsg: "Sei sicuro? I file saranno rimossi.", successMessage: "Successo", errorMessage: "Errore",
                permissionDenied: "Permesso Negato", loadingMessage: "Caricamento...", unavailable: "Non Disponibile",
                isbnLabel: "ISBN:", issnLabel: "ISSN:", downloadFullPdfBtn: "PDF Completo",
                downloadArabicAbstractPdfBtn: "Abstract Arabo (PDF)", downloadEnglishAbstractPdfBtn: "Abstract Inglese (PDF)",
                downloadItalianAbstractPdfBtn: "Abstract Italiano (PDF)", arabicAbstractTextLabel: "Abstract Arabo:",
                englishAbstractTextLabel: "Abstract Inglese:", italianAbstractTextLabel: "Abstract Italiano:",
                noDescription: "Nessuna descrizione.", pubDetailsNotFound: "Dettagli pub non trovati.", fullPdfUnavailable: "PDF completo non disp.",
                arabicAbstractPdfUnavailable: "PDF Arabo non disp.", englishAbstractPdfUnavailable: "PDF Inglese non disp.",
                italianAbstractPdfUnavailable: "PDF Italiano non disp.",
                aboutUsHeading: "Chi Siamo QAL",
                aboutUsPara1: "Benvenuti in <strong>Quaderni di Archeologia della Libya</strong>, una rivista dedicata alla ricerca archeologica in Libia. Iniziata nel 1950, documenta le missioni archeologiche italiane, promuovendo la comprensione della storia antica.",
                aboutUsPara2: "Dopo una breve pausa, la rivista ha ripreso nel 2018, ristabilendosi come piattaforma scientifica. Offriamo un luogo essenziale per gli studiosi di archeologia e storia della Libia e del Maghreb.",
                aboutUsPara3: "I nostri volumi adottano un approccio multidisciplinare, con articoli su epigrafia, storia e studi territoriali. I contributi sono in lingue europee, con abstract in inglese e arabo, per lo scambio internazionale.",
                aboutUsPara4: "Questo sito  gestito da L'Erma di Bretschneider, una rinomata casa editrice. Ci impegniamo a mantenere elevati standard accademici e a diffondere globalmente la ricerca QAL.",
                currentPublicationsHeading: "Pubblicazioni Correnti", editorialBoardHeading: "Comitato Editoriale",
                editorialBoardIntro: "La nostra rivista  guidata da illustri studiosi. La loro competenza garantisce alta qualit e rigore.",
                editorInChief: "Capo Redattore", associateEditor: "Associato Redattore", editorialBoardMember: "Membro",
                editorialBoardComingSoon: "Lista completa e biografie in arrivo.", currentIssueHeading: "Numero Corrente",
                noCurrentIssue: "Nessun numero corrente impostato. Controlla presto!", archivalVolumesHeading: "Volumi di Archivio",
                archivalVolumesIntro: "Esplora la ricca storia della ricerca archeologica in Libia attraverso le nostre pubblicazioni passate. Sfoglia per anno o numero speciale qui sotto.",
                loadingArchivalVolumes: "Caricamento volumi di archivio...", editorialEthicsHeading: "Linee Guida Editoriali & Codice Etico",
                editorialGuidelinesTitle: "Linee Guida Editoriali", articlesSubmittedTo: "Articoli da inviare a:", submissionProcedureTitle: "Procedura di Sottomissione:",
                submissionProcedure1: "I contributi devono essere inviati in formato .doc (Microsoft Word) come allegato email.", submissionProcedure2: "I contenuti saranno esaminati da due revisori anonimi e restituiti per correzioni se necessario.",
                submissionProcedure3: "Un solo set di bozze sar inviato agli autori, che dovranno correggerle e restituirle entro la scadenza.", submissionProcedure4: "Un file con didascalie e crediti fotografici deve essere inviato separatamente. Le immagini digitali (JPG/TIFF, 300 dpi) devono accompagnare il testo (WeTransfer per file grandi).",
                submissionProcedure5: "Le immagini devono rispettare il copyright. L'autore  responsabile di ottenere i permessi. Nessuna immagine senza tali documenti sar pubblicata.",
                articleRequirementsTitle: "Requisiti Articolo:", articleRequirements1: "Abstract (ca. 100 parole) nella lingua del testo e in inglese.",
                articleRequirements2: "Titolo in inglese.", articleRequirements3: "5 Parole chiave (italiano/inglese).",
                articleRequirements4: "Note a pi di pagina.", articleRequirements5: "Indirizzo e email dell'autore.", articleRequirements6: "Affiliazione istituzionale.",
                formattingGuidelinesTitle: "Formattazione:", formattingGuidelines1: "Citazioni: \"...\"", formattingGuidelines2: "Enfasi: '...'",
                formattingGuidelines3: "Traslitterazioni (es. greco, arabo): corsivo.", formattingGuidelines4: "Caratteri speciali (es. greco): specificare il font.",
                formattingGuidelines5: "Fonti latine/greche: usare Thesaurus Linguae Latinae, Online Liddell-Scott-Jones, o G.W.H. LAMPE.",
                commonAbbreviationsTitle: "Abbreviazioni Comuni:", abbrCat: "cat. = catalogo", abbrCf: "cf. = confronta", abbrCm: "cm = centimetri",
                abbrCol: "col./coll. = colonna/colonne", abbrEAD: "EAD. = Eadem", abbrEtc: "ecc. = eccetera",
                abbrF: "f./ff. = seguente / seguenti", abbrFig: "fig./figg. = figura / figure", abbrFol: "fol. / foll. = foglio / fogli",
                abbrID: "ID. = Idem", abbrIID: "IID. = Iidem", abbrL: "l./ll. = linea / linee", abbrNoInv: "N. inv. = numero inventario",
                abbrM: "m = metri", abbrMs: "ms. / mss = manoscritto / manoscritti", abbrNo: "n. / nn. = numero / numeri",
                abbrNd: "s.d. = senza data", abbrNp: "s.l. = senza luogo", abbrNote: "nota = nota", abbrP: "p./pp. = pagina/pagine",
                abbrSee: "vedi = vedi", abbrSv: "s.v. = sub voce", abbrPl: "tav./tavv. = tavola / tavole", abbrVol: "vol. / voll. = volume / volumi",
                fullGuidelinesNote: "Sommario delle linee guida. Regole bibliografiche complete nel documento esteso.",
                ethicsStatementTitle: "Codice Etico", ethicsStatementPara1: "Questo documento delinea i principi etici de L'ERMA per le pubblicazioni, ispirati al COPE per garantire alti standard scientifici e accademici.",
                researchEthicsTitle: "I. Etica e integrit della ricerca", researchEthicsPara1: "Le pubblicazioni de L'ERMA aderiscono ai principi etici COPE: Affidabilit, onest, rispetto, responsabilit, cura, accuratezza, trasparenza e comunicazione aperta.",
                researchEthicsPara2: "Segnalare problemi etici a lerma@lerma.it. Le segnalazioni saranno gestite secondo le linee guida COPE e revisionate da editore/comitato editoriale.",
                lastUpdatedDate: "Ultimo aggiornamento 27 febbraio 2024",
                newsEventsHeading: "Notizie & Eventi", newsEventsIntro: "Rimani aggiornato con notizie, scoperte e annunci di Quaderni di Archeologia della Libya.",
                noNewsUpdates: "Nessuna notizia.", adminLoginHeading: "Accesso Admin", emailLabel: "Email:", passwordLabel: "Password:",
                loginButton: "Accedi", adminDashboardHeading: "Pannello Amministrazione", welcomeAdmin: "Benvenuto,",
                managePublicationsBtn: "Gestisci Pubblicazioni", manageNewsBtn: "Gestisci Notizie", manageSiteSettingsBtn: "Impostazioni Sito",
                addPublicationTitle: "Aggiungi Pubblicazione", titleLabel: "Titolo:", authorsLabel: "Autori (separati da virgola):",
                publicationYearLabel: "Anno:", descriptionLabel: "Descrizione:", coverImageLabel: "Immagine Copertina (Opzionale):",
                fullBookPdfLabel: "PDF Completo (Prime 20 Pagine):", arabicAbstractPdfLabel: "Abstract Arabo (PDF):",
                englishAbstractPdfLabel: "Abstract Inglese (PDF):", italianAbstractPdfLabel: "Abstract Italiano (PDF):",
                setCurrentIssueLabel: "Imposta come Numero Corrente", addPublicationButton: "Aggiungi Pub", updatePublicationButton: "Aggiorna Pub",
                cancelEditButton: "Annulla Modifica", managePublicationsHeading: "Gestisci Pubblicazioni", tableHeaderTitle: "Titolo",
                tableHeaderAuthors: "Autori", tableHeaderYear: "Anno", tableHeaderActions: "Azioni",
                noPublicationsToManage: "Nessuna pub da gestire.", addNewsItemTitle: "Aggiungi Notizia", newsTitleLabel: "Titolo Notizia:",
                newsDescriptionLabel: "Descrizione Notizia:", newsImageLabel: "Immagine Notizia (Opzionale):",
                addNewsItemButton: "Aggiungi Notizia", updateNewsItemButton: "Aggiorna Notizia", manageNewsHeading: "Gestisci Notizie",
                tableHeaderDate: "Data", noNewsToManage: "Nessun elemento da gestire.", manageSiteLogosHeading: "Gestisci Loghi",
                headerLogoUploadLabel: "Logo Intestazione:", footerLogoUploadLabel: "Logo Pi di Pagina:", updateLogosButton: "Aggiorna Loghi",
                manageContributorLogosHeading: "Gestisci Loghi Contributori", contributor1LogoLabel: "Logo L'ERMA:",
                contributor2LogoLabel: "Logo Fondazione MEDA:", updateContributorLogosButton: "Aggiorna Loghi Contributori",
                copyrightText: "QAL. Tutti i diritti riservati.", contactUsLabel: "Contattaci:", emailLabelShort: "Email:",
                phoneLabelShort: "Telefono:", selectedLabel: "Selezionato", currentLabel: "Attuale", currentLabelShort: "Corrente",
                noCustomHeaderLogo: "Nessun logo intestazione personalizzato.", noCustomFooterLogo: "Nessun logo pi di pagina personalizzato.",
                noLERMALogo: "Nessun logo L'ERMA.", noMEDALogo: "Nessun logo MEDA.", fileUploadFailed: "Caricamento file fallito: ",
                checkStorageRules: "Controlla le regole di Firebase Storage.", fileNotFoundInStorage: "File non trovato in storage: ",
                fileDeletionFailed: "Eliminazione file fallita: ", siteLogosNotFound: "Loghi sito non trovati nel DB. Uso predefiniti.",
                couldNotLoadLogos: "Impossibile caricare i loghi del sito.", siteLogosUpdated: "Loghi sito aggiornati.",
                errorUpdatingLogos: "Errore aggiornamento loghi sito: ", contributorLogosUpdated: "Loghi contributori aggiornati.",
                errorUpdatingContributorLogos: "Errore aggiornamento loghi contributori: ", errorLoadingPublications: "Errore caricamento pubblicazioni.",
                checkFirebaseRules: "Controlla le regole di Firebase.", errorLoadingCurrentIssue: "Errore caricamento numero corrente.",
                errorLoadingNews: "Errore caricamento notizie.", adminLoginSuccessful: "Accesso admin riuscito!",
                logoutSuccessful: "Logout riuscito!", logoutFailed: "Logout fallito: ", invalidCredentials: "Credenziali non valide.",
                tooManyLoginAttempts: "Troppi tentativi di accesso. Riprova pi tardi.", errorLoadingAdminPublications: "Errore caricamento pubblicazioni admin.",
                noPermissionAddEditPublications: "Non hai il permesso di aggiungere/modificare pubblicazioni.",
                fillAllRequiredFields: "Compila tutti i campi obbligatori.", errorSavingPublication: "Errore salvataggio pubblicazione",
                publicationUpdated: "Pubblicazione aggiornata.", publicationAdded: "Pubblicazione aggiunta.",
                publicationNotFoundForEdit: "Pubblicazione non trovata per modifica.", errorLoadingPublicationForEdit: "Errore caricamento pubblicazione per modifica",
                publicationNotFoundForDeletion: "Pubblicazione non trovata per eliminazione.", errorDeletingPublication: "Errore eliminazione pubblicazione",
                noPermissionAddNews: "Non hai il permesso di aggiungere notizie.", newsItemUpdated: "Notizia aggiornata.",
                newsItemAdded: "Notizia aggiunta.", errorSavingNewsItem: "Errore salvataggio notizia",
                newsItemNotFoundForEdit: "Notizia non trovata per modifica.", errorLoadingNewsItemForEdit: "Errore caricamento notizia per modifica",
                newsItemNotFoundForDeletion: "Notizia non trovata per eliminazione.", errorDeletingNewsItem: "Errore eliminazione notizia",
                errorLoadingAdminNews: "Errore caricamento notizie admin.", noPermissionUpdateSiteSettings: "Non hai il permesso di aggiornare le impostazioni del sito.",
                yesButton: "S", noButton: "No", okButton: "OK", editButton: "Modifica", deleteButton: "Elimina",
                noArabicAbstract: "Nessun testo abstract arabo.", noEnglishAbstract: "Nessun testo abstract inglese.", noItalianAbstract: "Nessun testo abstract italiano."
            }
        };

        // Function to apply translations
        function applyTranslations(lang) {
            const elements = document.querySelectorAll('[data-lang-key]');
            elements.forEach(element => {
                const key = element.dataset.langKey;
                if (translations[lang] && translations[lang][key]) {
                    if (element.tagName === 'INPUT' && element.hasAttribute('placeholder')) {
                        element.placeholder = translations[lang][key];
                    } else if (element.tagName === 'OPTION') {
                        element.textContent = translations[lang][key];
                    } else {
                        element.innerHTML = translations[lang][key];
                    }
                }
            });
            document.querySelectorAll('.lang-button').forEach(button => {
                if (button.dataset.lang === lang) {
                    button.classList.add('active');
                } else {
                    button.classList.remove('active');
                }
            });
            currentLanguage = lang;
            localStorage.setItem('siteLanguage', lang);
        }

        // Initialize Firebase App and Authentication
        async function initializeFirebase() {
            try {
                app = initializeApp(firebaseConfig);
                db = getFirestore(app);
                auth = getAuth(app);
                storage = getStorage(app);

                if (initialAuthToken) {
                    await signInWithCustomToken(auth, initialAuthToken);
                } else {
                    await signInAnonymously(auth);
                }

                onAuthStateChanged(auth, (user) => {
                    if (user) {
                        userId = user.uid;
                        document.getElementById('loggedInUserEmail').textContent = user.email || 'Anonymous User';
                    } else {
                        userId = null;
                        document.getElementById('loggedInUserEmail').textContent = '';
                        if (currentView === 'adminDashboard') {
                            showView('aboutUs');
                        }
                    }
                    updateAuthUI();
                    if (db && auth.currentUser) {
                        setupListeners();
                    } else if (db) {
                        listenForPublicPublications();
                        listenForCurrentIssue();
                        listenForNews();
                        listenForSiteLogos();
                    }
                });
            } catch (error) {
                console.error("Firebase init error:", error);
                showMessageModal(translations[currentLanguage].errorMessage, translations[currentLanguage].firebaseInitError, "error");
            }
        }

        // --- UI State Management & View Switching ---
        let currentView = 'aboutUs';

        const views = {
            aboutUs: document.getElementById('aboutUsView'), editorialBoard: document.getElementById('editorialBoardView'),
            currentIssue: document.getElementById('currentIssueView'), archivalVolumes: document.getElementById('archivalVolumesView'),
            editorialAndEthics: document.getElementById('editorialAndEthicsView'), newsEvents: document.getElementById('newsEventsView'),
            adminLogin: document.getElementById('adminLoginView'), adminDashboard: document.getElementById('adminDashboardView')
        };

        function showView(viewId) {
            Object.values(views).forEach(view => view.classList.add('hidden'));
            const targetView = views[viewId];
            if (targetView) {
                targetView.classList.remove('hidden');
                currentView = viewId;

                document.body.classList.toggle('admin-bg', viewId === 'adminLogin' || viewId === 'adminDashboard');

                if (viewId === 'currentIssue') listenForCurrentIssue();
                else if (viewId === 'archivalVolumes') listenForPublicPublications();
                else if (viewId === 'newsEvents') listenForNews();
                else if (viewId === 'aboutUs') listenForPublicPublications();

                if (viewId === 'adminDashboard') {
                    document.getElementById('adminManagePublications').classList.remove('hidden');
                    document.getElementById('adminManageNews').classList.add('hidden');
                    document.getElementById('adminManageSiteSettings').classList.add('hidden');
                    resetAddPublicationForm();
                    listenForAdminPublications();
                }
            } else {
                console.warn("View not found:", viewId);
                showMessageModal(translations[currentLanguage].errorMessage, translations[currentLanguage].viewNotFound, "error");
            }
        }

        // --- Event Listeners for Navigation ---
        document.querySelectorAll('.view-button').forEach(btn => btn.addEventListener('click', e => showView(e.target.dataset.view)));
        document.querySelectorAll('.lang-button').forEach(btn => btn.addEventListener('click', e => applyTranslations(e.target.dataset.lang)));
        document.getElementById('adminLoginBtnFooter').addEventListener('click', () => showView('adminLogin'));
        document.getElementById('adminLogoutBtn').addEventListener('click', async () => {
            try { await signOut(auth); showMessageModal(translations[currentLanguage].successMessage, translations[currentLanguage].logoutSuccessful, "success"); showView('aboutUs'); }
            catch (error) { console.error("Logout error:", error); showMessageModal(translations[currentLanguage].errorMessage, translations[currentLanguage].logoutFailed + error.message, "error"); }
        });

        // Admin Dashboard Sub-navigation
        document.getElementById('managePublicationsBtn').addEventListener('click', () => {
            document.getElementById('adminManagePublications').classList.remove('hidden');
            document.getElementById('adminManageNews').classList.add('hidden');
            document.getElementById('adminManageSiteSettings').classList.add('hidden');
            resetAddPublicationForm();
            listenForAdminPublications();
        });
        document.getElementById('manageNewsBtn').addEventListener('click', () => {
            document.getElementById('adminManagePublications').classList.add('hidden');
            document.getElementById('adminManageNews').classList.remove('hidden');
            document.getElementById('adminManageSiteSettings').classList.add('hidden');
            resetAddNewsItemForm();
            listenForAdminNews();
        });
        document.getElementById('manageSiteSettingsBtn').addEventListener('click', () => {
            document.getElementById('adminManagePublications').classList.add('hidden');
            document.getElementById('adminManageNews').classList.add('hidden');
            document.getElementById('adminManageSiteSettings').classList.remove('hidden');
            loadSiteLogosForAdmin();
        });

        function updateAuthUI() {
            const user = auth.currentUser;
            const isAdmin = user && user.email === 'admin@example.com';
            document.getElementById('adminLoginBtnFooter').classList.toggle('hidden', isAdmin);
            document.getElementById('adminLogoutBtn').classList.toggle('hidden', !isAdmin);
            if (isAdmin && currentView === 'adminLogin') showView('adminDashboard');
            else if (!isAdmin && currentView === 'adminDashboard') showView('aboutUs');
        }

        // --- Admin Login Form Handling ---
        document.getElementById('adminLoginForm').addEventListener('submit', async e => {
            e.preventDefault(); showLoadingSpinner();
            const email = document.getElementById('adminEmail').value;
            const password = document.getElementById('adminPassword').value;
            const loginErrorMessage = document.getElementById('loginErrorMessage');
            loginErrorMessage.textContent = '';
            try { await signInWithEmailAndPassword(auth, email, password); showMessageModal(translations[currentLanguage].successMessage, translations[currentLanguage].adminLoginSuccessful, "success");
                document.getElementById('adminEmail').value = ''; document.getElementById('adminPassword').value = '';
            } catch (error) {
                console.error("Admin login error:", error);
                loginErrorMessage.textContent = translations[currentLanguage][error.code === 'auth/user-not-found' || error.code === 'auth/wrong-password' || error.code === 'auth/invalid-credential' ? 'invalidCredentials' : (error.code === 'auth/too-many-requests' ? 'tooManyLoginAttempts' : 'loginFailed')] + (error.code.startsWith('auth/') ? '' : error.message);
            } finally { hideLoadingSpinner(); }
        });

        // --- Firebase Firestore and Storage Operations ---
        function setupListeners() {
            if (!db || !auth.currentUser) { console.warn("Firestore or user not ready for listeners."); return; }
            listenForPublicPublications(); listenForCurrentIssue(); listenForNews(); listenForSiteLogos();
            if (auth.currentUser.email === 'admin@example.com') { listenForAdminPublications(); listenForAdminNews(); }
            else {
                document.getElementById('adminPublicationsList').innerHTML = `<tr class="admin-table-row"><td colspan="4" class="px-6 py-4 whitespace-nowrap text-sm text-gray-600">${translations[currentLanguage].noPublicationsToManage}</td></tr>`;
                document.getElementById('adminNewsList').innerHTML = `<tr class="admin-table-row"><td colspan="3" class="px-6 py-4 whitespace-nowrap text-sm text-gray-600">${translations[currentLanguage].noNewsToManage}</td></tr>`;
            }
        }

        function getOriginalFileNameFromUnique(uniqueFileName) {
            if (!uniqueFileName) return '';
            const parts = uniqueFileName.split('_');
            return parts.length > 1 && !isNaN(Number(parts[0])) ? parts.slice(1).join('_') : uniqueFileName;
        }

        async function uploadFile(file, path) {
            if (!file) return { url: '', fileName: '' };
            const uniqueFileName = `${Date.now()}_${file.name}`;
            const storageRef = ref(storage, `${path}/${uniqueFileName}`);
            try {
                const snapshot = await uploadBytes(storageRef, file);
                const downloadURL = await getDownloadURL(snapshot.ref);
                return { url: downloadURL, fileName: uniqueFileName };
            } catch (error) {
                console.error("Error uploading file:", file.name, "to path:", path, error);
                throw new Error(translations[currentLanguage].fileUploadFailed + file.name + ". " + translations[currentLanguage].checkStorageRules);
            }
        }

        async function deleteFile(uniqueFileName, path) {
            if (!uniqueFileName) return;
            try { await deleteObject(ref(storage, `${path}/${uniqueFileName}`)); console.log("Deleted file:", uniqueFileName); }
            catch (error) { if (error.code === 'storage/object-not-found') console.warn("File not found:", uniqueFileName); else console.error("File deletion failed:", uniqueFileName, error); }
        }

        // --- Site Logo Management ---
        function listenForSiteLogos() {
            onSnapshot(doc(db, PUBLIC_SETTINGS_COLLECTION, SITE_SETTINGS_DOC_ID), docSnap => {
                const data = docSnap.exists() ? docSnap.data() : {};
                currentHeaderLogo = { url: data.headerLogoUrl || DEFAULT_HEADER_LOGO_URL, fileName: data.headerLogoFileName || '' };
                currentFooterLogo = { url: data.footerLogoUrl || DEFAULT_FOOTER_LOGO_URL, fileName: data.footerLogoFileName || '' };
                currentContributor1Logo = { url: data.contributor1LogoUrl || DEFAULT_CONTRIB1_LOGO_URL, fileName: data.contributor1LogoFileName || '' };
                currentContributor2Logo = { url: data.contributor2LogoUrl || DEFAULT_CONTRIB2_LOGO_URL, fileName: data.contributor2LogoFileName || '' };
                updateSiteLogosUI();
            }, error => {
                console.error("Error listening for site logos:", error);
                currentHeaderLogo = { url: DEFAULT_HEADER_LOGO_URL, fileName: '' };
                currentFooterLogo = { url: DEFAULT_FOOTER_LOGO_URL, fileName: '' };
                currentContributor1Logo = { url: DEFAULT_CONTRIB1_LOGO_URL, fileName: '' };
                currentContributor2Logo = { url: DEFAULT_CONTRIB2_LOGO_URL, fileName: '' };
                updateSiteLogosUI();
                showMessageModal(translations[currentLanguage].errorMessage, translations[currentLanguage].couldNotLoadLogos, "error");
            });
        }

        function updateSiteLogosUI() {
            document.getElementById('mainLogo').src = currentHeaderLogo.url;
            document.getElementById('footerLogo').src = currentFooterLogo.url;
            document.getElementById('contributor1Logo').src = currentContributor1Logo.url;
            document.getElementById('contributor2Logo').src = currentContributor2Logo.url;

            const adminPreviews = {
                header: { img: document.getElementById('headerLogoPreview'), text: document.getElementById('headerLogoFileNameDisplayAdmin'), current: currentHeaderLogo, defaultUrl: DEFAULT_HEADER_LOGO_URL, noMsg: 'noCustomHeaderLogo' },
                footer: { img: document.getElementById('footerLogoPreview'), text: document.getElementById('footerLogoFileNameDisplayAdmin'), current: currentFooterLogo, defaultUrl: DEFAULT_FOOTER_LOGO_URL, noMsg: 'noCustomFooterLogo' },
                contributor1: { img: document.getElementById('contributor1LogoPreview'), text: document.getElementById('contributor1FileNameDisplayAdmin'), current: currentContributor1Logo, defaultUrl: DEFAULT_CONTRIB1_LOGO_URL, noMsg: 'noLERMALogo' },
                contributor2: { img: document.getElementById('contributor2LogoPreview'), text: document.getElementById('contributor2FileNameDisplayAdmin'), current: currentContributor2Logo, defaultUrl: DEFAULT_CONTRIB2_LOGO_URL, noMsg: 'noMEDALogo' }
            };

            for (const key in adminPreviews) {
                if (adminPreviews[key].img) {
                    const { img, text, current, defaultUrl, noMsg } = adminPreviews[key];
                    img.src = current.url;
                    img.style.display = current.url && current.url !== defaultUrl ? 'block' : 'none';
                    text.textContent = current.fileName ? `${translations[currentLanguage].currentLabel}: ${getOriginalFileNameFromUnique(current.fileName)}` : translations[currentLanguage][noMsg];
                }
            }
        }

        function loadSiteLogosForAdmin() { updateSiteLogosUI(); }

        const logoInputs = {
            header: { input: document.getElementById('headerLogoUpload'), img: document.getElementById('headerLogoPreview'), text: document.getElementById('headerLogoFileNameDisplayAdmin'), currentLogo: currentHeaderLogo, defaultUrl: DEFAULT_HEADER_LOGO_URL, type: 'header' },
            footer: { input: document.getElementById('footerLogoUpload'), img: document.getElementById('footerLogoPreview'), text: document.getElementById('footerLogoFileNameDisplayAdmin'), currentLogo: currentFooterLogo, defaultUrl: DEFAULT_FOOTER_LOGO_URL, type: 'footer' },
            contributor1: { input: document.getElementById('contributor1LogoUpload'), img: document.getElementById('contributor1LogoPreview'), text: document.getElementById('contributor1FileNameDisplayAdmin'), currentLogo: currentContributor1Logo, defaultUrl: DEFAULT_CONTRIB1_LOGO_URL, type: 'contributor1' },
            contributor2: { input: document.getElementById('contributor2LogoUpload'), img: document.getElementById('contributor2LogoPreview'), text: document.getElementById('contributor2FileNameDisplayAdmin'), currentLogo: currentContributor2Logo, defaultUrl: DEFAULT_CONTRIB2_LOGO_URL, type: 'contributor2' }
        };

        for (const key in logoInputs) {
            const { input, img, text, currentLogo, defaultUrl, type } = logoInputs[key];
            input.addEventListener('change', e => {
                if (e.target.files.length > 0) {
                    const file = e.target.files[0];
                    text.textContent = `${translations[currentLanguage].selectedLabel}: ${file.name}`;
                    const reader = new FileReader();
                    reader.onload = event => { img.src = event.target.result; img.style.display = 'block'; };
                    reader.readAsDataURL(file);
                } else {
                    text.textContent = currentLogo.fileName ? `${translations[currentLanguage].currentLabel}: ${getOriginalFileNameFromUnique(currentLogo.fileName)}` : translations[currentLanguage][`noCustom${type.charAt(0).toUpperCase() + type.slice(1)}Logo`];
                    img.src = currentLogo.url;
                    img.style.display = currentLogo.url && !currentLogo.url.includes("placehold.co") ? 'block' : 'none';
                }
            });
        }

        document.getElementById('logoUploadForm').addEventListener('submit', async e => {
            e.preventDefault(); showLoadingSpinner();
            const user = auth.currentUser; if (!user || user.email !== 'admin@example.com') { showMessageModal(translations[currentLanguage].permissionDenied, translations[currentLanguage].noPermissionUpdateSiteSettings, "error"); hideLoadingSpinner(); return; }

            const headerFile = document.getElementById('headerLogoUpload').files[0];
            const footerFile = document.getElementById('footerLogoUpload').files[0];
            let newHeaderLogo = { ...currentHeaderLogo }, newFooterLogo = { ...currentFooterLogo };

            try {
                if (headerFile) { if (currentHeaderLogo.fileName && currentHeaderLogo.url !== DEFAULT_HEADER_LOGO_URL) await deleteFile(currentHeaderLogo.fileName, STORAGE_PATH_LOGOS); newHeaderLogo = await uploadFile(headerFile, STORAGE_PATH_LOGOS); }
                if (footerFile) { if (currentFooterLogo.fileName && currentFooterLogo.url !== DEFAULT_FOOTER_LOGO_URL) await deleteFile(currentFooterLogo.fileName, STORAGE_PATH_LOGOS); newFooterLogo = await uploadFile(footerFile, STORAGE_PATH_LOGOS); }

                await setDoc(doc(db, PUBLIC_SETTINGS_COLLECTION, SITE_SETTINGS_DOC_ID), {
                    headerLogoUrl: newHeaderLogo.url, headerLogoFileName: newHeaderLogo.fileName,
                    footerLogoUrl: newFooterLogo.url, footerLogoFileName: newFooterLogo.fileName,
                    updatedAt: new Date().toISOString()
                }, { merge: true });
                showMessageModal(translations[currentLanguage].successMessage, translations[currentLanguage].siteLogosUpdated, "success");
                currentHeaderLogo = newHeaderLogo; currentFooterLogo = newFooterLogo; updateSiteLogosUI();
                document.getElementById('headerLogoUpload').value = ''; document.getElementById('footerLogoUpload').value = '';
            } catch (error) { console.error("Error updating site logos:", error); showMessageModal(translations[currentLanguage].errorMessage, translations[currentLanguage].errorUpdatingLogos + error.message, "error"); }
            finally { hideLoadingSpinner(); }
        });

        document.getElementById('contributorLogoUploadForm').addEventListener('submit', async e => {
            e.preventDefault(); showLoadingSpinner();
            const user = auth.currentUser; if (!user || user.email !== 'admin@example.com') { showMessageModal(translations[currentLanguage].permissionDenied, translations[currentLanguage].noPermissionUpdateSiteSettings, "error"); hideLoadingSpinner(); return; }

            const c1File = document.getElementById('contributor1LogoUpload').files[0];
            const c2File = document.getElementById('contributor2LogoUpload').files[0];
            let newC1Logo = { ...currentContributor1Logo }, newC2Logo = { ...currentContributor2Logo };

            try {
                if (c1File) { if (currentContributor1Logo.fileName && currentContributor1Logo.url !== DEFAULT_CONTRIB1_LOGO_URL) await deleteFile(currentContributor1Logo.fileName, STORAGE_PATH_LOGOS); newC1Logo = await uploadFile(c1File, STORAGE_PATH_LOGOS); }
                if (c2File) { if (currentContributor2Logo.fileName && currentContributor2Logo.url !== DEFAULT_CONTRIB2_LOGO_URL) await deleteFile(currentContributor2Logo.fileName, STORAGE_PATH_LOGOS); newC2Logo = await uploadFile(c2File, STORAGE_PATH_LOGOS); }

                await setDoc(doc(db, PUBLIC_SETTINGS_COLLECTION, SITE_SETTINGS_DOC_ID), {
                    contributor1LogoUrl: newC1Logo.url, contributor1LogoFileName: newC1Logo.fileName,
                    contributor2LogoUrl: newC2Logo.url, contributor2LogoFileName: newC2Logo.fileName,
                    updatedAt: new Date().toISOString()
                }, { merge: true });
                showMessageModal(translations[currentLanguage].successMessage, translations[currentLanguage].contributorLogosUpdated, "success");
                currentContributor1Logo = newC1Logo; currentContributor2Logo = newC2Logo; updateSiteLogosUI();
                document.getElementById('contributor1LogoUpload').value = ''; document.getElementById('contributor2LogoUpload').value = '';
            } catch (error) { console.error("Error updating contributor logos:", error); showMessageModal(translations[currentLanguage].errorMessage, translations[currentLanguage].errorUpdatingContributorLogos + error.message, "error"); }
            finally { hideLoadingSpinner(); }
        });

        function listenForPublicPublications() {
            onSnapshot(query(collection(db, PUBLIC_PUB_COLLECTION), orderBy("year", "desc")), snapshot => {
                const pubs = snapshot.docs.map(doc => ({ id: doc.id, ...doc.data() }));
                displayPublications(pubs);
            }, error => {
                console.error("Error listening to public pubs:", error);
                showMessageModal(translations[currentLanguage].errorMessage, translations[currentLanguage].errorLoadingPublications + ". " + translations[currentLanguage].checkFirebaseRules, "error");
            });
        }

        function listenForCurrentIssue() {
            onSnapshot(query(collection(db, PUBLIC_PUB_COLLECTION), where("isCurrentIssue", "==", true)), snapshot => {
                const currentIssueContentDiv = document.getElementById('currentIssueContent');
                const currentIssuePublicationCard = document.getElementById('currentIssuePublicationCard');
                if (!snapshot.empty) {
                    const book = snapshot.docs[0].data();
                    currentIssueContentDiv.querySelector('p:not([id])').classList.add('hidden');
                    currentIssuePublicationCard.classList.remove('hidden');
                    document.getElementById('currentIssueCover').src = book.coverImageUrl || 'https://placehold.co/400x600/e0e2e5/3f4245?text=No+Image';
                    document.getElementById('currentIssueTitle').textContent = book.title;
                    document.getElementById('currentIssueAuthors').textContent = book.authors;
                    document.getElementById('currentIssueYear').textContent = book.year;
                    document.getElementById('currentIssueDescription').textContent = book.description;
                    
                    const updateDownloadBtn = (btnId, url) => {
                        const btn = document.getElementById(btnId);
                        btn.href = url || '#';
                        btn.classList.toggle('disabled', !url);
                        btn.onclick = url ? null : e => { e.preventDefault(); showMessageModal(translations[currentLanguage].unavailable, translations[currentLanguage][`${btnId.replace('currentIssueDownload', '').replace('Btn', '')}Unavailable`], "alert"); };
                    };
                    updateDownloadBtn('currentIssueDownloadPdfBtn', book.pdfUrl);
                    updateDownloadBtn('currentIssueDownloadAbstractArBtn', book.abstracts?.ar?.url);
                    updateDownloadBtn('currentIssueDownloadAbstractEnBtn', book.abstracts?.en?.url);
                    updateDownloadBtn('currentIssueDownloadAbstractItBtn', book.abstracts?.it?.url);
                } else {
                    currentIssueContentDiv.querySelector('p:not([id])').classList.remove('hidden');
                    currentIssuePublicationCard.classList.add('hidden');
                }
            }, error => {
                console.error("Error listening to current issue:", error);
                showMessageModal(translations[currentLanguage].errorMessage, translations[currentLanguage].errorLoadingCurrentIssue, "error");
            });
        }

        function listenForNews() {
            onSnapshot(query(collection(db, PUBLIC_NEWS_COLLECTION), orderBy("timestamp", "desc")), snapshot => {
                const newsFeedDiv = document.getElementById('newsFeed');
                newsFeedDiv.innerHTML = '';
                if (snapshot.empty) { newsFeedDiv.innerHTML = `<p class="col-span-full text-center text-gray-400">${translations[currentLanguage].noNewsUpdates}</p>`; return; }
                snapshot.forEach(doc => {
                    const news = { id: doc.id, ...doc.data() };
                    newsFeedDiv.innerHTML += `
                        <div class="bg-gray-100 p-6 rounded-lg shadow-md border border-gray-200">
                            ${news.imageUrl ? `<img src="${news.imageUrl}" alt="${news.title}" class="w-full h-48 object-cover rounded-md mb-4 shadow-sm" onerror="this.onerror=null;this.src='https://placehold.co/400x200/cccccc/333333?text=No+Image';">` : ''}
                            <h3 class="text-xl font-bold mb-2 text-gray-800">${news.title}</h3>
                            <p class="text-gray-700 text-sm mb-3">${new Date(news.timestamp).toLocaleDateString(currentLanguage === 'it' ? 'it-IT' : 'en-US')}</p>
                            <p class="text-gray-700 text-base">${news.description}</p>
                        </div>`;
                });
            }, error => {
                console.error("Error listening to news:", error);
                showMessageModal(translations[currentLanguage].errorMessage, translations[currentLanguage].errorLoadingNews, "error");
            });
        }

        function displayPublications(publications) {
            const pubsListDiv = document.getElementById('publicationsList'); pubsListDiv.innerHTML = '';
            if (!pubs || pubs.length === 0) { pubsListDiv.innerHTML = `<p class="col-span-full text-center text-gray-400">${translations[currentLanguage].noPubsFound}</p>`; return; }
            
            const searchTerm = document.getElementById('publicationSearch').value.toLowerCase();
            const sortBy = document.getElementById('sortPublications').value;

            let filteredPubs = pubs.filter(pub => {
                const searchFields = [pub.title, pub.authors, String(pub.year), pub.description, pub.isbn, pub.issn,
                                      pub.abstracts?.ar?.text, pub.abstracts?.en?.text, pub.abstracts?.it?.text].map(s => (s || '').toLowerCase());
                return searchFields.some(field => field.includes(searchTerm));
            });

            if (sortBy === 'year-desc') filteredPubs.sort((a, b) => b.year - a.year);
            else if (sortBy === 'year-asc') filteredPubs.sort((a, b) => a.year - b.year);
            else if (sortBy === 'title-asc') filteredPubs.sort((a, b) => a.title.localeCompare(b.title));
            else if (sortBy === 'title-desc') filteredPubs.sort((a, b) => b.title.localeCompare(a.title));
            else if (sortBy === 'author-asc') filteredPubs.sort((a, b) => a.authors.localeCompare(b.authors));
            else if (sortBy === 'author-desc') filteredPubs.sort((a, b) => b.authors.localeCompare(a.authors));

            if (filteredPubs.length === 0) { pubsListDiv.innerHTML = `<p class="col-span-full text-center text-gray-400">${translations[currentLanguage].noSearchResults}</p>`; return; }

            filteredPubs.forEach(book => {
                const card = document.createElement('div'); card.className = 'publication-card p-4 flex flex-col items-center text-center';
                card.innerHTML = `
                    <img src="${book.coverImageUrl || 'https://placehold.co/400x600/e0e2e5/3f4245?text=No+Image'}" alt="${book.title} Cover" class="cover-image rounded-md mb-4">
                    <h3 class="text-xl font-bold mb-2 text-gray-800">${book.title}</h3>
                    <p class="text-gray-700 mb-1">${book.authors}</p>
                    <p class="text-gray-600 text-sm font-medium">${book.year}</p>
                    <p class="text-gray-700 text-sm mt-2 flex-grow overflow-hidden line-clamp-3">${book.description || translations[currentLanguage].noDescription}</p>
                    <button class="nav-button text-sm mt-4 view-publication-details" data-id="${book.id}">${translations[currentLanguage].viewDetailsButton}</button>`;
                pubsListDiv.appendChild(card);
            });
            pubsListDiv.querySelectorAll('.view-publication-details').forEach(btn => btn.addEventListener('click', async e => {
                const bookId = e.target.dataset.id;
                const docSnap = await getDoc(doc(db, PUBLIC_PUB_COLLECTION, bookId));
                if (docSnap.exists()) showPublicationDetailsModal(docSnap.data());
                else showMessageModal(translations[currentLanguage].errorMessage, translations[currentLanguage].pubDetailsNotFound, "error");
            }));
        }

        document.getElementById('publicationSearch').addEventListener('input', () => listenForPublicPublications());
        document.getElementById('sortPublications').addEventListener('change', () => listenForPublicPublications());

        function listenForAdminPublications() {
            onSnapshot(query(collection(db, PUBLIC_PUB_COLLECTION), orderBy("timestamp", "desc")), snapshot => {
                const adminPubListBody = document.getElementById('adminPublicationsList'); adminPubListBody.innerHTML = '';
                if (snapshot.empty) { adminPubListBody.innerHTML = `<tr class="admin-table-row"><td colspan="4" class="px-6 py-4 text-sm text-gray-600">${translations[currentLanguage].noPublicationsToManage}</td></tr>`; return; }
                snapshot.forEach(doc => {
                    const book = { id: doc.id, ...doc.data() };
                    const row = adminPubListBody.insertRow(); row.className = 'admin-table-row';
                    const isCurrentIssueIndicator = book.isCurrentIssue ? `<span class="ml-2 px-2 py-1 bg-blue-400 text-white text-xs font-semibold rounded-full">${translations[currentLanguage].currentLabelShort}</span>` : '';
                    row.innerHTML = `
                        <td class="px-6 py-4 text-sm font-medium text-gray-800">${book.title}${isCurrentIssueIndicator}</td>
                        <td class="px-6 py-4 text-sm text-gray-700">${book.authors}</td>
                        <td class="px-6 py-4 text-sm text-gray-600">${book.year}</td>
                        <td class="px-6 py-4 text-right text-sm flex space-x-2">
                            <button class="text-blue-600 hover:text-blue-800 edit-publication-button admin-button" data-id="${book.id}">${translations[currentLanguage].editButton}</button>
                            <button class="text-red-600 hover:text-red-800 delete-publication-button admin-button" data-id="${book.id}">${translations[currentLanguage].deleteButton}</button>
                        </td>`;
                });
                document.querySelectorAll('.edit-publication-button').forEach(btn => btn.addEventListener('click', e => editPublication(e.target.dataset.id)));
                document.querySelectorAll('.delete-publication-button').forEach(btn => btn.addEventListener('click', e => confirmDeletePublication(e.target.dataset.id)));
            }, error => {
                console.error("Error listening to admin pubs:", error);
                showMessageModal(translations[currentLanguage].errorMessage, translations[currentLanguage].errorLoadingAdminPublications, "error");
            });
        }

        // Add/Update Publication Form Submit
        const bookTitleInput = document.getElementById('bookTitle'), bookAuthorsInput = document.getElementById('bookAuthors'),
            bookYearInput = document.getElementById('bookYear'), bookDescriptionInput = document.getElementById('bookDescription'),
            bookISBNInput = document.getElementById('bookISBN'), bookISSNInput = document.getElementById('bookISSN'),
            abstractArTextInput = document.getElementById('abstractArText'), abstractEnTextInput = document.getElementById('abstractEnText'),
            abstractItTextInput = document.getElementById('abstractItText'), bookIsCurrentIssueCheckbox = document.getElementById('bookIsCurrentIssue'),
            bookCoverInput = document.getElementById('bookCover'), bookPdfInput = document.getElementById('bookPdf'),
            abstractArPdfInput = document.getElementById('abstractArPdf'), abstractEnPdfInput = document.getElementById('abstractEnPdf'),
            abstractItPdfInput = document.getElementById('abstractItPdf'),
            adminFormTitle = document.getElementById('adminFormTitle'), submitPublicationBtn = document.getElementById('submitPublicationBtn'),
            cancelEditPublicationBtn = document.getElementById('cancelEditPublicationBtn'), uploadedCoverPreviewAdmin = document.getElementById('uploadedCoverPreviewAdmin'),
            coverImageFileNameDisplayAdmin = document.getElementById('coverImageFileNameDisplayAdmin'), pdfFileNameDisplayAdmin = document.getElementById('pdfFileNameDisplayAdmin'),
            abstractArPdfFileNameDisplayAdmin = document.getElementById('abstractArPdfFileNameDisplayAdmin'),
            abstractEnPdfFileNameDisplayAdmin = document.getElementById('abstractEnPdfFileNameDisplayAdmin'),
            abstractItPdfFileNameDisplayAdmin = document.getElementById('abstractItPdfFileNameDisplayAdmin');

        document.getElementById('addPublicationForm').addEventListener('submit', async e => {
            e.preventDefault(); showLoadingSpinner();
            const user = auth.currentUser; if (!user || user.email !== 'admin@example.com') { showMessageModal(translations[currentLanguage].permissionDenied, translations[currentLanguage].noPermissionAddEditPublications, "error"); hideLoadingSpinner(); return; }

            const data = {
                title: bookTitleInput.value.trim(), authors: bookAuthorsInput.value.trim(), year: parseInt(bookYearInput.value, 10),
                description: bookDescriptionInput.value.trim(), isbn: bookISBNInput.value.trim(), issn: bookISSNInput.value.trim(),
                abstracts: {
                    ar: { text: abstractArTextInput.value.trim(), url: currentPubFiles.abstracts.ar.url, fileName: currentPubFiles.abstracts.ar.fileName },
                    en: { text: abstractEnTextInput.value.trim(), url: currentPubFiles.abstracts.en.url, fileName: currentPubFiles.abstracts.en.fileName },
                    it: { text: abstractItTextInput.value.trim(), url: currentPubFiles.abstracts.it.url, fileName: currentPubFiles.abstracts.it.fileName }
                },
                coverImageUrl: currentPubFiles.coverUrl, coverImageFileName: currentPubFiles.coverFileName,
                pdfUrl: currentPubFiles.pdfUrl, pdfFileName: currentPubFiles.pdfFileName,
                isCurrentIssue: bookIsCurrentIssueCheckbox.checked, timestamp: new Date().toISOString()
            };

            try {
                const uploadAndUpdate = async (fileInput, currentFile, storagePath, dataKeyUrl, dataKeyFileName) => {
                    if (fileInput.files[0]) {
                        if (currentFile.fileName) await deleteFile(currentFile.fileName, storagePath);
                        const result = await uploadFile(fileInput.files[0], storagePath);
                        data.abstracts = { ...data.abstracts, [dataKeyUrl]: result.url, [dataKeyFileName]: result.fileName };
                        if (dataKeyUrl === 'coverImageUrl') { data.coverImageUrl = result.url; data.coverImageFileName = result.fileName; }
                        else if (dataKeyUrl === 'pdfUrl') { data.pdfUrl = result.url; data.pdfFileName = result.fileName; }
                        else if (dataKeyUrl.startsWith('abstracts')) { data.abstracts[dataKeyUrl.split('.')[1]] = {url: result.url, fileName: result.fileName, text: data.abstracts[dataKeyUrl.split('.')[1]].text} }
                    }
                };

                await uploadAndUpdate(bookCoverInput, {fileName: currentPubFiles.coverFileName}, STORAGE_PATH_COVERS, 'coverImageUrl', 'coverImageFileName');
                await uploadAndUpdate(bookPdfInput, {fileName: currentPubFiles.pdfFileName}, STORAGE_PATH_PDFS, 'pdfUrl', 'pdfFileName');
                await uploadAndUpdate(abstractArPdfInput, {fileName: currentPubFiles.abstracts.ar.fileName}, STORAGE_PATH_ABSTRACTS, 'abstracts.ar.url', 'abstracts.ar.fileName');
                await uploadAndUpdate(abstractEnPdfInput, {fileName: currentPubFiles.abstracts.en.fileName}, STORAGE_PATH_ABSTRACTS, 'abstracts.en.url', 'abstracts.en.fileName');
                await uploadAndUpdate(abstractItPdfInput, {fileName: currentPubFiles.abstracts.it.fileName}, STORAGE_PATH_ABSTRACTS, 'abstracts.it.url', 'abstracts.it.fileName');
                
                if (data.isCurrentIssue) {
                    const currentIssueQ = query(collection(db, PUBLIC_PUB_COLLECTION), where("isCurrentIssue", "==", true));
                    const currentIssuesSnap = await getDocs(currentIssueQ);
                    for (const docToUnset of currentIssuesSnap.docs) {
                        if (docToUnset.id !== editingPublicationId) {
                            await updateDoc(doc(db, PUBLIC_PUB_COLLECTION, docToUnset.id), { isCurrentIssue: false });
                        }
                    }
                }

                if (editingPublicationId) { await updateDoc(doc(db, PUBLIC_PUB_COLLECTION, editingPublicationId), data); showMessageModal(translations[currentLanguage].successMessage, translations[currentLanguage].publicationUpdated, "success"); }
                else { await addDoc(collection(db, PUBLIC_PUB_COLLECTION), data); showMessageModal(translations[currentLanguage].successMessage, translations[currentLanguage].publicationAdded, "success"); }
                resetAddPublicationForm();
            } catch (error) { console.error("Error saving publication:", error); showMessageModal(translations[currentLanguage].errorMessage, translations[currentLanguage].errorSavingPublication + `: ${error.message}`, "error"); }
            finally { hideLoadingSpinner(); }
        });

        // Reset form function for Add/Edit Publication
        function resetAddPublicationForm() {
            document.getElementById('addPublicationForm').reset(); editingPublicationId = null;
            adminFormTitle.textContent = translations[currentLanguage].addPublicationTitle; submitPublicationBtn.textContent = translations[currentLanguage].addPublicationButton;
            cancelEditPublicationBtn.classList.add('hidden');
            uploadedCoverPreviewAdmin.src = ''; uploadedCoverPreviewAdmin.style.display = 'none'; coverImageFileNameDisplayAdmin.textContent = '';
            pdfFileNameDisplayAdmin.textContent = '';
            abstractArPdfFileNameDisplayAdmin.textContent = ''; abstractEnPdfFileNameDisplayAdmin.textContent = ''; abstractItPdfFileNameDisplayAdmin.textContent = '';
            currentPubFiles = {
                coverUrl: '', coverFileName: '', pdfUrl: '', pdfFileName: '',
                abstracts: { ar: { text: '', url: '', fileName: '' }, en: { text: '', url: '', fileName: '' }, it: { text: '', url: '', fileName: '' } }
            };
        }
        cancelEditPublicationBtn.addEventListener('click', resetAddPublicationForm);

        // Edit Publication function
        async function editPublication(pubId) {
            showLoadingSpinner();
            try {
                const docSnap = await getDoc(doc(db, PUBLIC_PUB_COLLECTION, pubId));
                if (docSnap.exists()) {
                    const data = docSnap.data(); editingPublicationId = pubId;
                    bookTitleInput.value = data.title; bookAuthorsInput.value = data.authors; bookYearInput.value = data.year;
                    bookDescriptionInput.value = data.description; bookISBNInput.value = data.isbn || ''; bookISSNInput.value = data.issn || '';
                    abstractArTextInput.value = data.abstracts?.ar?.text || ''; abstractEnTextInput.value = data.abstracts?.en?.text || ''; abstractItTextInput.value = data.abstracts?.it?.text || '';
                    bookIsCurrentIssueCheckbox.checked = data.isCurrentIssue || false;

                    currentPubFiles = {
                        coverUrl: data.coverImageUrl || '', coverFileName: data.coverImageFileName || '',
                        pdfUrl: data.pdfUrl || '', pdfFileName: data.pdfFileName || '',
                        abstracts: {
                            ar: data.abstracts?.ar || { url: '', fileName: '' },
                            en: data.abstracts?.en || { url: '', fileName: '' },
                            it: data.abstracts?.it || { url: '', fileName: '' }
                        }
                    };
                    uploadedCoverPreviewAdmin.src = currentPubFiles.coverUrl; uploadedCoverPreviewAdmin.style.display = currentPubFiles.coverUrl ? 'block' : 'none';
                    coverImageFileNameDisplayAdmin.textContent = currentPubFiles.coverFileName ? `${translations[currentLanguage].currentLabel}: ${getOriginalFileNameFromUnique(currentPubFiles.coverFileName)}` : '';
                    pdfFileNameDisplayAdmin.textContent = currentPubFiles.pdfFileName ? `${translations[currentLanguage].currentLabel}: ${getOriginalFileNameFromUnique(currentPubFiles.pdfFileName)}` : '';
                    abstractArPdfFileNameDisplayAdmin.textContent = currentPubFiles.abstracts.ar.fileName ? `${translations[currentLanguage].currentLabel}: ${getOriginalFileNameFromUnique(currentPubFiles.abstracts.ar.fileName)}` : '';
                    abstractEnPdfFileNameDisplayAdmin.textContent = currentPubFiles.abstracts.en.fileName ? `${translations[currentLanguage].currentLabel}: ${getOriginalFileNameFromUnique(currentPubFiles.abstracts.en.fileName)}` : '';
                    abstractItPdfFileNameDisplayAdmin.textContent = currentPubFiles.abstracts.it.fileName ? `${translations[currentLanguage].currentLabel}: ${getOriginalFileNameFromUnique(currentPubFiles.abstracts.it.fileName)}` : '';
                    bookCoverInput.value = ''; bookPdfInput.value = ''; abstractArPdfInput.value = ''; abstractEnPdfInput.value = ''; abstractItPdfInput.value = '';
                    adminFormTitle.textContent = translations[currentLanguage].updatePublicationButton; submitPublicationBtn.textContent = translations[currentLanguage].updatePublicationButton;
                    cancelEditPublicationBtn.classList.remove('hidden'); window.scrollTo({ top: 0, behavior: 'smooth' });
                } else { showMessageModal(translations[currentLanguage].errorMessage, translations[currentLanguage].pubNotFoundForEdit, "error"); }
            } catch (error) { console.error("Error editing pub:", error); showMessageModal(translations[currentLanguage].errorMessage, translations[currentLanguage].errorLoadingPublicationForEdit + `: ${error.message}`, "error"); }
            finally { hideLoadingSpinner(); }
        }

        function confirmDeletePublication(pubId) {
            showMessageModal(translations[currentLanguage].confirmDelete, translations[currentLanguage].confirmDeleteMsg, "confirm", async confirmed => {
                if (confirmed) {
                    showLoadingSpinner();
                    try {
                        const docRef = doc(db, PUBLIC_PUB_COLLECTION, pubId);
                        const docSnap = await getDoc(docRef);
                        if (docSnap.exists()) {
                            const data = docSnap.data();
                            await deleteFile(data.coverImageFileName, STORAGE_PATH_COVERS);
                            await deleteFile(data.pdfFileName, STORAGE_PATH_PDFS);
                            await deleteFile(data.abstracts?.ar?.fileName, STORAGE_PATH_ABSTRACTS);
                            await deleteFile(data.abstracts?.en?.fileName, STORAGE_PATH_ABSTRACTS);
                            await deleteFile(data.abstracts?.it?.fileName, STORAGE_PATH_ABSTRACTS);
                            await deleteDoc(docRef); showMessageModal(translations[currentLanguage].successMessage, translations[currentLanguage].publicationDeleted, "success");
                        } else { showMessageModal(translations[currentLanguage].errorMessage, translations[currentLanguage].pubNotFoundForDeletion, "error"); }
                    } catch (error) { console.error("Error deleting pub:", error); showMessageModal(translations[currentLanguage].errorMessage, translations[currentLanguage].errorDeletingPublication + `: ${error.message}`, "error"); }
                    finally { hideLoadingSpinner(); }
                }
            });
        }

        // --- News Admin Form Handling ---
        function resetAddNewsItemForm() {
            document.getElementById('addNewsItemForm').reset();
            document.getElementById('newsTitle').value = ''; document.getElementById('newsDescription').value = '';
            document.getElementById('newsImage').value = '';
            document.getElementById('uploadedNewsImagePreviewAdmin').src = ''; document.getElementById('uploadedNewsImagePreviewAdmin').style.display = 'none';
            document.getElementById('newsImageFileNameDisplayAdmin').textContent = '';
            currentNewsImage = { url: '', fileName: '' }; editingNewsItemId = null;
            document.getElementById('submitNewsBtn').textContent = translations[currentLanguage].addNewsItemButton;
            document.getElementById('cancelEditNewsBtn').classList.add('hidden');
        }
        document.getElementById('addNewsItemForm').addEventListener('submit', async e => {
            e.preventDefault(); showLoadingSpinner();
            const user = auth.currentUser; if (!user || user.email !== 'admin@example.com') { showMessageModal(translations[currentLanguage].permissionDenied, translations[currentLanguage].noPermissionAddNews, "error"); hideLoadingSpinner(); return; }

            const newsTitle = document.getElementById('newsTitle').value;
            const newsDescription = document.getElementById('newsDescription').value;
            const newsImageFile = document.getElementById('newsImage').files[0];
            let imageUrl = currentNewsImage.url, imageFileName = currentNewsImage.fileName;

            try {
                if (newsImageFile) {
                    if (currentNewsImage.fileName) await deleteFile(currentNewsImage.fileName, STORAGE_PATH_NEWS_IMAGES);
                    const uploadResult = await uploadFile(newsImageFile, STORAGE_PATH_NEWS_IMAGES);
                    imageUrl = uploadResult.url; imageFileName = uploadResult.fileName;
                }
                const newsData = { title: newsTitle, description: newsDescription, imageUrl, imageFileName, timestamp: new Date().toISOString() };
                if (editingNewsItemId) { await updateDoc(doc(db, PUBLIC_NEWS_COLLECTION, editingNewsItemId), newsData); showMessageModal(translations[currentLanguage].successMessage, translations[currentLanguage].newsItemUpdated, "success"); }
                else { await addDoc(collection(db, PUBLIC_NEWS_COLLECTION), newsData); showMessageModal(translations[currentLanguage].successMessage, translations[currentLanguage].newsItemAdded, "success"); }
                resetAddNewsItemForm();
            } catch (error) { console.error("Error saving news item:", error); showMessageModal(translations[currentLanguage].errorMessage, translations[currentLanguage].errorSavingNewsItem + `: ${error.message}`, "error"); }
            finally { hideLoadingSpinner(); }
        });

        document.getElementById('newsImage').addEventListener('change', e => {
            const fileNameDisplay = document.getElementById('newsImageFileNameDisplayAdmin');
            const previewImage = document.getElementById('uploadedNewsImagePreviewAdmin');
            if (e.target.files.length > 0) {
                const file = e.target.files[0];
                fileNameDisplay.textContent = `${translations[currentLanguage].selectedLabel}: ${file.name}`;
                const reader = new FileReader();
                reader.onload = event => { previewImage.src = event.target.result; previewImage.style.display = 'block'; };
                reader.readAsDataURL(file);
            } else {
                fileNameDisplay.textContent = currentNewsImage.fileName ? `${translations[currentLanguage].currentLabel}: ${getOriginalFileNameFromUnique(currentNewsImage.fileName)}` : '';
                previewImage.src = currentNewsImage.url; previewImage.style.display = currentNewsImage.url ? 'block' : 'none';
            }
        });
        document.getElementById('cancelEditNewsBtn').addEventListener('click', resetAddNewsItemForm);

        async function editNewsItem(newsItemId) {
            showLoadingSpinner();
            try {
                const docSnap = await getDoc(doc(db, PUBLIC_NEWS_COLLECTION, newsItemId));
                if (docSnap.exists()) {
                    const data = docSnap.data(); editingNewsItemId = newsItemId;
                    document.getElementById('newsTitle').value = data.title; document.getElementById('newsDescription').value = data.description;
                    currentNewsImage = { url: data.imageUrl || '', fileName: data.imageFileName || '' };
                    document.getElementById('newsImageFileNameDisplayAdmin').textContent = currentNewsImage.fileName ? `${translations[currentLanguage].currentLabel}: ${getOriginalFileNameFromUnique(currentNewsImage.fileName)}` : '';
                    document.getElementById('uploadedNewsImagePreviewAdmin').src = currentNewsImage.url; document.getElementById('uploadedNewsImagePreviewAdmin').style.display = currentNewsImage.url ? 'block' : 'none';
                    document.getElementById('newsImage').value = '';
                    document.getElementById('submitNewsBtn').textContent = translations[currentLanguage].updateNewsItemButton;
                    document.getElementById('cancelEditNewsBtn').classList.remove('hidden'); window.scrollTo({ top: 0, behavior: 'smooth' });
                } else { showMessageModal(translations[currentLanguage].errorMessage, translations[currentLanguage].newsItemNotFoundForEdit, "error"); }
            } catch (error) { console.error("Error fetching news item for edit:", error); showMessageModal(translations[currentLanguage].errorMessage, translations[currentLanguage].errorLoadingNewsItemForEdit + `: ${error.message}`, "error"); }
            finally { hideLoadingSpinner(); }
        }

        function confirmDeleteNewsItem(newsItemId) {
            showMessageModal(translations[currentLanguage].confirmDelete, translations[currentLanguage].confirmDeleteMsg, "confirm", async confirmed => {
                if (confirmed) {
                    showLoadingSpinner();
                    try {
                        const newsRef = doc(db, PUBLIC_NEWS_COLLECTION, newsItemId);
                        const newsDoc = await getDoc(newsRef);
                        if (newsDoc.exists()) {
                            const data = newsDoc.data();
                            await deleteFile(data.imageFileName, STORAGE_PATH_NEWS_IMAGES);
                            await deleteDoc(newsRef); showMessageModal(translations[currentLanguage].successMessage, translations[currentLanguage].newsItemDeleted, "success");
                        } else { showMessageModal(translations[currentLanguage].errorMessage, translations[currentLanguage].newsItemNotFoundForDeletion, "error"); }
                    } catch (error) { console.error("Error deleting news item:", error); showMessageModal(translations[currentLanguage].errorMessage, translations[currentLanguage].errorDeletingNewsItem + `: ${error.message}`, "error"); }
                    finally { hideLoadingSpinner(); }
                }
            });
        }

        function listenForAdminNews() {
            onSnapshot(query(collection(db, PUBLIC_NEWS_COLLECTION), orderBy("timestamp", "desc")), snapshot => {
                const adminNewsListBody = document.getElementById('adminNewsList'); adminNewsListBody.innerHTML = '';
                if (snapshot.empty) { adminNewsListBody.innerHTML = `<tr class="admin-table-row"><td colspan="3" class="px-6 py-4 text-sm text-gray-600">${translations[currentLanguage].noNewsToManage}</td></tr>`; return; }
                snapshot.forEach(doc => {
                    const news = { id: doc.id, ...doc.data() };
                    const row = adminNewsListBody.insertRow(); row.className = 'admin-table-row';
                    row.innerHTML = `
                        <td class="px-6 py-4 text-sm font-medium text-gray-800">${news.title}</td>
                        <td class="px-6 py-4 text-sm text-gray-700">${new Date(news.timestamp).toLocaleDateString(currentLanguage === 'it' ? 'it-IT' : 'en-US')}</td>
                        <td class="px-6 py-4 text-right text-sm flex space-x-2">
                            <button class="text-blue-600 hover:text-blue-800 edit-news-button admin-button" data-id="${news.id}">${translations[currentLanguage].editButton}</button>
                            <button class="text-red-600 hover:text-red-800 delete-news-button admin-button" data-id="${news.id}">${translations[currentLanguage].deleteButton}</button>
                        </td>`;
                });
                document.querySelectorAll('.edit-news-button').forEach(btn => btn.addEventListener('click', e => editNewsItem(e.target.dataset.id)));
                document.querySelectorAll('.delete-news-button').forEach(btn => btn.addEventListener('click', e => confirmDeleteNewsItem(e.target.dataset.id)));
            }, error => {
                console.error("Error listening to admin news:", error);
                showMessageModal(translations[currentLanguage].errorMessage, translations[currentLanguage].errorLoadingAdminNews, "error");
            });
        }

        // --- Custom Modal (Alert/Confirm Replacement) ---
        const messageModalEl = document.getElementById('messageModal'), messageTextEl = document.getElementById('messageText'),
            modalButtonsEl = document.getElementById('modalButtons'), closeMessageModalEl = document.getElementById('closeMessageModal');
        closeMessageModalEl.addEventListener('click', () => { messageModalEl.classList.remove('flex'); messageModalEl.classList.add('hidden'); });
        messageModalEl.addEventListener('click', e => { if (e.target === messageModalEl) { messageModalEl.classList.remove('flex'); messageModalEl.classList.add('hidden'); } });

        function showMessageModal(title, message, type = "alert", callback = null) {
            messageTextEl.innerHTML = `<strong>${title}</strong><br>${message}`; modalButtonsEl.innerHTML = '';
            if (type === "confirm") {
                const yesBtn = document.createElement('button'); yesBtn.textContent = translations[currentLanguage].yesButton; yesBtn.className = 'nav-button bg-red-600 hover:bg-red-700 text-white';
                yesBtn.onclick = () => { messageModalEl.classList.remove('flex'); messageModalEl.classList.add('hidden'); if (callback) callback(true); }; modalButtonsEl.appendChild(yesBtn);
                const noBtn = document.createElement('button'); noBtn.textContent = translations[currentLanguage].noButton; noBtn.className = 'nav-button bg-gray-500 hover:bg-gray-600 text-white';
                noBtn.onclick = () => { messageModalEl.classList.remove('flex'); messageModalEl.classList.add('hidden'); if (callback) callback(false); }; modalButtonsEl.appendChild(noBtn);
            } else {
                const okBtn = document.createElement('button'); okBtn.textContent = translations[currentLanguage].okButton; okBtn.className = 'nav-button bg-blue-600 hover:bg-blue-700 text-white';
                okBtn.onclick = () => { messageModalEl.classList.remove('flex'); messageModalEl.classList.add('hidden'); if (callback) callback(); }; modalButtonsEl.appendChild(okBtn);
            }
            messageModalEl.classList.remove('hidden'); messageModalEl.classList.add('flex');
        }

        const pubDetailsModal = document.getElementById('publicationDetailsModal');
        const closePubDetailsModal = document.getElementById('closePublicationDetailsModal');
        closePubDetailsModal.addEventListener('click', () => pubDetailsModal.classList.remove('flex', 'hidden'));
        pubDetailsModal.addEventListener('click', e => { if (e.target === pubDetailsModal) pubDetailsModal.classList.remove('flex', 'hidden'); });

        function showPublicationDetailsModal(book) {
            document.getElementById('detailCoverImage').src = book.coverImageUrl || 'https://placehold.co/400x600/e0e2e5/3f4245?text=No+Image';
            document.getElementById('detailTitle').textContent = book.title;
            document.getElementById('detailAuthors').textContent = book.authors;
            document.getElementById('detailYear').textContent = book.year;
            document.getElementById('detailDescription').textContent = book.description || translations[currentLanguage].noDescription;
            document.getElementById('detailISBN').textContent = book.isbn || 'N/A';
            document.getElementById('detailISSN').textContent = book.issn || 'N/A';
            document.getElementById('detailAbstractArText').textContent = book.abstracts?.ar?.text || translations[currentLanguage].noArabicAbstract;
            document.getElementById('detailAbstractEnText').textContent = book.abstracts?.en?.text || translations[currentLanguage].noEnglishAbstract;
            document.getElementById('detailAbstractItText').textContent = book.abstracts?.it?.text || translations[currentLanguage].noItalianAbstract;

            const updateDetailBtn = (btnId, url, unavailableKey) => {
                const btn = document.getElementById(btnId);
                btn.href = url || '#';
                btn.classList.toggle('disabled', !url);
                btn.onclick = url ? null : e => { e.preventDefault(); showMessageModal(translations[currentLanguage].unavailable, translations[currentLanguage][unavailableKey], "alert"); };
            };
            updateDetailBtn('detailDownloadPdfBtn', book.pdfUrl, 'fullPdfUnavailable');
            updateDetailBtn('detailDownloadAbstractArBtn', book.abstracts?.ar?.url, 'arabicAbstractPdfUnavailable');
            updateDetailBtn('detailDownloadAbstractEnBtn', book.abstracts?.en?.url, 'englishAbstractPdfUnavailable');
            updateDetailBtn('detailDownloadAbstractItBtn', book.abstracts?.it?.url, 'italianAbstractPdfUnavailable');
            pubDetailsModal.classList.remove('hidden'); pubDetailsModal.classList.add('flex');
        }

        // --- Loading Spinner Functions ---
        const loadingSpinner = document.getElementById('loadingSpinner');
        function showLoadingSpinner() { loadingSpinner.classList.remove('hidden'); }
        function hideLoadingSpinner() { loadingSpinner.classList.add('hidden'); }

        // --- Initial Load Logic ---
        window.onload = function() {
            applyTranslations(currentLanguage);
            initializeFirebase();
            document.getElementById('currentYear').textContent = new Date().getFullYear();
            showView('aboutUs');
        };
    </script>
</body>
</html>
